{
  "name" : "1707.06887.pdf",
  "metadata" : {
    "source" : "META",
    "title" : "A Distributional Perspective on Reinforcement Learning",
    "authors" : [ "Marc G. Bellemare", "Will Dabney", "Rémi Munos" ],
    "emails" : [ "<bellemare@google.com>." ],
    "sections" : [ {
      "heading" : "1. Introduction",
      "text" : "One of the major tenets of reinforcement learning states that, when not otherwise constrained in its behaviour, an agent should aim to maximize its expected utility Q, or value (Sutton & Barto, 1998). Bellman’s equation succintly describes this value in terms of the expected reward and expected outcome of the random transition (x, a)→ (X ′, A′):\nQ(x, a) = ER(x, a) + γ EQ(X ′, A′).\nIn this paper, we aim to go beyond the notion of value and argue in favour of a distributional perspective on reinforce-\n*Equal contribution 1DeepMind, London, UK. Correspondence to: Marc G. Bellemare <bellemare@google.com>.\nProceedings of the 34 th International Conference on Machine Learning, Sydney, Australia, PMLR 70, 2017. Copyright 2017 by the author(s).\nment learning. Specifically, the main object of our study is the random returnZ whose expectation is the valueQ. This random return is also described by a recursive equation, but one of a distributional nature:\nZ(x, a) D = R(x, a) + γZ(X ′, A′).\nThe distributional Bellman equation states that the distribution ofZ is characterized by the interaction of three random variables: the reward R, the next state-action (X ′, A′), and its random return Z(X ′, A′). By analogy with the wellknown case, we call this quantity the value distribution.\nAlthough the distributional perspective is almost as old as Bellman’s equation itself (Jaquette, 1973; Sobel, 1982; White, 1988), in reinforcement learning it has thus far been subordinated to specific purposes: to model parametric uncertainty (Dearden et al., 1998), to design risk-sensitive algorithms (Morimura et al., 2010b;a), or for theoretical analysis (Azar et al., 2012; Lattimore & Hutter, 2012). By contrast, we believe the value distribution has a central role to play in reinforcement learning.\nContraction of the policy evaluation Bellman operator. Basing ourselves on results by Rösler (1992) we show that, for a fixed policy, the Bellman operator over value distributions is a contraction in a maximal form of the Wasserstein (also called Kantorovich or Mallows) metric. Our particular choice of metric matters: the same operator is not a contraction in total variation, Kullback-Leibler divergence, or Kolmogorov distance.\nInstability in the control setting. We will demonstrate an instability in the distributional version of Bellman’s optimality equation, in contrast to the policy evaluation case. Specifically, although the optimality operator is a contraction in expected value (matching the usual optimality result), it is not a contraction in any metric over distributions. These results provide evidence in favour of learning algorithms that model the effects of nonstationary policies.\nBetter approximations. From an algorithmic standpoint, there are many benefits to learning an approximate distribution rather than its approximate expectation. The distributional Bellman operator preserves multimodality in value distributions, which we believe leads to more stable learning. Approximating the full distribution also mitigates the effects of learning from a nonstationary policy. As a whole,\nar X\niv :1\n70 7.\n06 88\n7v 1\n[ cs\n.L G\n] 2\n1 Ju\nl 2 01\n7\nwe argue that this approach makes approximate reinforcement learning significantly better behaved.\nWe will illustrate the practical benefits of the distributional perspective in the context of the Arcade Learning Environment (Bellemare et al., 2013). By modelling the value distribution within a DQN agent (Mnih et al., 2015), we obtain considerably increased performance across the gamut of benchmark Atari 2600 games, and in fact achieve stateof-the-art performance on a number of games. Our results echo those of Veness et al. (2015), who obtained extremely fast learning by predicting Monte Carlo returns.\nFrom a supervised learning perspective, learning the full value distribution might seem obvious: why restrict ourselves to the mean? The main distinction, of course, is that in our setting there are no given targets. Instead, we use Bellman’s equation to make the learning process tractable; we must, as Sutton & Barto (1998) put it, “learn a guess from a guess”. It is our belief that this guesswork ultimately carries more benefits than costs."
    }, {
      "heading" : "2. Setting",
      "text" : "We consider an agent interacting with an environment in the standard fashion: at each step, the agent selects an action based on its current state, to which the environment responds with a reward and the next state. We model this interaction as a time-homogeneous Markov Decision Process (X ,A, R, P, γ). As usual, X and A are respectively the state and action spaces, P is the transition kernelP (· |x, a), γ ∈ [0, 1] is the discount factor, and R is the reward function, which in this work we explicitly treat as a random variable. A stationary policy π maps each state x ∈ X to a probability distribution over the action space A."
    }, {
      "heading" : "2.1. Bellman’s Equations",
      "text" : "The return Zπ is the sum of discounted rewards along the agent’s trajectory of interactions with the environment. The value function Qπ of a policy π describes the expected return from taking action a ∈ A from state x ∈ X , then acting according to π:\nQπ(x, a) := EZπ(x, a) = E [ ∞∑ t=0 γtR(xt, at) ] , (1) xt ∼ P (· |xt−1, at−1), at ∼ π(· |xt), x0 = x, a0 = a.\nFundamental to reinforcement learning is the use of Bellman’s equation (Bellman, 1957) to describe the value function:\nQπ(x, a) = ER(x, a) + γ E P,π Qπ(x′, a′).\nIn reinforcement learning we are typically interested in acting so as to maximize the return. The most common ap-\nproach for doing so involves the optimality equation\nQ∗(x, a) = ER(x, a) + γ EP max a′∈A Q∗(x′, a′).\nThis equation has a unique fixed point Q∗, the optimal value function, corresponding to the set of optimal policies Π∗ (π∗ is optimal if Ea∼π∗ Q∗(x, a) = maxaQ∗(x, a)).\nWe view value functions as vectors in RX×A, and the expected reward function as one such vector. In this context, the Bellman operator T π and optimality operator T are T πQ(x, a) := ER(x, a) + γ E\nP,π Q(x′, a′) (2)\nT Q(x, a) := ER(x, a) + γ EP max a′∈A Q(x′, a′). (3)\nThese operators are useful as they describe the expected behaviour of popular learning algorithms such as SARSA and Q-Learning. In particular they are both contraction mappings, and their repeated application to some initialQ0 converges exponentially to Qπ or Q∗, respectively (Bertsekas & Tsitsiklis, 1996)."
    }, {
      "heading" : "3. The Distributional Bellman Operators",
      "text" : "In this paper we take away the expectations inside Bellman’s equations and consider instead the full distribution of the random variable Zπ . From here on, we will view Zπ as a mapping from state-action pairs to distributions over returns, and call it the value distribution.\nOur first aim is to gain an understanding of the theoretical behaviour of the distributional analogues of the Bellman operators, in particular in the less well-understood control setting. The reader strictly interested in the algorithmic contribution may choose to skip this section."
    }, {
      "heading" : "3.1. Distributional Equations",
      "text" : "It will sometimes be convenient to make use of the probability space (Ω,F ,Pr). The reader unfamiliar with mea-\nsure theory may think of Ω as the space of all possible outcomes of an experiment (Billingsley, 1995). We will write ‖u‖p to denote the Lp norm of a vector u ∈ RX for 1 ≤ p ≤ ∞; the same applies to vectors in RX×A. The Lp norm of a random vector U : Ω → RX (or RX×A) is then ‖U‖p := [ E [ ‖U(ω)‖pp ]]1/p , and for p = ∞ we have ‖U‖∞ = ess sup ‖U(ω)‖∞ (we will omit the dependency on ω ∈ Ω whenever unambiguous). We will denote the c.d.f. of a random variable U by FU (y) := Pr{U ≤ y}, and its inverse c.d.f. by F−1U (q) := inf{y : FU (y) ≥ q}.\nA distributional equation U D := V indicates that the random variable U is distributed according to the same law as V . Without loss of generality, the reader can understand the two sides of a distributional equation as relating the distributions of two independent random variables. Distributional equations have been used in reinforcement learning by Engel et al. (2005); Morimura et al. (2010a) among others, and in operations research by White (1988)."
    }, {
      "heading" : "3.2. The Wasserstein Metric",
      "text" : "The main tool for our analysis is the Wasserstein metric dp between cumulative distribution functions (see e.g. Bickel & Freedman, 1981, where it is called the Mallows metric). For F , G two c.d.fs over the reals, it is defined as\ndp(F,G) := inf U,V ‖U − V ‖p,\nwhere the infimum is taken over all pairs of random variables (U, V ) with respective cumulative distributions F and G. The infimum is attained by the inverse c.d.f. transform of a random variable U uniformly distributed on [0, 1]:\ndp(F,G) = ‖F−1(U)−G−1(U)‖p.\nFor p <∞ this is more explicitly written as\ndp(F,G) = (∫ 1 0 ∣∣F−1(u)−G−1(u)∣∣pdu)1/p . Given two random variables U , V with c.d.fs FU , FV , we will write dp(U, V ) := dp(FU , FV ). We will find it convenient to conflate the random variables under consideration with their versions under the inf , writing\ndp(U, V ) = inf U,V ‖U − V ‖p.\nwhenever unambiguous; we believe the greater legibility justifies the technical inaccuracy. Finally, we extend this metric to vectors of random variables, such as value distributions, using the corresponding Lp norm.\nConsider a scalar a and a random variable A independent\nof U, V . The metric dp has the following properties:\ndp(aU, aV ) ≤ |a|dp(U, V ) (P1) dp(A+ U,A+ V ) ≤ dp(U, V ) (P2)\ndp(AU,AV ) ≤ ‖A‖pdp(U, V ). (P3)\nWe will need the following additional property, which makes no independence assumptions on its variables. Its proof, and that of later results, is given in the appendix.\nLemma 1 (Partition lemma). Let A1, A2, . . . be a set of random variables describing a partition of Ω, i.e. Ai(ω) ∈ {0, 1} and for any ω there is exactly one Ai with Ai(ω) = 1. Let U, V be two random variables. Then\ndp ( U, V ) ≤ ∑\ni dp(AiU,AiV ).\nLet Z denote the space of value distributions with bounded moments. For two value distributions Z1, Z2 ∈ Z we will make use of a maximal form of the Wasserstein metric:\nd̄p(Z1, Z2) := sup x,a dp(Z1(x, a), Z2(x, a)).\nWe will use d̄p to establish the convergence of the distributional Bellman operators.\nLemma 2. d̄p is a metric over value distributions."
    }, {
      "heading" : "3.3. Policy Evaluation",
      "text" : "In the policy evaluation setting (Sutton & Barto, 1998) we are interested in the value function V π associated with a given policy π. The analogue here is the value distribution Zπ . In this section we characterize Zπ and study the behaviour of the policy evaluation operator T π . We emphasize that Zπ describes the intrinsic randomness of the agent’s interactions with its environment, rather than some measure of uncertainty about the environment itself.\nWe view the reward function as a random vector R ∈ Z , and define the transition operator Pπ : Z → Z\nPπZ(x, a) D := Z(X ′, A′) (4)\nX ′ ∼ P (· |x, a), A′ ∼ π(· |X ′),\nwhere we use capital letters to emphasize the random nature of the next state-action pair (X ′, A′). We define the distributional Bellman operator T π : Z → Z as\nT πZ(x, a) D:= R(x, a) + γPπZ(x, a). (5)\nWhile T π bears a surface resemblance to the usual Bellman operator (2), it is fundamentally different. In particular, three sources of randomness define the compound distribution T πZ:\na) The randomness in the reward R, b) The randomness in the transition Pπ , and c) The next-state value distribution Z(X ′, A′).\nIn particular, we make the usual assumption that these three quantities are independent. In this section we will show that (5) is a contraction mapping whose unique fixed point is the random return Zπ .\n3.3.1. CONTRACTION IN d̄p\nConsider the process Zk+1 := T πZk, starting with some Z0 ∈ Z . We may expect the limiting expectation of {Zk} to converge exponentially quickly, as usual, to Qπ . As we now show, the process converges in a stronger sense: T π is a contraction in d̄p, which implies that all moments also converge exponentially quickly.\nLemma 3. T π : Z → Z is a γ-contraction in d̄p.\nUsing Lemma 3, we conclude using Banach’s fixed point theorem that T π has a unique fixed point. By inspection, this fixed point must be Zπ as defined in (1). As we assume all moments are bounded, this is sufficient to conclude that the sequence {Zk} converges to Zπ in d̄p for 1 ≤ p ≤ ∞. To conclude, we remark that not all distributional metrics are equal; for example, Chung & Sobel (1987) have shown that T π is not a contraction in total variation distance. Similar results can be derived for the Kullback-Leibler divergence and the Kolmogorov distance."
    }, {
      "heading" : "3.3.2. CONTRACTION IN CENTERED MOMENTS",
      "text" : "Observe that d2(U, V ) (and more generally, dp) relates to a coupling C(ω) := U(ω)− V (ω), in the sense that\nd22(U, V ) ≤ E[(U − V )2] = V ( C ) + ( EC )2 .\nAs a result, we cannot directly use d2 to bound the variance difference |V(T πZ(x, a)) − V(Zπ(x, a))|. However, T π is in fact a contraction in variance (Sobel, 1982, see also appendix). In general, T π is not a contraction in the pth centered moment, p > 2, but the centered moments of the iterates {Zk} still converge exponentially quickly to those of Zπ; the proof extends the result of Rösler (1992)."
    }, {
      "heading" : "3.4. Control",
      "text" : "Thus far we have considered a fixed policy π, and studied the behaviour of its associated operator T π . We now set out to understand the distributional operators of the control setting – where we seek a policy π that maximizes value – and the corresponding notion of an optimal value distribution. As with the optimal value function, this notion is intimately tied to that of an optimal policy. However, while all optimal policies attain the same value Q∗, in our case\na difficulty arises: in general there are many optimal value distributions.\nIn this section we show that the distributional analogue of the Bellman optimality operator converges, in a weak sense, to the set of optimal value distributions. However, this operator is not a contraction in any metric between distributions, and is in general much more temperamental than the policy evaluation operators. We believe the convergence issues we outline here are a symptom of the inherent instability of greedy updates, as highlighted by e.g. Tsitsiklis (2002) and most recently Harutyunyan et al. (2016).\nLet Π∗ be the set of optimal policies. We begin by characterizing what we mean by an optimal value distribution.\nDefinition 1 (Optimal value distribution). An optimal value distribution is the v.d. of an optimal policy. The set of optimal value distributions is Z∗ := {Zπ∗ : π∗ ∈ Π∗}.\nWe emphasize that not all value distributions with expectation Q∗ are optimal: they must match the full distribution of the return under some optimal policy.\nDefinition 2. A greedy policy π for Z ∈ Z maximizes the expectation of Z. The set of greedy policies for Z is\nGZ := {π : ∑\na π(a |x)EZ(x, a) = max a′∈A EZ(x, a′)}.\nRecall that the expected Bellman optimality operator T is\nT Q(x, a) = ER(x, a) + γ EP max a′∈A Q(x′, a′). (6)\nThe maximization at x′ corresponds to some greedy policy. Although this policy is implicit in (6), we cannot ignore it in the distributional setting. We will call a distributional Bellman optimality operator any operator T which implements a greedy selection rule, i.e."
    }, {
      "heading" : "T Z = T πZ for some π ∈ GZ .",
      "text" : "As in the policy evaluation setting, we are interested in the behaviour of the iterates Zk+1 := T Zk, Z0 ∈ Z . Our first result is to assert that EZk behaves as expected. Lemma 4. Let Z1, Z2 ∈ Z . Then\n‖E T Z1 − E T Z2‖∞ ≤ γ ‖EZ1 − EZ2‖∞ ,\nand in particular EZk → Q∗ exponentially quickly.\nBy inspecting Lemma 4, we might expect that Zk converges quickly in d̄p to some fixed point in Z∗. Unfortunately, convergence is neither quick nor assured to reach a fixed point. In fact, the best we can hope for is pointwise convergence, not even to the set Z∗ but to the larger set of nonstationary optimal value distributions.\nDefinition 3. A nonstationary optimal value distribution Z∗∗ is the value distribution corresponding to a sequence of optimal policies. The set of n.o.v.d. is Z∗∗. Theorem 1 (Convergence in the control setting). Let X be measurable and suppose that A is finite. Then\nlim k→∞ inf Z∗∗∈Z∗∗\ndp(Zk(x, a), Z ∗∗(x, a)) = 0 ∀x, a.\nIf X is finite, then Zk converges to Z∗∗ uniformly. Furthermore, if there is a total ordering≺ on Π∗, such that for any Z∗ ∈ Z∗,"
    }, {
      "heading" : "T Z∗ = T πZ∗ with π ∈ GZ∗ , π ≺ π′ ∀π′ ∈ GZ∗ \\ {π}.",
      "text" : "Then T has a unique fixed point Z∗ ∈ Z∗.\nComparing Theorem 1 to Lemma 4 reveals a significant difference between the distributional framework and the usual setting of expected return. While the mean of Zk converges exponentially quickly toQ∗, its distribution need not be as well-behaved! To emphasize this difference, we now provide a number of negative results concerning T . Proposition 1. The operator T is not a contraction.\nConsider the following example (Figure 2, left). There are two states, x1 and x2; a unique transition from x1 to x2; from x2, action a1 yields no reward, while the optimal action a2 yields 1 + or −1 + with equal probability. Both actions are terminal. There is a unique optimal policy and therefore a unique fixed pointZ∗. Now considerZ as given in Figure 2 (right), and its distance to Z∗:\nd̄1(Z,Z ∗) = d1(Z(x2, a2), Z ∗(x2, a2)) = 2 ,\nwhere we made use of the fact that Z = Z∗ everywhere except at (x2, a2). When we apply T to Z, however, the greedy action a1 is selected and T Z(x1) = Z(x2, a1). But\nd1(T Z, T Z∗) = d1(T Z(x1), Z∗(x1)) = 12 |1− |+ 12 |1 + | > 2\nfor a sufficiently small . This shows that the undiscounted update is not a nonexpansion: d̄1(T Z, T Z∗) > d̄1(Z,Z∗). With γ < 1, the same proof shows it is not a contraction. Using a more technically involved argument, we can extend this result to any metric which separates Z and T Z. Proposition 2. Not all optimality operators have a fixed point Z∗ = T Z∗.\nTo see this, consider the same example, now with = 0, and a greedy operator T which breaks ties by picking a2 if Z(x1) = 0, and a1 otherwise. Then the sequence T Z∗(x1), (T )2Z∗(x1), . . . alternates between Z∗(x2, a1) and Z∗(x2, a2).\nProposition 3. That T has a fixed point Z∗ = T Z∗ is insufficient to guarantee the convergence of {Zk} to Z∗.\nTheorem 1 paints a rather bleak picture of the control setting. It remains to be seen whether the dynamical eccentricies highlighted here actually arise in practice. One open question is whether theoretically more stable behaviour can be derived using stochastic policies, for example from conservative policy iteration (Kakade & Langford, 2002)."
    }, {
      "heading" : "4. Approximate Distributional Learning",
      "text" : "In this section we propose an algorithm based on the distributional Bellman optimality operator. In particular, this will require choosing an approximating distribution. Although the Gaussian case has previously been considered (Morimura et al., 2010a; Tamar et al., 2016), to the best of our knowledge we are the first to use a rich class of parametric distributions."
    }, {
      "heading" : "4.1. Parametric Distribution",
      "text" : "We will model the value distribution using a discrete distribution parametrized by N ∈ N and VMIN, VMAX ∈ R, and whose support is the set of atoms {zi = VMIN + i4z : 0 ≤ i < N}, 4z := VMAX−VMINN−1 . In a sense, these atoms are the “canonical returns” of our distribution. The atom probabilities are given by a parametric model θ : X ×A → RN\nZθ(x, a) = zi w.p. pi(x, a) := eθi(x,a)∑ j e θj(x,a) .\nThe discrete distribution has the advantages of being highly expressive and computationally friendly (see e.g. Van den Oord et al., 2016)."
    }, {
      "heading" : "4.2. Projected Bellman Update",
      "text" : "Using a discrete distribution poses a problem: the Bellman update T Zθ and our parametrization Zθ almost always have disjoint supports. From the analysis of Section 3 it would seem natural to minimize the Wasserstein metric (viewed as a loss) between T Zθ and Zθ, which is also\nconveniently robust to discrepancies in support. However, a second issue prevents this: in practice we are typically restricted to learning from sample transitions, which is not possible under the Wasserstein loss (see Prop. 5 and toy results in the appendix).\nInstead, we project the sample Bellman update T̂ Zθ onto the support of Zθ (Figure 1, Algorithm 1), effectively reducing the Bellman update to multiclass classification. Let π be the greedy policy w.r.t. EZθ. Given a sample transition (x, a, r, x′), we compute the Bellman update T̂ zj := r + γzj for each atom zj , then distribute its probability pj(x\n′, π(x′)) to the immediate neighbours of T̂ zj . The ith component of the projected update ΦT̂ Zθ(x, a) is (ΦT̂ Zθ(x, a))i = N−1∑ j=0 [ 1− |[T̂ zj ]VMAXVMIN − zi| 4z ]1 0 pj(x ′, π(x′)),\n(7) where [·]ba bounds its argument in the range [a, b].1 As is usual, we view the next-state distribution as parametrized by a fixed parameter θ̃. The sample loss Lx,a(θ) is the cross-entropy term of the KL divergence\nDKL(ΦT̂ Zθ̃(x, a) ‖Zθ(x, a)), which is readily minimized e.g. using gradient descent. We call this choice of distribution and loss the categorical algorithm. When N = 2, a simple one-parameter alternative is ΦT̂ Zθ(x, a) := [E[T̂ Zθ(x, a)] − VMIN)/4z]10; we call this the Bernoulli algorithm. We note that, while these algorithms appear unrelated to the Wasserstein metric, recent work (Bellemare et al., 2017) hints at a deeper connection.\nAlgorithm 1 Categorical Algorithm input A transition xt, at, rt, xt+1, γt ∈ [0, 1] Q(xt+1, a) := ∑ i zipi(xt+1, a)\na∗ ← arg maxaQ(xt+1, a) mi = 0, i ∈ 0, . . . , N − 1 for j ∈ 0, . . . , N − 1 do\n# Compute the projection of T̂ zj onto the support {zi} T̂ zj ← [rt + γtzj ]VMAXVMIN bj ← (T̂ zj − VMIN)/∆z # bj ∈ [0, N − 1] l← bbjc, u← dbje # Distribute probability of T̂ zj ml ← ml + pj(xt+1, a∗)(u− bj) mu ← mu + pj(xt+1, a∗)(bj − l) end for output −∑imi log pi(xt, at) # Cross-entropy loss"
    }, {
      "heading" : "5. Evaluation on Atari 2600 Games",
      "text" : "To understand the approach in a complex setting, we applied the categorical algorithm to games from the Ar-\n1Algorithm 1 computes this projection in time linear in N .\ncade Learning Environment (ALE; Bellemare et al., 2013). While the ALE is deterministic, stochasticity does occur in a number of guises: 1) from state aliasing, 2) learning from a nonstationary policy, and 3) from approximation errors. We used five training games (Fig 3) and 52 testing games.\nFor our study, we use the DQN architecture (Mnih et al., 2015), but output the atom probabilities pi(x, a) instead of action-values, and chose VMAX = −VMIN = 10 from preliminary experiments over the training games. We call the resulting architecture Categorical DQN. We replace the squared loss (r + γQ(x′, π(x′)) − Q(x, a))2 by Lx,a(θ) and train the network to minimize this loss.2 As in DQN, we use a simple -greedy policy over the expected actionvalues; we leave as future work the many ways in which an agent could select actions on the basis of the full distribution. The rest of our training regime matches Mnih et al.’s, including the use of a target network for θ̃.\nFigure 4 illustrates the typical value distributions we observed in our experiments. In this example, three actions (those including the button press) lead to the agent releasing its laser too early and eventually losing the game. The corresponding distributions reflect this: they assign a significant probability to 0 (the terminal value). The safe actions have similar distributions (LEFT, which tracks the invaders’ movement, is slightly favoured). This example helps explain why our approach is so successful: the distributional update keeps separated the low-value, “losing” event from the high-value, “survival” event, rather than average them into one (unrealizable) expectation.3\nOne surprising fact is that the distributions are not concentrated on one or two values, in spite of the ALE’s determinism, but are often close to Gaussians. We believe this is due to our discretizing the diffusion process induced by γ."
    }, {
      "heading" : "5.1. Varying the Number of Atoms",
      "text" : "We began by studying our algorithm’s performance on the training games in relation to the number of atoms (Figure 3). For this experiment, we set = 0.05. From the data, it is clear that using too few atoms can lead to poor behaviour, and that more always increases performance; this is not immediately obvious as we may have expected to saturate the network capacity. The difference in performance between the 51-atom version and DQN is particularly striking: the latter is outperformed in all five games, and in SEAQUEST we attain state-of-the-art performance. As an additional point of the comparison, the single-parameter Bernoulli algorithm performs better than DQN in 3 games out of 5, and is most notably more robust in ASTERIX.\n2For N = 51, our TensorFlow implementation trains at roughly 75% of DQN’s speed.\n3Video: http://youtu.be/yFBwyPuO2Vg.\nOne interesting outcome of this experiment was to find out that our method does pick up on stochasticity. PONG exhibits intrinsic randomness: the exact timing of the reward depends on internal registers and is truly unobservable. We see this clearly reflected in the agent’s prediction (Figure 5): over five consecutive frames, the value distribution shows two modes indicating the agent’s belief that it has yet to receive a reward. Interestingly, since the agent’s state does not include past rewards, it cannot even extinguish the prediction after receiving the reward, explaining the relative proportions of the modes."
    }, {
      "heading" : "5.2. State-of-the-Art Results",
      "text" : "The performance of the 51-atom agent (from here onwards, C51) on the training games, presented in the last section, is particularly remarkable given that it involved none of the other algorithmic ideas present in state-of-the-art agents. We next asked whether incorporating the most common hyperparameter choice, namely a smaller training , could lead to even better results. Specifically, we set = 0.01 (instead of 0.05); furthermore, every 1 million frames, we\nevaluate our agent’s performance with = 0.001.\nWe compare our algorithm to DQN ( = 0.01), Double DQN (van Hasselt et al., 2016), the Dueling architecture (Wang et al., 2016), and Prioritized Replay (Schaul et al., 2016), comparing the best evaluation score achieved during training. We see that C51 significantly outperforms these other algorithms (Figures 6 and 7). In fact, C51 surpasses the current state-of-the-art by a large margin in a number of games, most notably SEAQUEST. One particularly striking fact is the algorithm’s good performance on sparse reward games, for example VENTURE and PRIVATE EYE. This suggests that value distributions are better able to propagate rarely occurring events. Full results are provided in the appendix.\nWe also include in the appendix (Figure 12) a comparison, averaged over 3 seeds, showing the number of games in which C51’s training performance outperforms fullytrained DQN and human players. These results continue to show dramatic improvements, and are more representative of an agent’s average performance. Within 50 million frames, C51 has outperformed a fully trained DQN agent on 45 out of 57 games. This suggests that the full 200 million training frames, and its ensuing computational cost, are unnecessary for evaluating reinforcement learning algorithms within the ALE.\nThe most recent version of the ALE contains a stochastic execution mechanism designed to ward against trajectory overfitting.Specifically, on each frame the environment rejects the agent’s selected action with probability p = 0.25. Although DQN is mostly robust to stochastic execution, there are a few games in which its performance is reduced. On a score scale normalized with respect to the random and DQN agents, C51 obtains mean and median score improvements of 126% and 21.5% respectively, confirming the benefits of C51 beyond the deterministic setting."
    }, {
      "heading" : "6. Discussion",
      "text" : "In this work we sought a more complete picture of reinforcement learning, one that involves value distributions. We found that learning value distributions is a powerful notion that allows us to surpass most gains previously made on Atari 2600, without further algorithmic adjustments."
    }, {
      "heading" : "6.1. Why does learning a distribution matter?",
      "text" : "It is surprising that, when we use a policy which aims to maximize expected return, we should see any difference in performance. The distinction we wish to make is that learning distributions matters in the presence of approximation. We now outline some possible reasons.\nReduced chattering. Our results from Section 3.4 highlighted a significant instability in the Bellman optimality operator. When combined with function approximation, this instability may prevent the policy from converging, what Gordon (1995) called chattering. We believe the gradient-based categorical algorithm is able to mitigate these effects by effectively averaging the different distri-\n† The UNREAL results are not altogether comparable, as they were generated in the asynchronous setting with per-game hyperparameter tuning (Jaderberg et al., 2017).\nbutions, similar to conservative policy iteration (Kakade & Langford, 2002). While the chattering persists, it is integrated to the approximate solution.\nState aliasing. Even in a deterministic environment, state aliasing may result in effective stochasticity. McCallum (1995), for example, showed the importance of coupling representation learning with policy learning in partially observable domains. We saw an example of state aliasing in PONG, where the agent could not exactly predict the reward timing. Again, by explicitly modelling the resulting distribution we provide a more stable learning target.\nA richer set of predictions. A recurring theme in artificial intelligence is the idea of an agent learning from a multitude of predictions (Caruana 1997; Utgoff & Stracuzzi 2002; Sutton et al. 2011; Jaderberg et al. 2017). The distributional approach naturally provides us with a rich set of auxiliary predictions, namely: the probability that the return will take on a particular value. Unlike previously proposed approaches, however, the accuracy of these predictions is tightly coupled with the agent’s performance.\nFramework for inductive bias. The distributional perspective on reinforcement learning allows a more natural framework within which we can impose assumptions about the domain or the learning problem itself. In this work we used distributions with support bounded in [VMIN, VMAX]. Treating this support as a hyperparameter allows us to change the optimization problem by treating all extremal returns (e.g. greater than VMAX) as equivalent. Surprisingly, a similar value clipping in DQN significantly degrades performance in most games. To take another example: interpreting the discount factor γ as a proper probability, as some authors have argued, leads to a different algorithm.\nWell-behaved optimization. It is well-accepted that the KL divergence between categorical distributions is a reasonably easy loss to minimize. This may explain some of our empirical performance. Yet early experiments with alternative losses, such as KL divergence between continuous densities, were not fruitful, in part because the KL divergence is insensitive to the values of its outcomes. A closer minimization of the Wasserstein metric should yield even better results than what we presented here.\nIn closing, we believe our results highlight the need to account for distribution in the design, theoretical or otherwise, of algorithms."
    }, {
      "heading" : "Acknowledgements",
      "text" : "The authors acknowledge the important role played by their colleagues at DeepMind throughout the development of this work. Special thanks to Yee Whye Teh, Alex Graves, Joel Veness, Guillaume Desjardins, Tom Schaul, David Silver, Andre Barreto, Max Jaderberg, Mohammad Azar, Georg Ostrovski, Bernardo Avila Pires, Olivier Pietquin, Audrunas Gruslys, Tom Stepleton, Aaron van den Oord; and particularly Chris Maddison for his comprehensive review of an earlier draft. Thanks also to Marek Petrik for pointers to the relevant literature, and Mark Rowland for fine-tuning details in the final version.\nErratum The camera-ready copy of this paper incorrectly reported a mean score of 1010% for C51. The corrected figure stands at 701%, which remains higher than the other comparable baselines. The median score remains unchanged at 178%.\nThe error was due to evaluation episodes in one game (Atlantis) lasting over 30 minutes; in comparison, the other results presented here cap episodes at 30 minutes, as is standard. The previously reported score on Atlantis was 3.7 million; our 30-minute score is 841,075, which we believe is close to the achievable maximum in this time frame. Capping at 30 minutes brings our human-normalized score on Atlantis from 22824% to a mere (!) 5199%, unfortunately enough to noticeably affect the mean score, whose sensitivity to outliers is well-documented."
    }, {
      "heading" : "A. Related Work",
      "text" : "To the best of our knowledge, the work closest to ours are two papers (Morimura et al., 2010b;a) studying the distributional Bellman equation from the perspective of its cumulative distribution functions. The authors propose both parametric and nonparametric solutions to learn distributions for risk-sensitive reinforcement learning. They also provide some theoretical analysis for the policy evaluation setting, including a consistency result in the nonparametric case. By contrast, we also analyze the control setting, and emphasize the use of the distributional equations to improve approximate reinforcement learning.\nThe variance of the return has been extensively studied in the risk-sensitive setting. Of note, Tamar et al. (2016) analyze the use of linear function approximation to learn this variance for policy evaluation, and Prashanth & Ghavamzadeh (2013) estimate the return variance in the design of a risk-sensitive actor-critic algorithm. Mannor & Tsitsiklis (2011) provides negative results regarding the computation of a variance-constrained solution to the optimal control problem.\nThe distributional formulation also arises when modelling uncertainty. Dearden et al. (1998) considered a Gaussian approximation to the value distribution, and modelled the uncertainty over the parameters of this approximation using a Normal-Gamma prior. Engel et al. (2005) leveraged the distributional Bellman equation to define a Gaussian process over the unknown value function. More recently, Geist & Pietquin (2010) proposed an alternative solution to the same problem based on unscented Kalman filters. We believe much of the analysis we provide here, which deals with the intrinsic randomness of the environment, can also be applied to modelling uncertainty.\nOur work here is based on a number of foundational results, in particular concerning alternative optimality criteria. Early on, Jaquette (1973) showed that a moment optimality criterion, which imposes a total ordering on distributions, is achievable and defines a stationary optimal policy, echoing the second part of Theorem 1. Sobel (1982) is usually cited as the first reference to Bellman equations for the higher moments (but not the distribution) of the return. Chung & Sobel (1987) provides results concerning the convergence of the distributional Bellman operator in total variation distance. White (1988) studies “nonstandard MDP criteria” from the perspective of optimizing the stateaction pair occupancy.\nA number of probabilistic frameworks for reinforcement learning have been proposed in recent years. The planning as inference approach (Toussaint & Storkey, 2006; Hoffman et al., 2009) embeds the return into a graphical model, and applies probabilistic inference to determine the\nsequence of actions leading to maximal expected reward. Wang et al. (2008) considered the dual formulation of reinforcement learning, where one optimizes the stationary distribution subject to constraints given by the transition function (Puterman, 1994), in particular its relationship to linear approximation. Related to this dual is the Compress and Control algorithm Veness et al. (2015), which describes a value function by learning a return distribution using density models. One of the aims of this work was to address the question left open by their work of whether one could be design a practical distributional algorithm based on the Bellman equation, rather than Monte Carlo estimation."
    }, {
      "heading" : "B. Proofs",
      "text" : "Lemma 1 (Partition lemma). Let A1, A2, . . . be a set of random variables describing a partition of Ω, i.e. Ai(ω) ∈ {0, 1} and for any ω there is exactly one Ai with Ai(ω) = 1. Let U, V be two random variables. Then\ndp ( U, V ) ≤ ∑\ni dp(AiU,AiV ).\nProof. We will give the proof for p < ∞, noting that the same applies to p = ∞. Let Yi D := AiU and Zi D := AiV , respectively. First note that\ndpp(AiU,AiV ) = inf Yi,Zi\nE [ |Yi − Zi|p ] = inf Yi,Zi E [ E [ |Yi − Zi|p |Ai ]] .\nNow, |AiU −AiV |p = 0 whenever Ai = 0. It follows that we can choose Yi, Zi so that also |Yi − Zi|p = 0 whenever Ai = 0, without increasing the expected norm. Hence\ndpp(AiU,AiV ) =\ninf Yi,Zi\nPr{Ai = 1}E [ |Yi − Zi|p |Ai = 1 ] . (8)\nNext, we claim that\ninf U,V ∑ i Pr{Ai = 1}E [∣∣AiU −AiV ∣∣p |Ai = 1] (9) ≤ inf\nY1,Y2,... Z1,Z2,...\n∑ i Pr{Ai = 1}E [ |Yi − Zi ∣∣p |Ai = 1]. Specifically, the left-hand side of the equation is an infimum over all r.v.’s whose cumulative distributions are FU and FV , respectively, while the right-hand side is an infimum over sequences of r.v’s Y1, Y2, . . . and Z1, Z2, . . . whose cumulative distributions are FAiU , FAiV , respectively. To prove this upper bound, consider the c.d.f. of U :\nFU (y) = Pr{U ≤ y} = ∑\ni Pr{Ai = 1}Pr{U ≤ y |Ai = 1} = ∑\ni Pr{Ai = 1}Pr{AiU ≤ y |Ai = 1}.\nHence the distribution FU is equivalent, in an almost sure sense, to one that first picks an element Ai of the partition, then picks a value for U conditional on the choice Ai. On the other hand, the c.d.f. of Yi D = AiU is\nFAiU (y) = Pr{Ai = 1}Pr{AiU ≤ y |Ai = 1} + Pr{Ai = 0}Pr{AiU ≤ y |Ai = 0}\n= Pr{Ai = 1}Pr{AiU ≤ y |Ai = 1} + Pr{Ai = 0}I [y ≥ 0] .\nThus the right-hand side infimum in (9) has the additional constraint that it must preserve the conditional c.d.fs, in particular when y ≥ 0. Put another way, instead of having the freedom to completely reorder the mapping U : Ω → R, we can only reorder it within each element of the partition. We now write\ndpp(U, V ) = inf U,V ‖U − V ‖p\n= inf U,V\nE [ |U − V |p ] (a) = inf\nU,V ∑ i Pr{Ai = 1}E [ |U − V |p |Ai = 1 ] = inf U,V ∑ i Pr{Ai = 1}E [ |AiU −AiV |p |Ai = 1 ] ,\nwhere (a) follows because A1, A2, . . . is a partition. Using (9), this implies\ndpp(U, V )\n= inf U,V ∑ i Pr{Ai = 1}E [∣∣AiU −AiV ∣∣p |Ai = 1] ≤ inf\nY1,Y2,... Z1,Z2,...\n∑ i Pr{Ai = 1}E [∣∣Yi − Zi∣∣p |Ai = 1] (b) = ∑\ni inf Yi,Zi\nPr{Ai = 1}E [∣∣Yi − Zi∣∣p |Ai = 1]\n(c) = ∑\ni dp(AiU,AiV ),\nbecause in (b) the individual components of the sum are independently minimized; and (c) from (8).\nLemma 2. d̄p is a metric over value distributions.\nProof. The only nontrivial property is the triangle inequality. For any value distribution Y ∈ Z , write\nd̄p(Z1, Z2) = sup x,a dp(Z1(x, a), Z2(x, a))\n(a) ≤ sup x,a [dp(Z1(x, a), Y (x, a)) + dp(Y (x, a), Z2(x, a))]\n≤ sup x,a dp(Z1(x, a), Y (x, a)) + sup x,a dp(Y (x, a), Z2(x, a))\n= d̄p(Z1, Y ) + d̄p(Y,Z2),\nwhere in (a) we used the triangle inequality for dp.\nLemma 3. T π : Z → Z is a γ-contraction in d̄p.\nProof. Consider Z1, Z2 ∈ Z . By definition,\nd̄p(T πZ1, T πZ2) = sup x,a dp(T πZ1(x, a), T πZ2(x, a)). (10)\nBy the properties of dp, we have\ndp(T πZ1(x, a), T πZ2(x, a)) = dp(R(x, a) + γP πZ1(x, a), R(x, a) + γP πZ2(x, a))\n≤ γdp(PπZ1(x, a), PπZ2(x, a)) ≤ γ sup\nx′,a′ dp(Z1(x\n′, a′), Z2(x ′, a′)),\nwhere the last line follows from the definition of Pπ (see (4)). Combining with (10) we obtain\nd̄p(T πZ1, T πZ2) = sup x,a dp(T πZ1(x, a), T πZ2(x, a))\n≤ γ sup x′,a′ dp(Z1(x ′, a′), Z2(x ′, a′))\n= γd̄p(Z1, Z2).\nProposition 1 (Sobel, 1982). Consider two value distributions Z1, Z2 ∈ Z , and write V(Zi) to be the vector of variances of Zi. Then\n‖E T πZ1 − E T πZ2‖∞ ≤ γ ‖EZ1 − EZ2‖∞ , and ‖V(T πZ1)− V(T πZ2)‖∞ ≤ γ2 ‖VZ1 − VZ2‖∞ .\nProof. The first statement is standard, and its proof follows from E T πZ = T π EZ, where the second T π denotes the usual operator over value functions. Now, by independence of R and PπZi:\nV(T πZi(x, a)) = V ( R(x, a) + γPπZi(x, a) ) = V(R(x, a)) + γ2V(PπZi(x, a)).\nAnd now\n‖V(T πZ1)− V(T πZ2)‖∞ = sup\nx,a ∣∣V(T πZ1(x, a))− V(T πZ2(x, a))∣∣ = sup\nx,a γ2 ∣∣ [V(PπZ1(x, a))− V(PπZ2(x, a))] ∣∣\n= sup x,a\nγ2 ∣∣E [V(Z1(X ′, A′))− V(Z2(X ′, A′))] ∣∣\n≤ sup x′,a′\nγ2 ∣∣V(Z1(x′, a′))− V(Z2(x′, a′))∣∣\n≤ γ2 ‖VZ1 − VZ2‖∞ .\nLemma 4. Let Z1, Z2 ∈ Z . Then\n‖E T Z1 − E T Z2‖∞ ≤ γ ‖EZ1 − EZ2‖∞ ,\nand in particular EZk → Q∗ exponentially quickly.\nProof. The proof follows by linearity of expectation. Write TD for the distributional operator and TE for the usual operator. Then\n‖E TDZ1 − E TDZ2‖∞ = ‖TE EZ1 − TE EZ2‖∞ ≤ γ ‖Z1 − Z2‖∞ .\nTheorem 1 (Convergence in the control setting). Let Zk := T Zk−1 with Z0 ∈ Z . Let X be measurable and suppose that A is finite. Then\nlim k→∞ inf Z∗∗∈Z∗∗\ndp(Zk(x, a), Z ∗∗(x, a)) = 0 ∀x, a.\nIf X is finite, then Zk converges to Z∗∗ uniformly. Furthermore, if there is a total ordering≺ on Π∗, such that for any Z∗ ∈ Z∗,"
    }, {
      "heading" : "T Z∗ = T πZ∗ with π ∈ GZ∗ , π ≺ π′ ∀π′ ∈ GZ∗ \\ {π},",
      "text" : "then T has a unique fixed point Z∗ ∈ Z∗.\nThe gist of the proof of Theorem 1 consists in showing that for every state x, there is a time k after which the greedy policy w.r.t. Qk is mostly optimal. To clearly expose the steps involved, we will first assume a unique (and therefore deterministic) optimal policy π∗, and later return to the general case; we will denote the optimal action at x by π∗(x). For notational convenience, we will write Qk := EZk and Gk := GZk . Let B := 2 supZ∈Z ‖Z‖∞ < ∞ and let k := γkB. We first define the set of states Xk ⊆ X whose values must be sufficiently close to Q∗ at time k:\nXk := { x : Q∗(x, π∗(x))− max\na 6=π∗(x) Q∗(x, a) > 2 k\n} .\n(11) Indeed, by Lemma 4, we know that after k iterations\n|Qk(x, a)−Q∗(x, a)| ≤ γk|Q0(x, a)−Q∗(x, a)| ≤ k.\nFor x ∈ X , write a∗ := π∗(x). For any a ∈ A, we deduce that\nQk(x, a ∗)−Qk(x, a) ≥ Q∗(x, a∗)−Q∗(x, a)− 2 k.\nIt follows that if x ∈ Xk, then also Qk(x, a∗) > Qk(x, a′) for all a′ 6= π∗(x): for these states, the greedy policy πk(x) := arg maxaQk(x, a) corresponds to the optimal policy π∗.\nLemma 5. For each x ∈ X there exists a k such that, for all k′ ≥ k, x ∈ Xk′ , and in particular arg maxaQk(x, a) = π ∗(x).\nProof. Because A is finite, the gap\n∆(x) := Q∗(x, π∗(x))− max a 6=π∗(x) Q∗(x, a)\nis attained for some strictly positive ∆(x) > 0. By definition, there exists a k such that\nk = γ kB <\n∆(x)\n2 ,\nand hence every x ∈ X must eventually be in Xk.\nThis lemma allows us to guarantee the existence of an iteration k after which sufficiently many states are wellbehaved, in the sense that the greedy policy at those states chooses the optimal action. We will call these states “solved”. We in fact require not only these states to be solved, but also most of their successors, and most of the successors of those, and so on. We formalize this notion as follows: fix some δ > 0, let Xk,0 := Xk, and define for i > 0 the set\nXk,i := { x : x ∈ Xk, P (Xk−1,i−1 |x, π∗(x)) ≥ 1− δ } ,\nAs the following lemma shows, any x is eventually contained in the recursively-defined sets Xk,i, for any i. Lemma 6. For any i ∈ N and any x ∈ X , there exists a k such that for all k′ ≥ k, x ∈ Xk′,i.\nProof. Fix i and let us suppose that Xk,i ↑ X . By Lemma 5, this is true for i = 0. We infer that for any probability measure P on X , P (Xk,i)→ P (X ) = 1. In particular, for a given x ∈ Xk, this implies that\nP (Xk,i |x, π∗(x))→ P (X |x, π∗(x)) = 1.\nTherefore, for any x, there exists a time after which it is and remains a member ofXk,i+1, the set of states for which P (Xk−1,i |x, π∗(x)) ≥ 1 − δ. We conclude that Xk,i+1 ↑ X also. The statement follows by induction.\nProof of Theorem 1. The proof is similar to policy iteration-type results, but requires more care in dealing with the metric and the possibly infinite state space. We will write Wk(x) := Zk(x, πk(x)), define W ∗ similarly and with some overload of notation write TWk(x) := Wk+1(x) = T Zk(x, πk+1(x)). Finally, let Ski (x) := I [x ∈ Xk,i] and S̄ki (x) = 1− Ski (x). Fix i > 0 and x ∈ Xk+1,i+1 ⊆ Xk. We begin by using Lemma 1 to separate the transition from x into a solved term and an unsolved term:\nPπkWk(x) = S k iWk(X ′) + S̄kiWk(X ′),\nwhere X ′ is the random successor from taking action πk(x) := π ∗(x), and we write Ski = S k i (X\n′), S̄ki = S̄ki (X ′) to ease the notation. Similarly,\nPπkW ∗(x) = SkiW ∗(X ′) + S̄kiW ∗(X ′).\nNow\ndp(Wk+1(x),W ∗(x)) = dp(TWk(x), TW ∗(x))\n(a) ≤ γdp(PπkWk(x), Pπ ∗ W ∗(x))\n(b) ≤ γdp(SkiWk(X ′), SkiW ∗(X ′)) + γdp(S̄ k iWk(X ′), S̄kiW ∗(X ′)), (12)\nwhere in (a) we used Properties P1 and P2 of the Wasserstein metric, and in (b) we separate states for which πk = π∗ from the rest using Lemma 1 ({Ski , S̄ki } form a partition of Ω). Let δi := Pr{X ′ /∈ Xk,i} = E{S̄ki (X ′)} = ‖S̄ki (X ′)‖p. From property P3 of the Wasserstein metric, we have\ndp(S̄ k iWk(X ′), S̄kiW ∗(X ′))\n≤ sup x′ dp(S̄ k i (X ′)Wk(x ′), S̄ki (X ′)W ∗(x′)) ≤ ‖S̄ki (X ′)‖p sup x′ dp(Wk(x ′),W ∗(x′)) ≤ δi sup x′ dp(Wk(x ′),W ∗(x′)) ≤ δiB.\nRecall that B < ∞ is the largest attainable ‖Z‖∞. Since also δi < δ by our choice of x ∈ Xk+1,i+1, we can upper bound the second term in (12) by γδB. This yields\ndp(Wk+1(x),W ∗(x)) ≤\nγdp(S k iWk(X ′), SkiW ∗(X ′)) + γδB.\nBy induction on i > 0, we conclude that for x ∈ Xk+i,i and some random state X ′′ i steps forward,\ndp(Wk+i(x),W ∗(x)) ≤\nγidp(S k 0Wk(X ′′), Sk0W ∗(X ′′)) +\nδB\n1− γ\n≤ γiB + δB 1− γ .\nHence for any x ∈ X , > 0, we can take δ, i, and finally k large enough to make dp(Wk(x),W ∗(x)) < . The proof then extends to Zk(x, a) by considering one additional application of T . We now consider the more general case where there are multiple optimal policies. We expand the definition of Xk,i as follows:\nXk,i := { x ∈ Xk : ∀π∗ ∈ Π∗, E\na∗∼π∗(x) P (Xk−1,i−1 |x, a∗) ≥ 1−δ\n} ,\nBecause there are finitely many actions, Lemma 6 also holds for this new definition. As before, take x ∈ Xk,i, but now consider the sequence of greedy policies πk, πk−1, . . . selected by successive applications of T , and write\nT π̄k := T πkT πk−1 · · · T πk−i+1 ,\nsuch that Zk+1 = T π̄kZk−i+1.\nNow denote by Z∗∗ the set of nonstationary optimal policies. If we take any Z∗ ∈ Z∗, we deduce that\ninf Z∗∗∈Z∗∗\ndp(T π̄kZ∗(x, a), Z∗∗(x, a)) ≤ δB\n1− γ ,\nsince Z∗ corresponds to some optimal policy π∗ and π̄k is optimal along most of the trajectories from (x, a). In effect, T π̄kZ∗ is close to the value distribution of the nonstationary optimal policy π̄kπ∗. Now for this Z∗,\ninf Z∗∗\ndp(Zk(x, a), Z ∗∗(x, a))\n≤ dp(Zk(x, a), T π̄kZ∗(x, a)) + inf Z∗∗ dp(T π̄kZ∗(x, a), Z∗∗(x, a))\n≤ dp(T π̄kZk−i+1(x, a), T π̄kZ∗(x, a)) + δB\n1− γ\n≤ γiB + 2δB 1− γ ,\nusing the same argument as before with the newly-defined Xk,i. It follows that\ninf Z∗∗∈Z∗∗\ndp(Zk(x, a), Z ∗∗(x, a))→ 0.\nWhen X is finite, there exists a fixed k after which Xk = X . The uniform convergence result then follows. To prove the uniqueness of the fixed point Z∗ when T selects its actions according to the ordering ≺, we note that for any optimal value distribution Z∗, its set of greedy policies is Π∗. Denote by π∗ the policy coming first in the ordering over Π∗. Then T = T π∗ , which has a unique fixed point (Section 3.3).\nProposition 4. That T has a fixed point Z∗ = T Z∗ is insufficient to guarantee the convergence of {Zk} to Z∗.\nWe provide here a sketch of the result. Consider a single state x1 with two actions, a1 and a2 (Figure 8). The first action yields a reward of 1/2, while the other either yields 0 or 1 with equal probability, and both actions are optimal. Now take γ = 1/2 and write R0, R1, . . . for the received rewards. Consider a stochastic policy that takes action a2 with probability p. For p = 0, the return is\nZp=0 = 1 1− γ 1 2 = 1.\nFor p = 1, on the other hand, the return is random and is given by the following fractional number (in binary):\nZp=1 = R0.R1R2R3 · · · .\nAs a result, Zp=1 is uniformly distributed between 0 and 2! In fact, note that\nZp=0 = 0.11111 · · · = 1.\nFor some intermediary value of p, we obtain a different probability of the different digits, but always putting some probability mass on all returns in [0, 2].\nNow suppose we follow the nonstationary policy that takes a1 on the first step, then a2 from there on. By inspection, the return will be uniformly distributed on the interval [1/2, 3/2], which does not correspond to the return under any value of p. But now we may imagine an operator T which alternates between a1 and a2 depending on the exact value distribution it is applied to, which would in turn converge to a nonstationary optimal value distribution.\nLemma 7 (Sample Wasserstein distance). Let {Pi} be a collection of random variables, I ∈ N a random index independent from {Pi}, and consider the mixture random variable P = PI . For any random variable Q independent of I ,\ndp(P,Q) ≤ E i∼I dp(Pi, Q),\nand in general the inequality is strict and\n∇Qdp(PI , Q) 6= E i∼I ∇Qdp(Pi, Q).\nProof. We prove this using Lemma 1. Let Ai := I [I = i]. We write\ndp(P,Q) = dp(PI , Q)\n= dp (∑ i AiPi, ∑ i AiQ ) ≤ ∑\ni dp(AiPi, AiQ) ≤ ∑\ni Pr{I = i}dp(Pi, Q)\n= EI dP (Pi, Q).\nwhere in the penultimate line we used the independence of I from Pi andQ to appeal to property P3 of the Wasserstein metric.\nTo show that the bound is in general strict, consider the mixture distribution depicted in Figure 9. We will simply\nconsider the d1 metric between this distribution P and another distribution Q. The first distribution is\nP = { 0 w.p. 1/2 1 w.p. 1/2.\nIn this example, i ∈ {1, 2}, P1 = 0, and P2 = 1. Now consider the distribution with the same support but that puts probability p on 0:\nQ = { 0 w.p. p 1 w.p. 1− p.\nThe distance between P and Q is\nd1(P,Q) = |p− 12 |.\nThis is d1(P,Q) = 12 for p ∈ {0, 1}, and strictly less than 1 2 for any other values of p. On the other hand, the corresponding expected distance (after sampling an outcome x1 or x2 with equal probability) is\nEI d1(Pi, Q) = 12p+ 1 2 (1− p) = 12 .\nHence d1(P,Q) < EI d1(Pi, Q) for p ∈ (0, 1). This shows that the bound is in general strict. By inspection, it is clear that the two gradients are different.\nProposition 5. Fix some next-state distribution Z and policy π. Consider a parametric value distribution Zθ, and and define the Wasserstein loss\nLW (θ) := dp(Zθ(x, a), R(x, a) + γZ(X ′, π(X ′))).\nLet r ∼ R(x, a) and x′ ∼ P (· |x, a) and consider the sample loss\nLW (θ, r, x ′) := dp(Zθ(x, a), r + γZ(x ′, π(x′)).\nIts expectation is an upper bound on the loss LW :\nLW (θ) ≤ E R,P LW (θ, r, x ′),\nin general with strict inequality.\nThe result follows directly from the previous lemma."
    }, {
      "heading" : "C. Algorithmic Details",
      "text" : "While our training regime closely follows that of DQN (Mnih et al., 2015), we use Adam (Kingma & Ba, 2015) instead of RMSProp (Tieleman & Hinton, 2012) for gradient rescaling. We also performed some hyperparameter tuning for our final results. Specifically, we evaluated two hyperparameters over our five training games and choose the values that performed best. The hyperparameter values we considered were VMAX ∈ {3, 10, 100} and adam ∈ {1/L, 0.1/L, 0.01/L, 0.001/L, 0.0001/L}, where L = 32 is the minibatch size. We found VMAX = 10 and adam = 0.01/L performed best. We used the same step-size value as DQN (α = 0.00025).\nPseudo-code for the categorical algorithm is given in Algorithm 1. We apply the Bellman update to each atom separately, and then project it into the two nearest atoms in the original support. Transitions to a terminal state are handled with γt = 0."
    }, {
      "heading" : "D. Comparison of Sampled Wasserstein Loss and Categorical Projection",
      "text" : "Lemma 3 proves that for a fixed policy π the distributional Bellman operator is a γ-contraction in d̄p, and therefore that T π will converge in distribution to the true distribution of returns Zπ . In this section, we empirically validate these results on the CliffWalk domain shown in Figure 11. The dynamics of the problem match those given by Sutton & Barto (1998). We also study the convergence of the distributional Bellman operator under the sampled Wasserstein loss and the categorical projection (Equation 7) while fol-\nlowing a policy that tries to take the safe path but has a 10% chance of taking another action uniformly at random.\nWe compute a ground-truth distribution of returnsZπ using 10000 Monte-Carlo (MC) rollouts from each state. We then perform two experiments, approximating the value distribution at each state with our discrete distributions.\nIn the first experiment, we perform supervised learning using either the Wasserstein loss or categorical projection (Equation 7) with cross-entropy loss. We use Zπ as the supervised target and perform 5000 sweeps over all states to ensure both approaches have converged. In the second experiment, we use the same loss functions, but the training target comes from the one-step distributional Bellman operator with sampled transitions. We use VMIN = −100 and VMAX = −1.4 For the sample updates we perform 10 times as many sweeps over the state space. Fundamentally, these experiments investigate how well the two training regimes\n4Because there is a small probability of larger negative returns, some approximation error is unavoidable. However, this effect is relatively negligible in our experiments.\n(minimizing the Wasserstein or categorical loss) minimize the Wasserstein metric under both ideal (supervised target) and practical (sampled one-step Bellman target) conditions.\nIn Figure 10a we show the final Wasserstein distance d1(Z\nπ, Zθ) between the learned distributions and the ground-truth distribution as we vary the number of atoms. The graph shows that the categorical algorithm does indeed minimize the Wasserstein metric in both the supervised and sample Bellman setting. It also highlights that minimizing the Wasserstein loss with stochastic gradient descent is in general flawed, confirming the intuition given by Proposition 5. In repeat experiments the process converged to different values of d1(Zπ, Zθ), suggesting the presence of local minima (more prevalent with fewer atoms).\nFigure 10 provides additional insight into why the sampled Wasserstein distance may perform poorly. Here, we see the cumulative densities for the approximations learned under these two losses for five different states along the safe path in CliffWalk. The Wasserstein has converged to a fixedpoint distribution, but not one that captures the true (Monte Carlo) distribution very well. By comparison, the categorical algorithm captures the variance of the true distribution much more accurately."
    }, {
      "heading" : "E. Supplemental Videos and Results",
      "text" : "In Figure 13 we provide links to supplemental videos showing the C51 agent during training on various Atari 2600 games. Figure 12 shows the relative performance of C51 over the course of training. Figure 14 provides a table of evaluation results, comparing C51 to other state-of-theart agents. Figures 15–18 depict particularly interesting frames."
    } ],
    "references" : [ {
      "title" : "On the sample complexity of reinforcement learning with a generative model",
      "author" : [ "Azar", "Mohammad Gheshlaghi", "Munos", "Rémi", "Kappen", "Hilbert" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Azar et al\\.,? \\Q2012\\E",
      "shortCiteRegEx" : "Azar et al\\.",
      "year" : 2012
    }, {
      "title" : "The arcade learning environment: An evaluation platform for general agents",
      "author" : [ "Bellemare", "Marc G", "Naddaf", "Yavar", "Veness", "Joel", "Bowling", "Michael" ],
      "venue" : "Journal of Artificial Intelligence Research,",
      "citeRegEx" : "Bellemare et al\\.,? \\Q2013\\E",
      "shortCiteRegEx" : "Bellemare et al\\.",
      "year" : 2013
    }, {
      "title" : "The cramer distance as a solution to biased wasserstein gradients",
      "author" : [ "Bellemare", "Marc G", "Danihelka", "Ivo", "Dabney", "Will", "Mohamed", "Shakir", "Lakshminarayanan", "Balaji", "Hoyer", "Stephan", "Munos", "Rémi" ],
      "venue" : null,
      "citeRegEx" : "Bellemare et al\\.,? \\Q2017\\E",
      "shortCiteRegEx" : "Bellemare et al\\.",
      "year" : 2017
    }, {
      "title" : "Dynamic programming",
      "author" : [ "Bellman", "Richard E" ],
      "venue" : null,
      "citeRegEx" : "Bellman and E.,? \\Q1957\\E",
      "shortCiteRegEx" : "Bellman and E.",
      "year" : 1957
    }, {
      "title" : "Some asymptotic theory for the bootstrap",
      "author" : [ "Bickel", "Peter J", "Freedman", "David A" ],
      "venue" : "The Annals of Statistics,",
      "citeRegEx" : "Bickel et al\\.,? \\Q1981\\E",
      "shortCiteRegEx" : "Bickel et al\\.",
      "year" : 1981
    }, {
      "title" : "Probability and measure",
      "author" : [ "Billingsley", "Patrick" ],
      "venue" : null,
      "citeRegEx" : "Billingsley and Patrick.,? \\Q1995\\E",
      "shortCiteRegEx" : "Billingsley and Patrick.",
      "year" : 1995
    }, {
      "title" : "Multitask learning",
      "author" : [ "Caruana", "Rich" ],
      "venue" : "Machine Learning,",
      "citeRegEx" : "Caruana and Rich.,? \\Q1997\\E",
      "shortCiteRegEx" : "Caruana and Rich.",
      "year" : 1997
    }, {
      "title" : "Discounted mdps: Distribution functions and exponential utility maximization",
      "author" : [ "Chung", "Kun-Jen", "Sobel", "Matthew J" ],
      "venue" : "SIAM Journal on Control and Optimization,",
      "citeRegEx" : "Chung et al\\.,? \\Q1987\\E",
      "shortCiteRegEx" : "Chung et al\\.",
      "year" : 1987
    }, {
      "title" : "Bayesian Q-learning",
      "author" : [ "Dearden", "Richard", "Friedman", "Nir", "Russell", "Stuart" ],
      "venue" : "In Proceedings of the National Conference on Artificial Intelligence,",
      "citeRegEx" : "Dearden et al\\.,? \\Q1998\\E",
      "shortCiteRegEx" : "Dearden et al\\.",
      "year" : 1998
    }, {
      "title" : "Reinforcement learning with gaussian processes",
      "author" : [ "Engel", "Yaakov", "Mannor", "Shie", "Meir", "Ron" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Engel et al\\.,? \\Q2005\\E",
      "shortCiteRegEx" : "Engel et al\\.",
      "year" : 2005
    }, {
      "title" : "Kalman temporal differences",
      "author" : [ "Geist", "Matthieu", "Pietquin", "Olivier" ],
      "venue" : "Journal of Artificial Intelligence Research,",
      "citeRegEx" : "Geist et al\\.,? \\Q2010\\E",
      "shortCiteRegEx" : "Geist et al\\.",
      "year" : 2010
    }, {
      "title" : "Stable function approximation in dynamic programming",
      "author" : [ "Gordon", "Geoffrey" ],
      "venue" : "In Proceedings of the Twelfth International Conference on Machine Learning,",
      "citeRegEx" : "Gordon and Geoffrey.,? \\Q1995\\E",
      "shortCiteRegEx" : "Gordon and Geoffrey.",
      "year" : 1995
    }, {
      "title" : "Q(λ) with off-policy corrections",
      "author" : [ "Harutyunyan", "Anna", "Bellemare", "Marc G", "Stepleton", "Tom", "Munos", "Rémi" ],
      "venue" : "In Proceedings of the Conference on Algorithmic Learning",
      "citeRegEx" : "Harutyunyan et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Harutyunyan et al\\.",
      "year" : 2016
    }, {
      "title" : "An expectation maximization algorithm for continuous markov decision processes with arbitrary reward",
      "author" : [ "Hoffman", "Matthew D", "de Freitas", "Nando", "Doucet", "Arnaud", "Peters", "Jan" ],
      "venue" : "In Proceedings of the International Conference on Artificial Intelligence and Statistics,",
      "citeRegEx" : "Hoffman et al\\.,? \\Q2009\\E",
      "shortCiteRegEx" : "Hoffman et al\\.",
      "year" : 2009
    }, {
      "title" : "Reinforcement learning with unsupervised auxiliary tasks",
      "author" : [ "Jaderberg", "Max", "Mnih", "Volodymyr", "Czarnecki", "Wojciech Marian", "Schaul", "Tom", "Leibo", "Joel Z", "Silver", "David", "Kavukcuoglu", "Koray" ],
      "venue" : "Proceedings of the International Conference on Learning Representations,",
      "citeRegEx" : "Jaderberg et al\\.,? \\Q2017\\E",
      "shortCiteRegEx" : "Jaderberg et al\\.",
      "year" : 2017
    }, {
      "title" : "Markov decision processes with a new optimality criterion: Discrete time",
      "author" : [ "Jaquette", "Stratton C" ],
      "venue" : "The Annals of Statistics,",
      "citeRegEx" : "Jaquette and C.,? \\Q1973\\E",
      "shortCiteRegEx" : "Jaquette and C.",
      "year" : 1973
    }, {
      "title" : "Approximately optimal approximate reinforcement learning",
      "author" : [ "Kakade", "Sham", "Langford", "John" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Kakade et al\\.,? \\Q2002\\E",
      "shortCiteRegEx" : "Kakade et al\\.",
      "year" : 2002
    }, {
      "title" : "Adam: A method for stochastic optimization",
      "author" : [ "Kingma", "Diederik", "Ba", "Jimmy" ],
      "venue" : "Proceedings of the International Conference on Learning Representations,",
      "citeRegEx" : "Kingma et al\\.,? \\Q2015\\E",
      "shortCiteRegEx" : "Kingma et al\\.",
      "year" : 2015
    }, {
      "title" : "PAC bounds for discounted MDPs",
      "author" : [ "Lattimore", "Tor", "Hutter", "Marcus" ],
      "venue" : "In Proceedings of the Conference on Algorithmic Learning Theory,",
      "citeRegEx" : "Lattimore et al\\.,? \\Q2012\\E",
      "shortCiteRegEx" : "Lattimore et al\\.",
      "year" : 2012
    }, {
      "title" : "Mean-variance optimization in markov decision processes",
      "author" : [ "Mannor", "Shie", "Tsitsiklis", "John N" ],
      "venue" : null,
      "citeRegEx" : "Mannor et al\\.,? \\Q2011\\E",
      "shortCiteRegEx" : "Mannor et al\\.",
      "year" : 2011
    }, {
      "title" : "Reinforcement learning with selective perception and hidden state",
      "author" : [ "McCallum", "Andrew K" ],
      "venue" : "PhD thesis, University of Rochester,",
      "citeRegEx" : "McCallum and K.,? \\Q1995\\E",
      "shortCiteRegEx" : "McCallum and K.",
      "year" : 1995
    }, {
      "title" : "Human-level control through deep reinforcement learning",
      "author" : [ "Mnih", "Volodymyr", "Kavukcuoglu", "Koray", "Silver", "David", "Rusu", "Andrei A", "Veness", "Joel", "Bellemare", "Marc G", "Graves", "Alex", "Riedmiller", "Martin", "Fidjeland", "Andreas K", "Ostrovski", "Georg" ],
      "venue" : "Nature, 518(7540):529–533,",
      "citeRegEx" : "Mnih et al\\.,? \\Q2015\\E",
      "shortCiteRegEx" : "Mnih et al\\.",
      "year" : 2015
    }, {
      "title" : "Parametric return density estimation for reinforcement learning",
      "author" : [ "Morimura", "Tetsuro", "Hachiya", "Hirotaka", "Sugiyama", "Masashi", "Tanaka", "Toshiyuki", "Kashima", "Hisashi" ],
      "venue" : "In Proceedings of the Conference on Uncertainty in Artificial Intelligence,",
      "citeRegEx" : "Morimura et al\\.,? \\Q2010\\E",
      "shortCiteRegEx" : "Morimura et al\\.",
      "year" : 2010
    }, {
      "title" : "Nonparametric return distribution approximation for reinforcement learning",
      "author" : [ "Morimura", "Tetsuro", "Sugiyama", "Masashi", "Kashima", "Hisashi", "Hachiya", "Hirotaka", "Tanaka", "Toshiyuki" ],
      "venue" : "In Proceedings of the 27th International Conference on Machine Learning",
      "citeRegEx" : "Morimura et al\\.,? \\Q2010\\E",
      "shortCiteRegEx" : "Morimura et al\\.",
      "year" : 2010
    }, {
      "title" : "Massively parallel methods for deep reinforcement learning",
      "author" : [ "Nair", "Arun", "Srinivasan", "Praveen", "Blackwell", "Sam", "Alcicek", "Cagdas", "Fearon", "Rory", "De Maria", "Alessandro", "Panneershelvam", "Vedavyas", "Suleyman", "Mustafa", "Beattie", "Charles", "Petersen", "Stig" ],
      "venue" : "In ICML Workshop on Deep Learning,",
      "citeRegEx" : "Nair et al\\.,? \\Q2015\\E",
      "shortCiteRegEx" : "Nair et al\\.",
      "year" : 2015
    }, {
      "title" : "Actor-critic algorithms for risk-sensitive mdps",
      "author" : [ "LA Prashanth", "Ghavamzadeh", "Mohammad" ],
      "venue" : "In Advances in Neural Information Processing Systems,",
      "citeRegEx" : "Prashanth et al\\.,? \\Q2013\\E",
      "shortCiteRegEx" : "Prashanth et al\\.",
      "year" : 2013
    }, {
      "title" : "A fixed point theorem for distributions",
      "author" : [ "Rösler", "Uwe" ],
      "venue" : "Stochastic Processes and their Applications,",
      "citeRegEx" : "Rösler and Uwe.,? \\Q1992\\E",
      "shortCiteRegEx" : "Rösler and Uwe.",
      "year" : 1992
    }, {
      "title" : "Prioritized experience replay",
      "author" : [ "Schaul", "Tom", "Quan", "John", "Antonoglou", "Ioannis", "Silver", "David" ],
      "venue" : "In Proceedings of the International Conference on Learning Representations,",
      "citeRegEx" : "Schaul et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Schaul et al\\.",
      "year" : 2016
    }, {
      "title" : "The variance of discounted markov decision processes",
      "author" : [ "Sobel", "Matthew J" ],
      "venue" : "Journal of Applied Probability,",
      "citeRegEx" : "Sobel and J.,? \\Q1982\\E",
      "shortCiteRegEx" : "Sobel and J.",
      "year" : 1982
    }, {
      "title" : "Reinforcement learning: An introduction",
      "author" : [ "Sutton", "Richard S", "Barto", "Andrew G" ],
      "venue" : null,
      "citeRegEx" : "Sutton et al\\.,? \\Q1998\\E",
      "shortCiteRegEx" : "Sutton et al\\.",
      "year" : 1998
    }, {
      "title" : "Horde: A scalable real-time architecture for learning knowledge from unsupervised sensorimotor interaction",
      "author" : [ "R.S. Sutton", "J. Modayil", "M. Delp", "T. Degris", "P.M. Pilarski", "A. White", "D. Precup" ],
      "venue" : "In Proceedings of the International Conference on Autonomous Agents and Multiagents Systems,",
      "citeRegEx" : "Sutton et al\\.,? \\Q2011\\E",
      "shortCiteRegEx" : "Sutton et al\\.",
      "year" : 2011
    }, {
      "title" : "Learning the variance of the reward-to-go",
      "author" : [ "Tamar", "Aviv", "Di Castro", "Dotan", "Mannor", "Shie" ],
      "venue" : "Journal of Machine Learning Research,",
      "citeRegEx" : "Tamar et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Tamar et al\\.",
      "year" : 2016
    }, {
      "title" : "Lecture 6.5-rmsprop: Divide the gradient by a running average of its recent magnitude",
      "author" : [ "Tieleman", "Tijmen", "Hinton", "Geoffrey" ],
      "venue" : "COURSERA: Neural networks for machine learning,",
      "citeRegEx" : "Tieleman et al\\.,? \\Q2012\\E",
      "shortCiteRegEx" : "Tieleman et al\\.",
      "year" : 2012
    }, {
      "title" : "Probabilistic inference for solving discrete and continuous state markov decision processes",
      "author" : [ "Toussaint", "Marc", "Storkey", "Amos" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Toussaint et al\\.,? \\Q2006\\E",
      "shortCiteRegEx" : "Toussaint et al\\.",
      "year" : 2006
    }, {
      "title" : "On the convergence of optimistic policy iteration",
      "author" : [ "Tsitsiklis", "John N" ],
      "venue" : "Journal of Machine Learning Research,",
      "citeRegEx" : "Tsitsiklis and N.,? \\Q2002\\E",
      "shortCiteRegEx" : "Tsitsiklis and N.",
      "year" : 2002
    }, {
      "title" : "Pixel recurrent neural networks",
      "author" : [ "Van den Oord", "Aaron", "Kalchbrenner", "Nal", "Kavukcuoglu", "Koray" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Oord et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Oord et al\\.",
      "year" : 2016
    }, {
      "title" : "Deep reinforcement learning with double Q-learning",
      "author" : [ "van Hasselt", "Hado", "Guez", "Arthur", "Silver", "David" ],
      "venue" : "In Proceedings of the AAAI Conference on Artificial Intelligence,",
      "citeRegEx" : "Hasselt et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Hasselt et al\\.",
      "year" : 2016
    }, {
      "title" : "Compress and control",
      "author" : [ "Veness", "Joel", "Bellemare", "Marc G", "Hutter", "Marcus", "Chua", "Alvin", "Desjardins", "Guillaume" ],
      "venue" : "In Proceedings of the AAAI Conference on Artificial Intelligence,",
      "citeRegEx" : "Veness et al\\.,? \\Q2015\\E",
      "shortCiteRegEx" : "Veness et al\\.",
      "year" : 2015
    }, {
      "title" : "Dual representations for dynamic programming",
      "author" : [ "Wang", "Tao", "Lizotte", "Daniel", "Bowling", "Michael", "Schuurmans", "Dale" ],
      "venue" : "Journal of Machine Learning Research,",
      "citeRegEx" : "Wang et al\\.,? \\Q2008\\E",
      "shortCiteRegEx" : "Wang et al\\.",
      "year" : 2008
    }, {
      "title" : "Dueling network architectures for deep reinforcement learning",
      "author" : [ "Wang", "Ziyu", "Schaul", "Tom", "Hessel", "Matteo", "Hasselt", "Hado van", "Lanctot", "Marc", "de Freitas", "Nando" ],
      "venue" : "In Proceedings of the International Conference on Machine Learning,",
      "citeRegEx" : "Wang et al\\.,? \\Q2016\\E",
      "shortCiteRegEx" : "Wang et al\\.",
      "year" : 2016
    }, {
      "title" : "Mean, variance, and probabilistic criteria in finite markov decision processes: a review",
      "author" : [ "D.J. White" ],
      "venue" : "Journal of Optimization Theory and Applications,",
      "citeRegEx" : "White,? \\Q1988\\E",
      "shortCiteRegEx" : "White",
      "year" : 1988
    }, {
      "title" : "embeds the return into a graphical model, and applies probabilistic inference",
      "author" : [ "Hoffman" ],
      "venue" : null,
      "citeRegEx" : "Hoffman,? \\Q2009\\E",
      "shortCiteRegEx" : "Hoffman",
      "year" : 2009
    }, {
      "title" : "2015) instead of RMSProp (Tieleman & Hinton, 2012) for gradient rescaling",
      "author" : [ "Adam (Kingma", "Ba" ],
      "venue" : "(Mnih et al.,",
      "citeRegEx" : ".Kingma and Ba,? \\Q2015\\E",
      "shortCiteRegEx" : ".Kingma and Ba",
      "year" : 2015
    } ],
    "referenceMentions" : [ {
      "referenceID" : 40,
      "context" : "Although the distributional perspective is almost as old as Bellman’s equation itself (Jaquette, 1973; Sobel, 1982; White, 1988), in reinforcement learning it has thus far been subordinated to specific purposes: to model parametric uncertainty (Dearden et al.",
      "startOffset" : 86,
      "endOffset" : 128
    }, {
      "referenceID" : 8,
      "context" : "Although the distributional perspective is almost as old as Bellman’s equation itself (Jaquette, 1973; Sobel, 1982; White, 1988), in reinforcement learning it has thus far been subordinated to specific purposes: to model parametric uncertainty (Dearden et al., 1998), to design risk-sensitive algorithms (Morimura et al.",
      "startOffset" : 244,
      "endOffset" : 266
    }, {
      "referenceID" : 0,
      "context" : ", 2010b;a), or for theoretical analysis (Azar et al., 2012; Lattimore & Hutter, 2012).",
      "startOffset" : 40,
      "endOffset" : 85
    }, {
      "referenceID" : 0,
      "context" : ", 2010b;a), or for theoretical analysis (Azar et al., 2012; Lattimore & Hutter, 2012). By contrast, we believe the value distribution has a central role to play in reinforcement learning. Contraction of the policy evaluation Bellman operator. Basing ourselves on results by Rösler (1992) we show that, for a fixed policy, the Bellman operator over value distributions is a contraction in a maximal form of the Wasserstein (also called Kantorovich or Mallows) metric.",
      "startOffset" : 41,
      "endOffset" : 288
    }, {
      "referenceID" : 1,
      "context" : "We will illustrate the practical benefits of the distributional perspective in the context of the Arcade Learning Environment (Bellemare et al., 2013).",
      "startOffset" : 126,
      "endOffset" : 150
    }, {
      "referenceID" : 21,
      "context" : "By modelling the value distribution within a DQN agent (Mnih et al., 2015), we obtain considerably increased performance across the gamut of benchmark Atari 2600 games, and in fact achieve stateof-the-art performance on a number of games.",
      "startOffset" : 55,
      "endOffset" : 74
    }, {
      "referenceID" : 1,
      "context" : "We will illustrate the practical benefits of the distributional perspective in the context of the Arcade Learning Environment (Bellemare et al., 2013). By modelling the value distribution within a DQN agent (Mnih et al., 2015), we obtain considerably increased performance across the gamut of benchmark Atari 2600 games, and in fact achieve stateof-the-art performance on a number of games. Our results echo those of Veness et al. (2015), who obtained extremely fast learning by predicting Monte Carlo returns.",
      "startOffset" : 127,
      "endOffset" : 438
    }, {
      "referenceID" : 9,
      "context" : "Distributional equations have been used in reinforcement learning by Engel et al. (2005); Morimura et al.",
      "startOffset" : 69,
      "endOffset" : 89
    }, {
      "referenceID" : 9,
      "context" : "Distributional equations have been used in reinforcement learning by Engel et al. (2005); Morimura et al. (2010a) among others, and in operations research by White (1988).",
      "startOffset" : 69,
      "endOffset" : 114
    }, {
      "referenceID" : 9,
      "context" : "Distributional equations have been used in reinforcement learning by Engel et al. (2005); Morimura et al. (2010a) among others, and in operations research by White (1988).",
      "startOffset" : 69,
      "endOffset" : 171
    }, {
      "referenceID" : 12,
      "context" : "Tsitsiklis (2002) and most recently Harutyunyan et al. (2016). Let Π∗ be the set of optimal policies.",
      "startOffset" : 36,
      "endOffset" : 62
    }, {
      "referenceID" : 31,
      "context" : "Although the Gaussian case has previously been considered (Morimura et al., 2010a; Tamar et al., 2016), to the best of our knowledge we are the first to use a rich class of parametric distributions.",
      "startOffset" : 58,
      "endOffset" : 102
    }, {
      "referenceID" : 2,
      "context" : "We note that, while these algorithms appear unrelated to the Wasserstein metric, recent work (Bellemare et al., 2017) hints at a deeper connection.",
      "startOffset" : 93,
      "endOffset" : 117
    }, {
      "referenceID" : 1,
      "context" : "cade Learning Environment (ALE; Bellemare et al., 2013).",
      "startOffset" : 26,
      "endOffset" : 55
    }, {
      "referenceID" : 21,
      "context" : "For our study, we use the DQN architecture (Mnih et al., 2015), but output the atom probabilities pi(x, a) instead of action-values, and chose VMAX = −VMIN = 10 from preliminary experiments over the training games.",
      "startOffset" : 43,
      "endOffset" : 62
    }, {
      "referenceID" : 39,
      "context" : ", 2016), the Dueling architecture (Wang et al., 2016), and Prioritized Replay (Schaul et al.",
      "startOffset" : 34,
      "endOffset" : 53
    }, {
      "referenceID" : 27,
      "context" : ", 2016), and Prioritized Replay (Schaul et al., 2016), comparing the best evaluation score achieved during training.",
      "startOffset" : 32,
      "endOffset" : 53
    }, {
      "referenceID" : 14,
      "context" : "We believe the gradient-based categorical algorithm is able to mitigate these effects by effectively averaging the different distri† The UNREAL results are not altogether comparable, as they were generated in the asynchronous setting with per-game hyperparameter tuning (Jaderberg et al., 2017).",
      "startOffset" : 270,
      "endOffset" : 294
    }, {
      "referenceID" : 30,
      "context" : "A recurring theme in artificial intelligence is the idea of an agent learning from a multitude of predictions (Caruana 1997; Utgoff & Stracuzzi 2002; Sutton et al. 2011; Jaderberg et al. 2017).",
      "startOffset" : 110,
      "endOffset" : 192
    }, {
      "referenceID" : 14,
      "context" : "A recurring theme in artificial intelligence is the idea of an agent learning from a multitude of predictions (Caruana 1997; Utgoff & Stracuzzi 2002; Sutton et al. 2011; Jaderberg et al. 2017).",
      "startOffset" : 110,
      "endOffset" : 192
    }, {
      "referenceID" : 14,
      "context" : "We believe the gradient-based categorical algorithm is able to mitigate these effects by effectively averaging the different distri† The UNREAL results are not altogether comparable, as they were generated in the asynchronous setting with per-game hyperparameter tuning (Jaderberg et al., 2017). butions, similar to conservative policy iteration (Kakade & Langford, 2002). While the chattering persists, it is integrated to the approximate solution. State aliasing. Even in a deterministic environment, state aliasing may result in effective stochasticity. McCallum (1995), for example, showed the importance of coupling representation learning with policy learning in partially observable domains.",
      "startOffset" : 271,
      "endOffset" : 573
    } ],
    "year" : 2017,
    "abstractText" : "In this paper we argue for the fundamental importance of the value distribution: the distribution of the random return received by a reinforcement learning agent. This is in contrast to the common approach to reinforcement learning which models the expectation of this return, or value. Although there is an established body of literature studying the value distribution, thus far it has always been used for a specific purpose such as implementing risk-aware behaviour. We begin with theoretical results in both the policy evaluation and control settings, exposing a significant distributional instability in the latter. We then use the distributional perspective to design a new algorithm which applies Bellman’s equation to the learning of approximate value distributions. We evaluate our algorithm using the suite of games from the Arcade Learning Environment. We obtain both state-of-the-art results and anecdotal evidence demonstrating the importance of the value distribution in approximate reinforcement learning. Finally, we combine theoretical and empirical evidence to highlight the ways in which the value distribution impacts learning in the approximate setting.",
    "creator" : "LaTeX with hyperref package"
  }
}