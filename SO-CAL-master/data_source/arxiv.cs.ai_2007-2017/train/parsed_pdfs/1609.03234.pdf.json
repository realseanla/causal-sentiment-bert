{
  "name" : "1609.03234.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Reduced Space and Faster Convergence in Imperfect- Information Games via Regret-Based Pruning",
    "authors" : [ "Noam Brown" ],
    "emails" : [ "noamb@cmu.edu", "sandholm@cs.cmu.edu" ],
    "sections" : [ {
      "heading" : "1 Introduction",
      "text" : "Imperfect-information extensive-form games model strategic multi-step scenarios between agents with hidden information, such as auctions, security interactions (both physical and virtual), negotiations, and military situations. Typically in imperfect-information games, one wishes to find a Nash equilibrium, which is a profile of strategies in which no player can improve her outcome by unilaterally changing her strategy. A linear program can find an exact Nash equilibrium in two-player zero-sum games containing fewer than about 108 nodes [5]. For larger games, iterative algorithms are used to converge to a Nash equilibrium. There are a number of such iterative algorithms [11, 7, 12, 8], the most popular of which is Counterfactual Regret Minimization (CFR) [16]. CFR minimizes regret independently at each decision point in the game. CFR+, a variant of CFR, was used to essentially solve Limit Texas Hold’em, the largest imperfect-information game ever to be essentially solved [1].\nBoth computation time and storage space are difficult challenges when solving large imperfectinformation games. For example, solving Limit Texas Hold’em required nearly 8 million core hours and a complex, domain-specific streaming compression algorithm to store the 262 TiB of uncompressed data in only 10.9 TiB. This data had to be repeatedly decompressed from disk into memory and then compressed back to disk in order to run CFR+ [14].\nRegret Based Pruning (RBP) is an improvement to CFR that greatly reduces the computation time needed to solve large games by temporarily pruning suboptimal actions [2]. Specifically, if an action has negative regret, then RBP skips that action for the minimum number of iterations it would take for its regret to become positive in CFR. The skipped iterations are then “made up” in a single iteration once pruning ends.\nIn this paper we introduce a new form of RBP which we coin Total RBP. It alters the starting and ending conditions for pruning, and changes the way regrets are updated once pruning ends. We refer to the prior form of RBP as Interval RBP to differentiate it from our new method.\nA primary advantage of Total RBP is that in addition to faster convergence, it also reduces the space requirements of CFR over time. Specifically, once pruning begins on a branch, Total RBP ensures\nar X\niv :1\n60 9.\n03 23\n4v 1\n[ cs\n.G T\n] 1\n2 Se\np 20\nthe regrets currently stored on that branch will never be needed again. In other words, all the data stored for a branch that is pruned can be discarded, and the space allocated to that branch can be freed. Space need not be reallocated for that branch until pruning ends and the branch cannot immediately be pruned again. In Section 3.1, we prove that after enough iterations are completed, space for certain pruned branches will never need to be allocated again. Specifically, we prove that Total RBP need only asymptotically store actions that have positive probability in a best response to a Nash equilibrium. This is extremely advantageous when solving large imperfect-information games, which are often constrained by space and in which the set of best response actions may be orders of magnitude smaller than the size of the game.\nWhile Total RBP still requires enough memory to store the entire game in the early iterations, recent work has shown that these early iterations can be skipped by first solving a low-memory abstraction of the game and then using its solution to warm starting CFR in the full game [4]. Total RBP’s reduction in space is also helpful to the Simultaneous Abstraction and Equilibrium Finding (SAEF) algorithm [3], which starts CFR with a small abstraction of the game and progressively expands the abstraction while also solving the game. SAEF’s space requirements increase the longer the algorithm runs, and may eventually exceed the constraints of a system. Total RBP can counter this increase in space by eliminating the need to store suboptimal paths of the game tree.\nWhile prior work on Interval RBP has shown empirical evidence of better performance, this paper proves that CFR converges faster when using Total RBP, because certain suboptimal actions will only need to be traversed O ( ln(T ) ) times over T iterations.\nThe magnitude of these gains in speed and space varies depending on the game. It is possible to construct games where Total RBP provides no benefit. However, if there are many suboptimal actions in the game—as is frequently the case in large games—Total RBP can speed up CFR by multiple orders of magnitude and require orders of magnitude less space. Our experiments show an order of magnitude space reduction already in medium-sized games, and a reduction factor increase with game size."
    }, {
      "heading" : "2 Background",
      "text" : "This section presents the notation used in the rest of the paper. An imperfect-information extensiveform game has a finite set of players, P . H is the set of all possible histories (nodes) in the game tree, represented as a sequence of actions, and includes the empty history. A(h) is the actions available in a history and P (h) ∈ P ∪ c is the player who acts at that history, where c denotes chance. Chance plays an action a ∈ A(h) with a fixed probability σc(h, a) that is known to all players. The history h′ reached after action a in h is a child of h, represented by h · a = h′, while h is the parent of h′. More generally, h′ is an ancestor of h (and h is a descendant of h′), represented by h′ @ h, if there exists a sequence of actions from h′ to h. Z ⊆ H are terminal histories for which no actions are available. For each player i ∈ P , there is a payoff function ui : Z → <. If P = {1, 2} and u1 = −u2, the game is two-player zero-sum. Define ∆i = maxz∈Z ui(z)−minz∈Z ui(z) and ∆ = maxi ∆i. Imperfect information is represented by information sets for each player i ∈ P by a partition Ii of h ∈ H : P (h) = i. For any information set I ∈ Ii, all histories h, h′ ∈ I are indistinguishable to player i, so A(h) = A(h′). I(h) is the information set I where h ∈ I . P (I) is the player i such that I ∈ Ii. A(I) is the set of actions such that for all h ∈ I , A(I) = A(h). |Ai| = maxI∈Ii |A(I)| and |A| = maxi |Ai|. Define U(I) to be the maximum payoff reachable from a history in I , and L(I) to be the minimum. That is, U(I) = maxz∈Z,h∈I:hvz uP (I)(z) and L(I) = minz∈Z,h∈I:hvz uP (I)(z). Define ∆(I) = U(I) − L(I) to be the range of payoffs reachable from a history in I . Similarly U(I, a), L(I, a), and ∆(I, a) are the maximum, minimum, and range of payoffs (respectively) reachable from a history in I after taking action a. Define D(I, a) to be the set of information sets reachable by player P (I) after taking action a. Formally, I ′ ∈ D(I, a) if for some history h ∈ I and h′ ∈ I ′, h · a v h′ and P (I) = P (I ′). A strategy σi(I) is a probability vector over A(I) for player i in information set I . The probability of a particular action a is denoted by σi(I, a). Since all histories in an information set belonging to player i are indistinguishable, the strategies in each of them must be identical. That is, for all h ∈ I , σi(h) = σi(I) and σi(h, a) = σi(I, a). Define σi to be a probability vector for player i over all available strategies Σi in the game. A strategy profile σ is a tuple of strategies, one for each player.\nui(σi, σ−i) is the expected payoff for player i if all players play according to the strategy profile 〈σi, σ−i〉. If a series of strategies are played over T iterations, then σ̄Ti = ∑ t∈T σ t i T .\nπσ(h) = Πh′→avhσP (h)(h, a) is the joint probability of reaching h if all players play according to σ. πσi (h) is the contribution of player i to this probability (that is, the probability of reaching h if all players other than i, and chance, always chose actions leading to h). πσ−i(h) is the contribution of all players other than i, and chance. πσ(h, h′) is the probability of reaching h′ given that h has been reached, and 0 if h 6@ h′. In a perfect-recall game, ∀h, h′ ∈ I ∈ Ii, πi(h) = πi(h′). In this paper we focus on perfect-recall games. Therefore, for i = P (I) define πi(I) = πi(h) for h ∈ I . Moreover, I ′ @ I if for some h′ ∈ I ′ and some h ∈ I , h′ @ h. Similarly, I ′ · a @ I if h′ · a @ h. The average\nstrategy σ̄Ti (I) for an information set I is defined as σ̄ T i (I) =\n∑ t∈T π σti i (I)σ\nt i(I)∑\nt∈T π σt i (I)\n.\nA best response to σ−i is a strategy σ∗i such that ui(σ ∗ i , σ−i) = maxσ′i∈Σi ui(σ ′ i, σ−i). A Nash equilibrium σ∗ is a strategy profile where every player plays a best response: ∀i, ui(σ∗i , σ∗−i) = maxσ′i∈Σi ui(σ ′ i, σ ∗ −i). A Nash equilibrium strategy for player i as a strategy σi that is part of any Nash equilibrium. In two-player zero-sum games, if σi and σ−i are both Nash equilibrium strategies, then 〈σi, σ−i〉 is a Nash equilibrium. An -equilibrium as a strategy profile σ∗ such that ∀i, ui(σ∗i , σ∗−i) + ≥ maxσ′i∈Σi ui(σ ′ i, σ ∗ −i)."
    }, {
      "heading" : "2.1 Counterfactual Regret Minimization",
      "text" : "Counterfactual Regret Minimization (CFR) is a popular algorithm for extensive-form games in which the strategy vector for each information set is determined according to a regret-minimization algorithm [16]. We use regret matching (RM) [6] as the regret-minimization algorithm.\nThe analysis of CFR makes frequent use of counterfactual value. Informally, this is the expected utility of an information set given that player i tries to reach it. For player i at information set I given a strategy profile σ, this is defined as\nvσ(I) = ∑ h∈I ( πσ−i(h) ∑ z∈Z ( πσ(h, z)ui(z) )) (1)\nThe counterfactual value of an action a is vσ(I, a) = ∑ h∈I ( πσ−i(h) ∑ z∈Z ( πσ(h · a, z)ui(z) )) (2)\nA counterfactual best response [10] (CBR) is a strategy similar to a best response, except that it maximizes counterfactual value even at information sets that it does not reach due to its earlier actions. Specifically, a counterfactual best response to σ−i is a strategy CBR(σ−i) such that if CBR(σ−i)(I, a) > 0 then v〈CBR(σ−i),σ−i〉(I, a) = maxa′ v〈CBR(σ−i),σ−i〉(I, a′). The counterfactual best response value CBV σ−i(I) is similar to counterfactual value, except that player i = P (I) plays according to a CBR to σ−i. Formally, CBV σ−i(I) = v〈CBRi(σ−i),σ−i〉(I).\nLet σt be the strategy profile used on iteration t. The instantaneous regret on iteration t for action a in information set I is rt(I, a) = vσ t\n(I, a) − vσt(I) and the regret for action a in I on iteration T is RT (I, a) = ∑ t∈T r\nt(I, a). Additionally, RT+(I, a) = max{RT (I, a), 0} and RT (I) = maxa{RT+(I, a)}. Our analysis of Total RBP will occasionally reference the potential function of R(I), defined as Φ(RT (I)) = ∑ a∈A(I) ( RT+(I, a) )2 . Regret for player i in the entire\ngame is RTi = maxσ′i∈Σi ∑ t∈T ( ui(σ ′ i, σ t −i)− ui(σti , σt−i) ) .\nIn regret matching, a player picks a distribution over actions in an information set in proportion to the positive regret on those actions. Formally, on each iteration T + 1, player i selects actions a ∈ A(I) according to probabilities\nσT+1(I, a) =  RT+(I,a)∑ a′∈A(I) R T +(I,a ′) , if ∑ a′ R T +(I, a ′) > 0\n1 |A(I)| , otherwise\n(3)\nIf a player plays according to RM on every iteration then on iteration T , RT (I) ≤ ∆(I) √ |A(I)| √ T .\nIf a player plays according to CFR in every iteration then RTi ≤ ∑ I∈Ii R\nT (I). So, as T → ∞, RTi T → 0. In two-player zero-sum games, if both players’ average regret RTi T ≤ , their average strategies 〈σ̄T1 , σ̄T2 〉 form a 2 -equilibrium [15]. Thus, CFR constitutes an anytime algorithm for finding an -Nash equilibrium in zero-sum games."
    }, {
      "heading" : "2.2 Partial Pruning and Interval Regret-Based Pruning",
      "text" : "This section reviews forms of pruning that allow parts of the game tree to be skipped in CFR. Typically, regret is updated by traversing each node in the game tree separately for each player, and calculating the contribution of a history h ∈ I to rt(I, a) for each action a ∈ A(I). If a history h is reached in which πσ t\n−i(h) = 0 (that is, an opponent’s reach is zero), then from (1) and (2) the strategy at h contributes nothing on iteration t to the regret of I(h) (or to the information sets above it). Moreover, any history that would be reached beyond h would also contribute nothing to its information set’s regret because πσ t\n−i(h ′) = 0 for every history h′ where h @ h′ and P (h′) = P (h).\nThus, when traversing the game tree for player i, there is no need to traverse beyond any history h when πσ t\n−i(h) = 0. The benefit of this form of pruning, which we refer to as partial pruning, varies depending on the game, but empirical results show a factor of 30 improvement in some games [9].\nWhile partial pruning allows one to prune paths that an opponent reaches with zero probability, interval regret-based pruning (Interval RBP) allows one to also prune paths that the traverser reaches with zero probability [2]. However, this pruning is necessarily temporary. Consider an action a ∈ A(I) such that σt(I, a) = 0, and assume that it is known action a will not be played with positive probability until some far-future iteration t′ (in RM, this would be the case if Rt(I, a) 0). Since action a is played with zero probability on iteration t, so from (1) the strategy played and reward received following action a (that is, in D(I, a)) will not contribute to the regret for any information set preceding action a on iteration t. In fact, what happens in D(I, a) has no bearing on the rest of the game tree until iteration t′ is reached. So one could, in theory, “procrastinate” in deciding what happened beyond action a on iteration t, t+ 1, ..., t′ − 1 until iteration t′. However, upon reaching iteration t′, rather than individually making up the t′ − t iterations over D(I, a), one can instead do a single iteration, playing against the average of the opponents’ strategies in the t′− t iterations that were missed, and declare that strategy was played on all the t′− t iterations. This accomplishes the work of the t′− t iterations in a single traversal. Moreover, since player i never plays action a with positive probability between iterations t and t′, that means every other player can apply partial pruning on that part of the game tree for iterations t′ − t, and skip it completely. This, in turn, means that player i has free rein to play whatever they want in D(I, a) without affecting the regrets of the other players. In light of that, and of the fact that player i gets to decide what is played in D(I, a) after knowing what the other players have played, player i might as well play a strategy that ensures zero regret for all information sets I ′ ∈ D(I, a) in the iterations t to t′. A CBR to the average of the opponent strategies on the t′ − t iterations would qualify as such a zero-regret strategy. Interval regret-based pruning only allows a player to skip traversing D(I, a) for as long as σt(I, a) = 0. Thus, in RM, if Rt0(I, a) < 0, we can prune the game tree beyond action a from iteration t0 until iteration t1 so long as ∑t0 t=1 v σt(I, a) + ∑t1 t=t0+1 πσ t −i(I)U(I, a) ≤ ∑t1 t=1 v σt(I).\n3 Total RBP: A New Form of Regret-Based Pruning This section introduces a new form of RBP which we coin Total RBP. When pruning ends and regret must be updated in the pruned branch, Interval RBP calculates a CBR to the average opponent strategy over the skipped iterations, and updates regret in the pruned branch as if that CBR strategy were played on each of the skipped iterations. By contrast, when pruning ends in Total RBP, it calculates a CBR in the pruned branch against the opponent’s average strategy over all iterations played so far, and sets regret as if that CBR strategy were played on every iteration played in the game so far—even those that were played before pruning began.\nWhile using a CBR works correctly in Total RBP, it is also sound to choose a strategy that is almost a CBR (formalized later in this section), as long as that strategy does not result in a violation of the CFR bound on the potential function Φ(RT (I)) of any information set I . In practice, this means that the strategy is close to a CBR, and approaches a CBR as T → ∞. We now present the theory to show that such a near-CBR can be used. However, in practice CFR converges much faster than the\ntheoretical bound, so the potential function is typically far lower than the theoretical bound. Thus, while choosing a near-CBR rather than an exact CBR may allow for slightly longer pruning according to the theory, it may actually result in worse performance. All of the theoretical results presented in this paper, including the improved convergence bound as well as the lower space requirements, still hold if only a CBR is used, and our experiments use a CBR. Nevertheless, clever heuristics for deciding on a near-CBR may lead to even better performance in practice.\nWe define a strategy NBR(σ−i, T ) as a T -near counterfactual best response (T -near CBR) to σ−i if for all I belonging to player i∑\na∈A(I)\n( v〈NBR(σ−i,T ),σ−i〉(I, a)− v〈NBR(σ−i,T ),σ−i〉(I) )2 + ≤ x T I\nT 2 (4)\nwhere xTI can be any value in the range 0 ≤ xTI ≤ yTI and yTI is the CFR bound on Φ(RT (I)). If xTI = 0, then a T -near CBR is always a CBR. The set of strategies that are T -near CBRs to σ−i is represented as ΣNBR(σ−i, T ). We also define the T -near counterfactual best response value as NBV σ−i,T (I, a) = minσ′i∈ΣNBR(σ−i,T ) v\n〈σ′i,σ−i〉(I, a) and NBV σ−i,T (I) = minσ′i∈ΣNBR(σ−i,T ) v 〈σ′i,σ−i〉(I).\nIn Total RBP, an action is pruned only if it would still have negative regret had a T -near CBR against the opponent’s average strategy been played on every iteration. Specifically, on iteration T of CFR with RM, if\nT ( NBV σ̄ T −i,T (I, a) ) ≤ T∑ t=1 vσ t (I) (5)\nthen D(I, a) can be pruned for\nT ′ =\n∑T t=1 v σt(I)−NBV σ̄ T −i,T (I, a)\nU(I, a)− L(I) (6)\niterations. After those T ′ iterations are over, we calculate a T + T ′-near CBR in D(I, a) to the opponent’s average strategy and set regret as if that T + T ′-near CBR had been played on every iteration. Specifically, for each t ≤ T + T ′ we set1 vσt(I, a) = NBV σ̄ T+T ′ −i ,T+T ′ (I, a) so that\nRT+T ′ (I, a) = ( T + T ′ )( NBV σ̄ T+T ′ −i ,T+T ′ (I, a) ) − T+T ′∑ t=1 vσ t (I) (7)\nand for every information set I ′ ∈ D(I, a) we set vσt(I ′, a′) = NBV σ̄ T+T ′ −i ,T+T ′ (I ′, a′) and\nvσ t (I ′) = NBV σ̄ T+T ′ −i ,T+T ′ (I ′) so that\nRT+T ′ (I ′, a′) = ( T + T ′ )( NBV σ̄ T+T ′ −i ,T+T ′ (I ′, a′)−NBV σ̄ T+T ′ −i ,T+T ′ (I ′) )\n(8)\nTheorem 1 proves that if (5) holds for some action, then the action can be pruned for T ′ iterations, where T ′ is defined in (6). The same theorem holds if one replaces the T -near counterfactual best response values with counterfactual best response values. The proof for Theorem 1 draws from recent work on warm starting CFR using only an average strategy profile [4]. Essentially, we warm start regrets in the pruned branch using only the average strategy of the opponent and knowledge of T . Theorem 1. Assume T iterations of CFR with RM have been played in a two-player zerosum game and assume T ( NBV σ̄ T −i,T (I, a) ) ≤ ∑T t=1 v σt(I) where P (I) = i. Let T ′ =\nb ∑T t=1 v\nσt (I)−T ( NBV σ̄T−i,T (I,a) )\nU(I,a)−L(I) c. If both players play according to CFR with RM for the next T ′ iterations in all information sets I ′′ 6∈ D(I, a) except that σ(I, a) is set to zero and σ(I) is renormalized, then (T + T ′) ( NBV σ̄ T+T ′ −i ,T+T ′ (I, a) ) ≤ ∑T+T ′ t=1 v σt(I). Moreover, if one then sets vσ t (I, a) = NBV σ̄ T+T ′ −i ,T+T ′ (I, a) for each t ≤ T+T ′ and vσt(I ′, a′) = NBV σ̄ T+T ′ −i ,T+T ′ (I ′, a′) for each I ′ ∈ D(I, a), then after T ′′ additional iterations of CFR with RM, the bound on exploitability of σ̄T+T ′+T ′′ is no worse than having played T + T ′ + T ′′ iterations of CFR with RM without RBP.\n1In practice, only the sums ∑T t=1 v σt(I) and either ∑T t=1 v σt(I, a) or RT (I, a) are stored.\nIn practice, rather than check whether (5) is met for an action on every iteration, one could only check actions that have very negative regret, and do a check only once every several iterations. This would still be safe and would save some computational cost of the checks, but would lead to less pruning.\nAs is the case with Interval RBP, the duration of pruning can be increased by giving up knowledge beforehand of exactly how many iterations can be skipped. From (2) and (1) we see that rT (I, a) ≤ πσ t −i(I) ( U(I, a) − L(I) ) . Thus, if πσ t\n−i(I) is very low, then (5) would continue to hold for more iterations than (6) guarantees. Specifically, we can prune D(I, a) from iteration t0 until iteration t1 as long as\nt0 ( NBV σ̄ t0 −i,t0(I, a) ) + t1∑ t=t0+1 πσ t −i(I)U(I, a) ≤ t1∑ t=1 vσ t (I) (9)"
    }, {
      "heading" : "3.1 Total RBP Requires Less Space",
      "text" : "A key advantage of Total RBP is that setting the new regrets according to (7) and (8) requires no knowledge of what the regrets were before pruning began. Thus, once pruning begins, all the regrets in D(I, a) can be discarded and the space that was allocated to storing the regret can be freed. That space need only be re-allocated once (9) ceases to hold and we cannot immediately begin pruning again (that is, (5) does not hold). Theorem 2 proves that for any information set I and action a ∈ A(I) that is not part of a best response to a Nash equilibrium, there is an iteration TI,a such that for all T ≥ TI,a, action a in information set I (and its descendants) can be pruned.2 Thus, once this TI,a is reached, it will never be necessary to allocate space for regret in D(I, a) again. Theorem 2. In a two-player zero-sum game, if for every opponent Nash equilibrium strategy σ∗−P (I), CBV σ ∗ −P (I)(I, a) < CBV σ ∗ −P (I)(I), then there exists a TI,a and δI,a > 0 such that after T ≥ TI,a\niterations of CFR, CBV σ̄ T −i(I, a)−\n∑T t=1 v σt (I)\nT ≤ −δI,a.\nWhile such a constant TI,a exists for any suboptimal action, Total RBP cannot determine whether or when TI,a is reached. So, it is still necessary to check whether (5) is satisfied whenever (9) no longer holds, and to recalculate how much longer D(I, a) can safely be pruned. This requires the algorithm to periodically calculate a best response (or near-best response) in D(I, a). However, this (near-)best response calculation does not require knowledge of regret in D(I, a), so it is still never necessary to store regret after iteration TI,a is reached.\nWhile it is possible to discard regrets in D(I, a) without penalty once pruning begins, regret is only half the space requirement of CFR. Every information set I also stores a sum of the strategies played∑T t=1 ( πσ t i (I)σ t(I) ) which is normalized once CFR ends in order to calculate σ̄T (I). Fortunately, if action a in information set I is pruned for long enough, then the stored cumulative strategy in D(I, a) can also be discarded at the cost of a small increase in the distance of the final average strategy from a Nash equilibrium. Specifically, if πσ̄ T\ni (I, a) ≤ C√T , where C is some constant, then setting σ̄T (I, a) = 0 and renormalizing σ̄T (I), and setting σ̄T (I ′, a′) = 0 for I ′ ∈ D(I, a), can result in at most C|I|∆√\nT higher exploitability for the whole strategy σ̄T . Since CFR only guarantees that σ̄T\nis a 2|I|∆ √ |A|√\nT -Nash equilibrium anyway, C|I|∆√ T is only a constant factor of the bound. If an action is pruned from T ′ to T , then ∑T t=1 ( πσ t i (I)σ t(I, a) ) ≤ T ′\nT . Thus, if an action is pruned for long enough, then eventually ∑T t=1 ( πσ t i (I)σ t(I, a) ) ≤ C√ T for any C, so ∑T t=1 ( πσ t i (I)σ t(I, a) ) could be set to zero (as well as all descendants of I · a), while suffering at most a constant factor increase in exploitability. As more iterations are played, this penalty will continue to decrease and eventually be negligible. The constant C can be set by the user: a higher C allows the average strategy to be discarded sooner, while a lower C reduces the potential penalty in exploitability.\nWe define IS as the set of information sets that are not guaranteed to be asymptotically pruned by Theorem 2. Specifically, I ∈ IS if I 6∈ D(I ′, a′) for some I ′ and a′ ∈ A(I ′) such that for every opponent Nash equilibrium strategy σ∗−P (I′), CBV σ∗−P (I′)(I ′, a′) < CBV σ ∗ −P (I′)(I ′). Theorem 2 implies the following. 2If CFR converges to a particular Nash equilibrium, then this condition could be broadened to any information set I and action a ∈ A(I) that is not a best response to that particular Nash equilibrium. While empirically CFR does appear to always converge to a particular Nash equilibrium, there is no known proof that it always does so.\nCorollary 1. In a two-player zero-sum game with some threshold on the average strategy C√ T for C > 0, after a finite number of iterations, CFR with Total RBP requires only O ( |IS ||A| ) space."
    }, {
      "heading" : "3.2 Total RBP Has a Better Convergence Bound",
      "text" : "We now prove that Total RBP in CFR speeds up convergence to an -Nash equilibrium. Section 3 proved that CFR with Total RBP converges in the same number of iterations as CFR alone. In this section, we prove that Total RBP allows each iteration to be traversed more quickly. Specifically, if an action a ∈ A(I) is not a CBR to a Nash equilibrium, then D(I, a) need only be traversed O(ln(T )) times over T iterations. Intuitively, as both players converge to a Nash equilibrium, actions that are not a counterfactual best response will eventually do worse than actions that are, so those suboptimal actions will accumulate increasing amounts of negative regret. This negative regret allows the action to be safely pruned for increasingly longer periods of time.\nSpecifically, let S ⊆ H be the set of histories where h · a ∈ S if h ∈ S and action a is part of some CBR to some Nash equilibrium. Formally, S contains ∅ and every history h · a such that h ∈ S and CBV σ ∗ −P (I)(I, a) = CBV σ ∗ −P (I)(I) for some Nash equilibrium σ∗.\nTheorem 3. In a two-player zero-sum game, if both players choose strategies according to CFR with Total RBP, then conducting T iterations requires only O ( |S|T + |H| ln(T ) ) nodes to be traversed.\nThe definition of S uses properties of the Nash equilibria of the game, and an action a ∈ A(I) not in S is only guaranteed to be pruned by RBP after some TI,a is reached, which also depends on the Nash equilibria of the game. Since CFR converges to only an -Nash equilibrium, CFR cannot determine with certainty which nodes are in S or when TI,a is reached. Nevertheless, both S and TI,a are fixed properties of the game."
    }, {
      "heading" : "4 Experiments",
      "text" : "We compare Total RBP to Interval RBP, to only partial pruning, and to no pruning at all. We also show the amount of space used by Total RBP over the course of the run. The experiments are conducted on Leduc Hold’em [13] and Leduc-5 [2]. Leduc Hold’em is a common benchmark in imperfect-information game solving because it is small enough to be solved but still strategically complex. In Leduc Hold’em, there is a deck consisting of six cards: two each of Jack, Queen, and King. There are two rounds. In the first round, each player places an ante of 1 chip in the pot and receives a single private card. A round of betting then takes place with a two-bet maximum, with Player 1 going first. A public shared card is then dealt face up and another round of betting takes place. Again, Player 1 goes first, and there is a two-bet maximum. If one of the players has a pair with the public card, that players wins. Otherwise, the player with the higher card wins. The bet size in the first round is 2 chips, and 4 chips in the second round. Leduc-5 is like Leduc Hold’em but larger: there are 5 bet sizes to choose from. In the first round a player may bet 0.5, 1, 2, 4, or 8 chips, while in the second round a player may bet 1, 2, 4, 8, or 16 chips.\nResults are presented for both CFR and CFR+. Nodes touched is a hardware and implementationindependent proxy for time. Overhead costs are counted in nodes touched. CFR+ is a variant of CFR in which a floor on regret is set at zero and each iteration is weighted linearly in the average strategy (that is, iteration t is weighted by t) rather than each iteration being weighted equally. Since Interval RBP can only prune negative-regret actions, Interval RBP modifies the definition of CFR+ so that regret can be negative, but immediately jumps up to zero as soon as regret increases. Total RBP does not require this modification. Both forms of RBP modify the behavior of CFR+ because without pruning, CFR+ would put positive probability on an action as soon as its regret increases, while RBP waits until pruning is over. This is not, by itself, a problem. However, CFR+’s linear weighting of the average strategy is only guaranteed to converge to a Nash equilibrium if pruning does not occur. While pruning does well empirically with CFR+, the convergence is noisy. This noise can be reduced by using the lowest-exploitability average strategy profile found so far. We do this in the experiments.\nFigure 1 shows the reduction in space needed to store the average strategy and regrets for Total RBP—for various values of the constant threshold C, where an action’s probability is set to zero if it is reached with probability less than C√\nT in the average strategy, as we explained in Section 3.1. In\nboth games, a threshold between 0.01 and 0.1 performed well in both space and number of iterations,\nwith the lower thresholds converging somewhat faster and the higher thresholds reducing space faster. We also tested thresholds below 0.01, but the speed of convergence was essentially the same as when using 0.01. In Leduc, all variants resulted in a quick drop-off in space to about half the initial amount. In Leduc-5, a threshold of 0.1 resulted in a factor of 10 reduction in space for CFR+, and a factor of 7 reduction for CFR. In the case of CFR, this space reduction factor appears to continue to increase.\nFigure 2 compares the convergence rates of Total RBP, Interval RBP, and only partial pruning for both CFR and CFR+. In Leduc, Total RBP and Interval RBP perform comparably when added to CFR. When added to CFR+, Interval RBP does significantly better. In Leduc-5, which is a far larger game, Total RBP outperforms Interval RBP by a factor of 2 when added to CFR. When added to CFR+, Total RBP initially does far better but its performance is eventually surpassed by Interval RBP. This may be due to the noisy performance of CFR+ with RBP."
    }, {
      "heading" : "5 Conclusions",
      "text" : "We introduced Total RBP, a new form of regret-based pruning that provably reduces both the space needed to solve an imperfect-information game and the time needed to reach an -Nash equilibrium. This addresses both of the major bottlenecks in solving large imperfect-information games. Experimentally, Total RBP reduced the space needed to solve a game by an order of magnitude, with the reduction factor increasing with game size."
    }, {
      "heading" : "A Lemma 1",
      "text" : "Lemma 1 proves that if (5) is satisfied for some action a ∈ A(I) on iteration T , then the value of action a and all its descendants on every iteration played so far can be set to the T -near counterfactual best response value. The same lemma holds if one replaces the T -near counterfactual best response values with exact counterfactual best response values. The proof for Lemma 1 draws from recent work on warm starting CFR using only an average strategy profile [4]. Lemma 1. Assume T iterations of CFR with RM have been played in a two-player zero-sum game. If T ( NBV σ̄ T −i,T (I, a) ) ≤ ∑T t=1 v σt(I) and one sets vσ t (I, a) = NBV σ̄ T −i,T (I, a) for each t ≤ T and for each I ′ ∈ D(I, a) sets vσt(I ′, a′) = NBV σ̄ T −i,T (I ′, a′) and vσ t (I ′) = NBV σ̄ T −i,T (I ′) then after T ′ additional iterations of CFR with RM, the bound on exploitability of σ̄T+T ′\nis no worse than having played T + T ′ iterations of CFR with RM unaltered. Proof. The proof builds upon Theorem 2 in [4]. Assume T ( NBV σ̄ T −i,T (I, a) ) ≤ ∑T t=1 v\nσt(I). We wish to warm start to T iterations. For each I ′ ∈ D(I, a) set vσt(I ′, a′) = NBV σ̄ T −i,T (I ′, a′) and vσ t (I ′) = NBV σ̄ T −i,T (I ′) and set vσ t (I, a) = NBV σ̄ T −i,T (I, a) for all t ≤ T . For every other action, leave regret unchanged. For each I ′ ∈ D(I, a) we know by construction that Φ(RT (I ′)) is within the CFR bound yTI′ after changing regret. By assumption T ( NBV σ̄ T −i,T (I, a) ) ≤∑T\nt=1 v σt(I), so RT (I, a) ≤ 0 and therefore Φ(RT (I)) is unchanged. Finally, since the T iterations were played according to CFR with RM and regret is unchanged for every other information set I ′′, so the conditions for Theorem 2 in [4] hold for every information set, and therefore we can warm start to T iterations of CFR with RM with no penalty to the convergence bound."
    }, {
      "heading" : "B Proof of Theorem 1",
      "text" : "Proof. From Lemma 1 we can immediately set regret for a ∈ A(I) to vσt(I, a) = NBV σ̄ T −i,T (I, a). By construction of T ′, Rt(I, a) is guaranteed to be nonpositive for T ≤ t ≤ T + T ′ and therefore σt(I, a) = 0. Thus, σ̄T+T ′\ni (I ′) for I ′ ∈ D(I, a) is identical regardless of what is played in D(I, a)\nduring T ≤ t ≤ T + T ′.\nSince (T + T ′) ( NBV σ̄ T+T ′ −i ,T+T ′ (I, a) ) ≤ T ( NBV σ̄ T −i,T (I, a) ) + T ′ ( U(I, a) ) and ∑T+T ′ t=1 v σt(I) ≥ ∑T t=1 v σt(I) + T ′ ( L(I) ) , so by the definition of T ′,\n(T + T ′) ( NBV σ̄ T+T ′ −i ,T+T ′ (I, a) ) ≤ ∑T+T ′ t=1 v σt(I). So if regrets in D(I, a) and RT+T ′ (I, a) are set according to Lemma 1, then after T ′′ additional iterations of CFR with RM, the bound on exploitability of σ̄T+T\n′+T ′′ is no worse than having played T + T ′ + T ′′ iterations of CFR with RM from scratch."
    }, {
      "heading" : "C Proof of Theorem 2",
      "text" : "Proof. Consider an information set I and action a ∈ A(I) where for every opponent Nash equilibrium strategy σ∗−P (I), CBV σ∗−P (I)(I, a) < CBV σ ∗ −P (I)(I). Let i = P (I). Let δ =\nminσ−i∈Σ∗ ( CBV σ−i(I) − CBV σ−i(I, a) ) where Σ∗ is the set of Nash equilibria. Let σ′−i = arg maxσ−i∈Σ−i|CBV σ−i (I)−CBV σ−i (I,a)≤ 3δ4 u−i(σ−i, BR(σ−i)) Since σ′−i is not a Nash equilibrium strategy and CFR converges to a Nash equilibrium strategy for both players, so there exists a Tδ such that for all T ≥ Tδ , CBV σ̄ T −i(I)−CBV σ̄ T −i(I, a) > 3δ4 . Let T ′ I,a = 4|I|2∆2|A| δ2 . For T ≥ T ′ I,a\nsince RTi ≤ ∑ I∈Ii R T (I), so CBV σ̄ T −i(I) − ∑T t=1 v σt(I) ≤ δ2 . Let TI,a = max(T ′ I,a, Tδ) and\nδI,a = δ 4 . Then for T ≥ TI,a, CBV\nσ̄T−i(I, a)− ∑T t=1 v σt (I)\nT ≤ −δI,a."
    }, {
      "heading" : "D Proof of Corollary 1",
      "text" : "Proof. Let I 6∈ IS . Then I ∈ D(I ′, a′) for some I ′ and a′ ∈ A(I ′) such that for every opponent Nash equilibrium strategy σ∗−P (I′), CBV σ∗−P (I′)(I ′, a′) < CBV σ ∗ −P (I′)(I ′). Applying Theorem 2, this\nmeans there exists a TI′,a′ and δI′,a′ > 0 such that for T ≥ TI′,a′ , CBV σ̄ T −i(I ′, a′)−\n∑T t=1 v σt (I′)\nT ≤ −δI′,a′ . So (5) always applies for T ≥ TI′,a′ for I ′ and a′ and I will always be pruned. Since (8) does not require knowledge of regret, it need not be stored for I .\nSince D(I ′, a′) will always be pruned for T ≥ TI′,a′ , so for any T ≥ (TI′,a′ )\n2\nC2 iterations for some constant C > 0, πσ̄ T\ni (I) ≤ C√T , which satisfies the threshold of the average strategy. Thus, the average strategy in D(I, a) can be discarded."
    }, {
      "heading" : "E Lemma 2",
      "text" : "Lemma 2. If for all T ≥ T ′ iterations of CFR with RBP, T ( CBV σ̄ T (I, a) ) − ∑T t=1 v\nσt(I) ≤ −xT for some x > 0, then any history h′ such that h · a v h′ for some h ∈ I need only be traversed at most O ( ln(T ) ) times. Proof. Let a ∈ A(I) be an action such that for all T ≥ T ′, T ( CBV σ̄ T (I, a) ) − ∑T t=1 v\nσt(I) ≤ −xT for some x > 0. NBV σ̄ T −i,T (I, a) ≤ CBV σ̄ T −i , so from Theorem 1, D(I, a) can be pruned for m ≥ b xTU(I,a)−L(I)c iterations on iteration T . Thus, over iterations T ≤ t ≤ T +m, only a constant number of traversals must be done. So each iteration requires only Cm work when amortized, where C is a constant. Since x, U(I, a), and L(I) are constants, so on each iteration t ≥ T ′, only an average of Ct traversals of D(I, a) is required. Summing over all t ≤ T for T ≥ T ′, and recognizing that T ′\nis a constant, we get that action a is only taken O ( ln(T ) ) over T iterations. Thus, any history h′\nsuch that h · a v h′ for some h ∈ I need only be traversed at most O ( ln(T ) ) times."
    }, {
      "heading" : "F Proof of Theorem 3",
      "text" : "Proof. Consider an h∗ 6∈ S. Then there exists some h · a v h∗ such that h ∈ S but h · a 6∈ S. Let I = I(h) and i = P (I). Since h · a 6∈ S but h ∈ S, so for every Nash equilibrium σ∗, CBV σ ∗ (I, a) < CBV σ ∗ (I). From Theorem 2, there exists a TI,a and δI,a > 0 such that after\nT ≥ TI,a iterations of CFR, CBV σ̄ T −i(I, a)−\n∑T t=1 v σt(I)\nT ≤ −δI,a. Thus from Lemma 2, h ∗ need only be traversed at most O ( ln(T ) ) times."
    } ],
    "references" : [ {
      "title" : "Heads-up limit hold’em poker is solved",
      "author" : [ "Michael Bowling", "Neil Burch", "Michael Johanson", "Oskari Tammelin" ],
      "venue" : "Science,",
      "citeRegEx" : "1",
      "shortCiteRegEx" : "1",
      "year" : 2015
    }, {
      "title" : "Regret-based pruning in extensive-form games",
      "author" : [ "Noam Brown", "Tuomas Sandholm" ],
      "venue" : "In Proceedings of the Annual Conference on Neural Information Processing Systems (NIPS),",
      "citeRegEx" : "2",
      "shortCiteRegEx" : "2",
      "year" : 2015
    }, {
      "title" : "Simultaneous abstraction and equilibrium finding in games",
      "author" : [ "Noam Brown", "Tuomas Sandholm" ],
      "venue" : "In Proceedings of the International Joint Conference on Artificial Intelligence (IJCAI),",
      "citeRegEx" : "3",
      "shortCiteRegEx" : "3",
      "year" : 2015
    }, {
      "title" : "Strategy-based warm starting for regret minimization in games",
      "author" : [ "Noam Brown", "Tuomas Sandholm" ],
      "venue" : "In AAAI Conference on Artificial Intelligence (AAAI),",
      "citeRegEx" : "4",
      "shortCiteRegEx" : "4",
      "year" : 2016
    }, {
      "title" : "Lossless abstraction of imperfect information games",
      "author" : [ "Andrew Gilpin", "Tuomas Sandholm" ],
      "venue" : "Journal of the ACM,",
      "citeRegEx" : "5",
      "shortCiteRegEx" : "5",
      "year" : 2007
    }, {
      "title" : "A simple adaptive procedure leading to correlated",
      "author" : [ "Sergiu Hart", "Andreu Mas-Colell" ],
      "venue" : "equilibrium. Econometrica,",
      "citeRegEx" : "6",
      "shortCiteRegEx" : "6",
      "year" : 2000
    }, {
      "title" : "Smoothing techniques for computing Nash equilibria of sequential games",
      "author" : [ "Samid Hoda", "Andrew Gilpin", "Javier Peña", "Tuomas Sandholm" ],
      "venue" : "Mathematics of Operations Research,",
      "citeRegEx" : "7",
      "shortCiteRegEx" : "7",
      "year" : 2010
    }, {
      "title" : "Faster first-order methods for extensive-form game solving",
      "author" : [ "Christian Kroer", "Kevin Waugh", "Fatma Kılınç-Karzan", "Tuomas Sandholm" ],
      "venue" : "In Proceedings of the ACM Conference on Economics and Computation (EC),",
      "citeRegEx" : "8",
      "shortCiteRegEx" : "8",
      "year" : 2015
    }, {
      "title" : "Monte Carlo sampling for regret minimization in extensive games",
      "author" : [ "Marc Lanctot", "Kevin Waugh", "Martin Zinkevich", "Michael Bowling" ],
      "venue" : "In Proceedings of the Annual Conference on Neural Information Processing Systems (NIPS),",
      "citeRegEx" : "9",
      "shortCiteRegEx" : "9",
      "year" : 2009
    }, {
      "title" : "Refining subgames in large imperfect information games",
      "author" : [ "Matej Moravcik", "Martin Schmid", "Karel Ha", "Milan Hladik", "Stephen J Gaukrodger" ],
      "venue" : "In Thirtieth AAAI Conference on Artificial Intelligence,",
      "citeRegEx" : "10",
      "shortCiteRegEx" : "10",
      "year" : 2016
    }, {
      "title" : "Excessive gap technique in nonsmooth convex minimization",
      "author" : [ "Yurii Nesterov" ],
      "venue" : "SIAM Journal of Optimization,",
      "citeRegEx" : "11",
      "shortCiteRegEx" : "11",
      "year" : 2005
    }, {
      "title" : "An interior point approach to large games of incomplete information",
      "author" : [ "François Pays" ],
      "venue" : "In AAAI Computer Poker Workshop,",
      "citeRegEx" : "12",
      "shortCiteRegEx" : "12",
      "year" : 2014
    }, {
      "title" : "bluff: Opponent modelling in poker",
      "author" : [ "Finnegan Southey", "Michael Bowling", "Bryce Larson", "Carmelo Piccione", "Neil Burch", "Darse Billings", "Chris Rayner. Bayes" ],
      "venue" : "In Proceedings of the 21st Annual Conference on Uncertainty in Artificial Intelligence (UAI),",
      "citeRegEx" : "13",
      "shortCiteRegEx" : "13",
      "year" : 2005
    }, {
      "title" : "Solving heads-up limit texas hold’em",
      "author" : [ "Oskari Tammelin", "Neil Burch", "Michael Johanson", "Michael Bowling" ],
      "venue" : "In Proceedings of the 24th International Joint Conference on Artificial Intelligence (IJCAI),",
      "citeRegEx" : "14",
      "shortCiteRegEx" : "14",
      "year" : 2015
    }, {
      "title" : "Abstraction pathologies in extensive games",
      "author" : [ "Kevin Waugh", "David Schnizlein", "Michael Bowling", "Duane Szafron" ],
      "venue" : "In International Conference on Autonomous Agents and Multi-Agent Systems (AAMAS),",
      "citeRegEx" : "15",
      "shortCiteRegEx" : "15",
      "year" : 2009
    } ],
    "referenceMentions" : [ {
      "referenceID" : 4,
      "context" : "A linear program can find an exact Nash equilibrium in two-player zero-sum games containing fewer than about 10 nodes [5].",
      "startOffset" : 118,
      "endOffset" : 121
    }, {
      "referenceID" : 10,
      "context" : "There are a number of such iterative algorithms [11, 7, 12, 8], the most popular of which is Counterfactual Regret Minimization (CFR) [16].",
      "startOffset" : 48,
      "endOffset" : 62
    }, {
      "referenceID" : 6,
      "context" : "There are a number of such iterative algorithms [11, 7, 12, 8], the most popular of which is Counterfactual Regret Minimization (CFR) [16].",
      "startOffset" : 48,
      "endOffset" : 62
    }, {
      "referenceID" : 11,
      "context" : "There are a number of such iterative algorithms [11, 7, 12, 8], the most popular of which is Counterfactual Regret Minimization (CFR) [16].",
      "startOffset" : 48,
      "endOffset" : 62
    }, {
      "referenceID" : 7,
      "context" : "There are a number of such iterative algorithms [11, 7, 12, 8], the most popular of which is Counterfactual Regret Minimization (CFR) [16].",
      "startOffset" : 48,
      "endOffset" : 62
    }, {
      "referenceID" : 0,
      "context" : "CFR+, a variant of CFR, was used to essentially solve Limit Texas Hold’em, the largest imperfect-information game ever to be essentially solved [1].",
      "startOffset" : 144,
      "endOffset" : 147
    }, {
      "referenceID" : 13,
      "context" : "This data had to be repeatedly decompressed from disk into memory and then compressed back to disk in order to run CFR+ [14].",
      "startOffset" : 120,
      "endOffset" : 124
    }, {
      "referenceID" : 1,
      "context" : "Regret Based Pruning (RBP) is an improvement to CFR that greatly reduces the computation time needed to solve large games by temporarily pruning suboptimal actions [2].",
      "startOffset" : 164,
      "endOffset" : 167
    }, {
      "referenceID" : 3,
      "context" : "While Total RBP still requires enough memory to store the entire game in the early iterations, recent work has shown that these early iterations can be skipped by first solving a low-memory abstraction of the game and then using its solution to warm starting CFR in the full game [4].",
      "startOffset" : 280,
      "endOffset" : 283
    }, {
      "referenceID" : 2,
      "context" : "Total RBP’s reduction in space is also helpful to the Simultaneous Abstraction and Equilibrium Finding (SAEF) algorithm [3], which starts CFR with a small abstraction of the game and progressively expands the abstraction while also solving the game.",
      "startOffset" : 120,
      "endOffset" : 123
    }, {
      "referenceID" : 5,
      "context" : "We use regret matching (RM) [6] as the regret-minimization algorithm.",
      "startOffset" : 28,
      "endOffset" : 31
    }, {
      "referenceID" : 9,
      "context" : "A counterfactual best response [10] (CBR) is a strategy similar to a best response, except that it maximizes counterfactual value even at information sets that it does not reach due to its earlier actions.",
      "startOffset" : 31,
      "endOffset" : 35
    }, {
      "referenceID" : 14,
      "context" : "In two-player zero-sum games, if both players’ average regret R i T ≤ , their average strategies 〈σ̄ 1 , σ̄ 2 〉 form a 2 -equilibrium [15].",
      "startOffset" : 134,
      "endOffset" : 138
    }, {
      "referenceID" : 8,
      "context" : "The benefit of this form of pruning, which we refer to as partial pruning, varies depending on the game, but empirical results show a factor of 30 improvement in some games [9].",
      "startOffset" : 173,
      "endOffset" : 176
    }, {
      "referenceID" : 1,
      "context" : "While partial pruning allows one to prune paths that an opponent reaches with zero probability, interval regret-based pruning (Interval RBP) allows one to also prune paths that the traverser reaches with zero probability [2].",
      "startOffset" : 221,
      "endOffset" : 224
    }, {
      "referenceID" : 3,
      "context" : "The proof for Theorem 1 draws from recent work on warm starting CFR using only an average strategy profile [4].",
      "startOffset" : 107,
      "endOffset" : 110
    }, {
      "referenceID" : 12,
      "context" : "The experiments are conducted on Leduc Hold’em [13] and Leduc-5 [2].",
      "startOffset" : 47,
      "endOffset" : 51
    }, {
      "referenceID" : 1,
      "context" : "The experiments are conducted on Leduc Hold’em [13] and Leduc-5 [2].",
      "startOffset" : 64,
      "endOffset" : 67
    } ],
    "year" : 2016,
    "abstractText" : "Counterfactual Regret Minimization (CFR) is the most popular iterative algorithm for solving zero-sum imperfect-information games. Regret-Based Pruning (RBP) is an improvement that allows poorly-performing actions to be temporarily pruned, thus speeding up CFR. We introduce Total RBP, a new form of RBP that reduces the space requirements of CFR as actions are pruned. We prove that in zero-sum games it asymptotically prunes any action that is not part of a best response to some Nash equilibrium. This leads to provably faster convergence and lower space requirements. Experiments show that Total RBP results in an order of magnitude reduction in space, and the reduction factor increases with game size.",
    "creator" : "LaTeX with hyperref package"
  }
}