{
  "name" : "1511.00573.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "From random walks to distances on unweighted graphs",
    "authors" : [ "Tatsunori B. Hashimoto", "Yi Sun", "Tommi S. Jaakkola" ],
    "emails" : [ "thashim@mit.edu", "yisun@mit.edu", "tommi@mit.edu" ],
    "sections" : [ {
      "heading" : "1 Introduction",
      "text" : "Many network metrics have been introduced to measure the similarity between any two vertices. Such metrics can be used for a variety of purposes, including uncovering missing edges or pruning spurious ones. Since the metrics tacitly assume that vertices lie in a latent (metric) space, one could expect that they also recover the underlying metric in some well-defined limit. Surprisingly, there are nearly no known results on this type of consistency. Indeed, it was recently shown [19] that the expected hitting time degenerates and does not measure any notion of distance.\nWe analyze an improved hitting-time metric – Laplace transformed hitting time (LTHT) – and rigorously evaluate its consistency, cluster-preservation, and robustness under a general network model which encapsulates the latent space assumption. This network model, specified in Section 2, posits that vertices lie in a latent metric space, and edges are drawn between nearby vertices in that space. To analyze the LTHT, we develop two key technical tools. We establish a correspondence between functionals of hitting time for random walks on graphs, on the one hand, and limiting Itô processes (Corollary 4.4) on the other. Moreover, we construct a weighted random walk on the graph whose limit is a Brownian motion (Corollary 4.1). We apply these tools to obtain three main results.\nFirst, our Theorem 3.5 recapitulates and generalizes the result of [19] pertaining to degeneration of expected hitting time in the limit. Our proof is direct and demonstrates the broader applicability of the techniques to general random walk based algorithms. Second, we analyze the Laplace transformed hitting time as a one-parameter family of improved distance estimators based on random walks on the graph. We prove that there exists a scaling limit for the parameter β such that the LTHT can become the shortest path distance (Theorem S5.2) or a consistent metric estimator averaging over many paths (Theorem 4.5). Finally, we prove that the LTHT captures the advantages\nar X\niv :1\n51 1.\n00 57\n3v 1\n[ st\nat .M\nL ]\n2 N\nov 2\nof random-walk based metrics by respecting the cluster structure (Theorem 4.6) and robustly recovering similarity queries when the majority of edges carry no geometric information (Theorem 4.9). We now discuss the relation of our work to prior work on similarity estimation.\nQuasi-walk metrics: There is a growing literature on graph metrics that attempts to correct the degeneracy of expected hitting time [19] by interpolating between expected hitting time and shortest path distance. The work closest to ours is the analysis of the phase transition of the p-resistance metric in [1] which proves that p-resistances are nondegenerate for some p; however, their work did not address consistency or bias of p-resistances. Other approaches to quasi-walk metrics such as logarithmic-forest [3], distributed routing distances [16], truncated hitting times [12], and randomized shortest paths [8, 21] exist but their statistical properties are unknown. Our paper is the first to prove consistency properties of a quasi-walk metric.\nNonparametric statistics: In the nonparametric statistics literature, the behavior of k-nearest neighbor and ε-ball graphs has been the focus of extensive study. For undirected graphs, Laplacian-based techniques have yielded consistency for clusters [18] and shortest paths [2] as well as the degeneracy of expected hitting time [19]. Algorithms for exactly embedding k-nearest neighbor graphs are similar and generate metric estimates, but require knowledge of the graph construction method, and their consistency properties are unknown [13]. Stochastic differential equation techniques similar to ours were applied to prove Laplacian convergence results in [17], while the process-level convergence was exploited in [6]. Our work advances the techniques of [6] by extracting more robust estimators from process-level information.\nNetwork analysis: The task of predicting missing links in a graph, known as link prediction, is one of the most popular uses of similarity estimation. The survey [9] compares several common link prediction methods on synthetic benchmarks. The consistency of some local similarity metrics such as the number of shared neighbors was analyzed under a single generative model for graphs in [11]. Our results extend this analysis to a global, walk-based metric under weaker model assumptions."
    }, {
      "heading" : "2 Continuum limits of random walks on networks",
      "text" : ""
    }, {
      "heading" : "2.1 Definition of a spatial graph",
      "text" : "We take a generative approach to defining similarity between vertices. We suppose that each vertex i of a graph is associated with a latent coordinate xi ∈ Rd and that the probability of finding an edge between two vertices depends solely on their latent coordinates. In this model, given only the unweighted edge connectivity of a graph, we define natural distances between vertices as the distances between the latent coordinates xi. Formally, let X = {x1, x2, . . .} ⊂ Rd be an infinite sequence of points drawn i.i.d. from a differentiable density with bounded log gradient p(x) with compact support D. A spatial graph is defined by the following:\nDefinition 2.1 (Spatial graph). Let εn : Xn → R>0 be a local scale function and h : R≥0 → [0, 1] a piecewise continuous function with h(x) = 0 for x > 1, h(1) > 0, and h left-continuous at 1. The spatial graph Gn corresponding to εn and h is the random graph with vertex set Xn and a directed edge from xi to xj with probability pij = h(|xi − xj |εn(xi)−1).\nThis graph was proposed in [6] as the generalization of k-nearest neighbors to isotropic kernels. To make inference tractable, we focus on the large-graph, small-neighborhood limit as n → ∞ and εn(x) → 0. In particular, we will suppose that there exist scaling constants gn and a deterministic continuous function ε : D → R>0 so that\ngn → 0, gnn 1 d+2 log(n)− 1 d+2 →∞, εn(x)g−1n → ε(x) for x ∈ Xn,\nwhere the final convergence is uniform in x and a.s. in the draw of X . The scaling constant gn represents a bound on the asymptotic sparsity of the graph.\nWe give a few concrete examples to make the quantities h, gn, and εn clear.\n1. The directed k-nearest neighbor graph is defined by setting h(x) = 1x∈[0,1], the indicator function of the unit interval, εn(x) the distance to the kth nearest neighbor, and gn = (k/n)1/d the rate at which εn(x) approaches zero.\n2. A Gaussian kernel graph is approximated by setting h(x) = exp(−x2/σ2)1x∈[0,1]. The truncation of the Gaussian tails at σ is an analytic convenience rather than a fundamental limitation, and the bandwidth can be varied by rescaling εn(x)."
    }, {
      "heading" : "2.2 Continuum limit of the random walk",
      "text" : "Our techniques rely on analysis of the limiting behavior of the simple random walk Xnt on a spatial graph Gn, viewed as a discrete-time Markov process with domain D. The increment at step t of Xnt is a jump to a random point in Xn which lies within the ball of radius εn(Xnt ) around Xnt . We observe three effects: (A) the random walk jumps more frequently towards regions of high density; (B) the random walk moves more quickly whenever εn(Xnt ) is large; (C) for εn small and a large step count t, the random variable Xnt −Xn0 is the sum of many small independent (but not necessarily identically distributed) increments. In the n → ∞ limit, we may identify Xnt with a continuous-time stochastic process satisfying (A), (B), and (C) via the following result, which is a slight strengthening of [6, Theorem 3.4] obtained by applying [15, Theorem 11.2.3] in place of the original result of Stroock-Varadhan. Theorem 2.2. The simple random walk Xnt converges uniformly in Skorokhod space D([0,∞), D) after a time scaling t̂ = tg2n to the Itô process Yt̂ valued in the space of continuous functions C([0,∞), D) with reflecting boundary conditions on D defined by\ndYt̂ = ∇ log(p(Yt̂))ε(Yt̂)2/3dt̂+ ε(Yt̂)/ √ 3dWt̂. (1)\nEffects (A), (B), and (C) may be seen in the stochastic differential equation (1) as follows. The direction of the drift is controlled by ∇ log(p(Yt̂)), the rate of drift is controlled by ε(Yt̂)2, and the noise is driven by a Brownian motion Wt̂ with location-dependent scaling ε(Yt̂)/ √ 3.1 We view Theorem 2.2 as a method to understand the simple random walk Xnt through the continuous walk Yt̂. Attributes of stochastic processes such as stationary distribution or hitting time may be defined for both Yt̂ and X n t , and in many cases Theorem 2.2 implies that an appropriately-rescaled version of the discrete attribute will converge to the continuous one. Because attributes of the continuous process Yt̂ can reveal information about proximity between points, this provides a general framework for inference in spatial graphs. We use hitting times of the continuous process to a domain E ⊂ D to prove properties of the hitting time of a simple random walk on a graph via the limit arguments of Theorem 2.2."
    }, {
      "heading" : "3 Degeneracy of expected hitting times in networks",
      "text" : "The hitting time, commute time, and resistance distance are popular measures of distance based upon the random walk which are believed to be robust and capture the cluster structure of the network. However, it was shown in a surprising result in [19] that on undirected geometric graphs the scaled expected hitting time from xi to xj converges to inverse of the degree of xj .\nIn Theorem 3.5, we give an intuitive explanation and generalization of this result by showing that if the random walk on a graph converges to any limiting Itô process in dimension d ≥ 2, the scaled expected hitting time to any point converges to the inverse of the stationary distribution. This answers the open problem in [19] on the degeneracy of hitting times for directed graphs and graphs with general degree distributions such as directed k-nearest neighbor graphs, lattices, and power-law graphs with convergent random walks. Our proof can be understood as first extending the transience or neighborhood recurrence of Brownian motion for d ≥ 2 to more general Itô processes and then connecting hitting times on graphs to their Itô process equivalents."
    }, {
      "heading" : "3.1 Typical hitting times are large",
      "text" : "We will prove the following lemma that hitting a given vertex quickly is unlikely. Let T xixj ,n be the hitting time to xj of Xnt started at xi and T xi E be the continuous equivalent for Yt̂ to hit E ⊂ D .\n1Both the variance Θ(εn(x)2) and expected value Θ(∇ log(p(x))εn(x)2) of a single step in the simple random walk are Θ(g2n). The time scaling t̂ = tg2n in Theorem 2.2 was chosen so that as n→ ∞ there are g−2n discrete steps taken per unit time, meaning the total drift and variance per unit time tend to a non-trivial limit.\nLemma 3.1 (Typical hitting times are large). For any d ≥ 2, c > 0, and δ > 0, for large enough n we have P(T xixj ,n > cg −2 n ) > 1− δ.\nTo prove Lemma 3.1, we require the following tail bound following from the Feynman-Kac theorem. Theorem 3.2 ([10, Exercise 9.12] Feynman-Kac for the Laplace transform). The Laplace transform of the hitting time (LTHT) u(x) = E[exp(−βT xE)] is the solution to the boundary value problem with boundary condition u|∂E = 1:\n1 2 Tr[σTH(u)σ] + µ(x) · ∇u− βu = 0.\nThis will allow us to bound the hitting time to the ball B(xj , s) of radius s centered at xj . Lemma 3.3. For x, y ∈ D, d ≥ 2, and any δ > 0, there exists s > 0 such that E[e−TxB(y,s) ] < δ.\nProof. We compare the Laplace transformed hitting time of the general Itô process to that of Brownian motion via Feynman-Kac and handle the latter case directly. Details are in Section S2.1.\nWe now use Lemma 3.3 to prove Lemma 3.1.\nProof of Lemma 3.1. Our proof proceeds in two steps. First, we have T xixj ,n ≥ T xi B(xj ,s),n a.s. for any s > 0 because xj ∈ B(xj , s), so by Theorem 2.2, we have\nlim n→∞\nE[e−T xi xj,n g−2n ] ≤ lim n→∞ E[e−T xi B(xj,s),n g−2n ] = E[e−T xi B(xj,s) ]. (2)\nApplying Lemma 3.3, we have E[e−T xi B(xj,s) ] < 12δe\n−c for some s > 0. For large enough n, this combined with (2) implies P(T xixj ,n ≤ cg−2n )e−c < δe−c and hence P(T xixj ,n ≤ cg−2n ) < δ."
    }, {
      "heading" : "3.2 Expected hitting times degenerate to the stationary distribution",
      "text" : "To translate results from Itô processes to directed graphs, we require a regularity condition. Let qt(xj , xi) denote the probability that Xnt = xj conditioned on X n 0 = xi. We make the following technical conjecture which we assume holds for all spatial graphs. (?) For t = Θ(g−2n ), the rescaled marginal nqt(x, xi) is a.s. eventually uniformly equicontinuous. 2 Let πXn(x) denote the stationary distribution of Xnt . The following was shown in [6, Theorem 2.1] under conditions implied by our condition (?) (Corollary S2.6). Theorem 3.4. Assuming (?), for a−1 = ∫ p(x)2ε(x)−2dx, we have the a.s. limit\nπ̂(x) := lim n→∞\nnπXn(x) = a p(x)\nε(x)2 .\nWe may now express the limit of expected hitting time in terms of this result. Theorem 3.5. For d ≥ 2 and any i, j, we have\nE[T xixj ,n] n a.s.→ 1 π̂(xj) .\nProof. We give a sketch. By Lemma 3.1, the random walk started at xi does not hit xj within cg−2n steps with high probability. By Theorem S2.5, the simple random walk Xnt mixes at exponential rate, implying in Lemma S2.8 that the probability of first hitting at step t > cg−2n is approximately the stationary distribution at xj . Expected hitting time is then shown to approximate the expectation of a geometric random variable. See Section S2 for a full proof.\nTheorem 3.5 is illustrated in Figures 1A and 1B, which show with only 3000 points, expected hitting times on a k-nearest neighbor graph degenerates to the stationary distribution. 3\n2Assumption (?) is related to smoothing properties of the graph Laplacian and is known to hold for undirected graphs [4]. No directed analogue is known, and [6] conjectured a weaker property for all spatial graphs. See Section S1 for further details.\n3Surprisingly, [19] proved that 1-D hitting times diverge despite convergence of the continuous equivalent. This occurs because the discrete walk can jump past the target point. In Section S2.4, we consider 1-D hitting"
    }, {
      "heading" : "4 The Laplace transformed hitting time (LTHT)",
      "text" : "In Theorem 3.5 we showed that expected hitting time is degenerate because a simple random walk mixes before hitting its target. To correct this we penalize longer paths. More precisely, consider for β̂ > 0 and βn = β̂g2n the Laplace transforms E[e−β̂T x E ] and E[e−βnT x E,n ] of T xE and T x E,n.\nThese Laplace transformed hitting times (LTHT’s) have three advantages. First, while the expected hitting time of a Brownian motion to a domain is dominated by long paths, the LTHT is dominated by direct paths. Second, the LTHT for the Itô process can be derived in closed form via the FeynmanKac theorem, allowing us to make use of techniques from continuous stochastic processes to control the continuum LTHT. Lastly, the LTHT can be computed both by sampling and in closed form as a matrix inversion (Section S3). Now define the scaled log-LTHT as\n− log(E[e−βnT xi xj,n ])/ √ 2βngn.\nTaking different scalings for βn with n interpolates between expected hitting time (βn → 0 on a fixed graph) and shortest path distance (βn →∞) (Figures 1C, D, and E). In Theorem 4.5, we show that the intermediate scaling βn = Θ(β̂g2n) yields a consistent distance measure retaining the unique properties of hitting times. Most of our results on the LTHT are novel for any quasi-walk metric.\nWhile considering the Laplace transform of the hitting time is novel to our work, this metric has been used in the literature in an ad-hoc manner in various forms as a similarity metric for collaboration networks [20], hidden subgraph detection [14], and robust shortest path distance [21]. However, these papers only considered the elementary properties of the limits βn → 0 and βn → ∞. Our consistency proof demonstrates the advantage of the stochastic process approach."
    }, {
      "heading" : "4.1 Consistency",
      "text" : "It was shown previously that for n fixed and βn → ∞, − log(E[−βnT xixj ,n])/βngn converges to shortest path distance from xi to xj . We investigate more precise behavior in terms of the scaling of βn. There are two regimes: if βn = ω(log(gdnn)), then the shortest path dominates and the LTHT converges to shortest path distance (See Theorem S5.2). If βn = Θ(β̂g2n), the graph log-LTHT converges to its continuous equivalent, which for large β̂ averages over random walks concentrated around the geodesic. To show consistency for βn = Θ(β̂g2n), we proceed in three steps: (1) we reweight the random walk on the graph so the limiting process is Brownian motion; (2) we show that log-LTHT for Brownian motion recovers latent distance; (3) we show that log-LTHT for the reweighted walk converges to its continuous limit; (4) we conclude that log-LTHT of the reweighted walk recovers latent distance.\n(1) Reweighting the random walk to converge to Brownian motion: We define weights using the estimators p̂ and ε̂ for p(x) and ε(x) from [6].\ntimes to small out neighbors which corrects this problem and derive closed form solutions (Theorem S2.12). This hitting time is non-degenerate but highly biased due to boundary terms (Corollary S2.14).\nTheorem 4.1. Let p̂ and ε̂ be consistent estimators of the density and local scale and A be the adjacency matrix. Then the random walk X̂nt defined below converges to a Brownian motion.\nP(X̂nt+1 = xj | X̂nt = xi) = { Ai,j p̂(xj) −1 ∑ k Ai,kp̂(xk) −1 ε̂(xi) −2 i 6= j\n1− ε̂(xi)−2 i = j\nProof. Reweighting by p̂ and ε̂ is designed to cancel the drift and diffusion terms in Theorem 2.2 by ensuring that as n grows large, jumps have means approaching 0 and variances which are asymptotically equal (but decaying with n). See Theorem S4.1. 4\n(2) Log-LTHT for a Brownian motion: Let Wt be a Brownian motion with W0 = xi, and let T xi B(xj ,s) be the hitting time of Wt to B(xj , s). We show that log-LTHT converges to distance.\nLemma 4.2. For any α < 0, if β̂ = sα, as s→ 0 we have\n− log(E[exp(−β̂T xiB(xj ,s))])/ √ 2β̂ → |xi − xj |.\nProof. We consider hitting time of Brownian motion started at distance |xi − xj | from the origin to distance s of the origin, which is controlled by a Bessel process. See Subsection S6.1 for details.\n(3) Convergence of LTHT for βn = Θ(β̂g2n): To compare continuous and discrete log-LTHT’s, we will first define the s-neighborhood of a vertex xi onGn as the graph equivalent of the ballB(xi, s). Definition 4.3 (s-neighborhood). Let ε̂(x) be the consistent estimate of the local scale from [6] so that ε̂(x) → ε(x) uniformly a.s. as n → ∞. The ε̂-weight of a path xi1 → · · · → xil is the sum∑l−1 m=1 ε̂(xim) of vertex weights ε̂(xi). For s > 0 and x ∈ Gn, the s-neighborhood of x is\nNBsn(x) := {y | there is a path x→ y of ε̂-weight ≤ g−1n s}.\nFor xi, xj ∈ Gn, let T̂ xiB(xj ,s) be the hitting time of the transformed walk onGn from xi to NB s n(xj). We now verify that hitting times to the s-neighborhood on graphs and the s-radius ball coincide.\nCorollary 4.4. For s > 0, we have g2nT̂ xi NBsn(xj),n d→ T xiB(xj ,s).\nProof. We verify that the ball and the neighborhood have nearly identical sets of points and apply Theorem 2.2. See Subsection S6.2 for details.\n(4) Proving consistency of log-LTHT: Properly accounting for boundary effects, we obtain a consistency result for the log-LTHT for small neighborhood hitting times.\nTheorem 4.5. Let xi, xj ∈ Gn be connected by a geodesic not intersecting ∂D. For any δ > 0, there exists a choice of β̂ and s > 0 so that if βn = β̂g2n, for large n we have with high probability\n∣∣∣∣− log(E[exp(−βnT̂ xi NBsn(xj),n )])/ √ 2β̂ − |xi − xj | ∣∣∣∣ < δ.\nProof of Theorem 4.5. The proof has three steps. First, we convert to the continuous setting via Corollary 4.4. Second, we show the contribution of the boundary is negligible. The conclusion follows from the explicit computation of Lemma S6.1. Full details are in Section S6.\nThe stochastic process limit based proof of Theorem 4.5 implies that the log-LTHT is consistent and robust to small perturbations to the graph which preserve the same limit (Supp. Section S8).\n4This is a special case of a more general theorem for transforming limits of graph random walks (Theorem S4.1). Figure S1 shows that this modification is highly effective in practice."
    }, {
      "heading" : "4.2 Bias",
      "text" : "Random walk based metrics are often motivated as recovering a cluster preserving metric. We now show that the log-LTHT of the un-weighted simple random walk preserves the underlying cluster structure. In the 1-D case, we provide a complete characterization. Theorem 4.6. Suppose the spatial graph has d = 1 and h(x) = 1x∈[0,1]. Let T xi\nNB ε̂(xj)gn n (xj),n\nbe\nthe hitting time of a simple random walk from xi to the out-neighborhood of xj . It converges to\n− log(E[−βT xi NB ε̂(xj)gn n (xj),n\n])/ √ 8β → ∫ xj xi √ m(x)dx+ o ( log(1 + e− √ 2β)/ √ 2β ) ,\nwhere m(x) = 2ε(x)2 + 1 β ∂ log(p(x)) ∂x2 + 1 β\n( ∂ log(p(x))\n∂x\n)2 defines a density-sensitive metric.\nProof. Apply the WKBJ approximation for Schrodinger equations to the Feynman-Kac PDE from Theorem 3.2. See Corollary S7.2 and Corollary S2.13 for a full proof.\nThe leading order terms of the density-sensitive metric appropriately penalize crossing regions of large changes to the log density; this is not the case for the expected hitting time (Theorem S2.12)."
    }, {
      "heading" : "4.3 Robustness",
      "text" : "While shortest path distance is a consistent measure of the underlying metric, it breaks down catastrophically with the addition of a single non-geometric edge and does not meaningfully rank vertices that share an edge. In contrast, we show that LTHT breaks ties between vertices via the resource allocation (RA) index, a robust local similarity metric under Erdős-Rényi-type noise. 5 Definition 4.7. The noisy spatial graph Gn over Xn with noise terms q1(n), . . ., qn(n) is constructed by drawing an edge from xi to xj with probability\npij = h(|xi − xj |εn(xi)−1)(1− qj(n)) + qj(n).\nDefine the directed RA index in terms of the out-neighborhood set NBn(xi) and the in-neighborhood set NBinn (xi) as Rij := ∑ xk∈NBn(xi)∩NBinn(xj) |NBn(xk)|\n−1 and two step log-LTHT by M tsij := − log(E[exp(−βT xixj ,n) | T xixj ,n > 1]). 6 We show two step log-LTHT and RA index give equivalent methods for testing if vertices are within distance εn(x). Theorem 4.8. If β = ω(log(gdnn)) and xi and xj have at least one common neighbor, then\nM tsij − 2β → − log(Rij) + log(|NBn(xi)|).\nProof. Let Pij(t) be the probability of going from xi to xj in t steps, and Hij(t) the probability of not hitting before time t. Factoring the two-step hitting time yields\nM tsij = 2β − log(Pij(2))− log ( 1 + ∞∑\nt=3\nPij(t) Pij(2) Hij(t)e\n−β(t−2) ) .\nLet kmax be the maximal out-degree in Gn. The contribution of paths of length greater than 2 vanishes because Hij(t) ≤ 1 and Pij(t)/Pij(2) ≤ k2max, which is dominated by e−β for β = ω(log(gnn)). Noting that Pij(2) =\nRij |NBn(xi)| concludes. For full details see Theorem S9.1.\nFor edge identification within distance εn(x), the RA index is robust even at noise level q = o(g d/2 n ).\n5Modifying the graph by changing fewer than g2n/n edges does not affect the continuum limit of the random graph, and therefore preserve the LTHT with parameter β = Θ(g2n). While this weak bound allows on average o(1) noise edges per vertex, it does show that the LTHT is substantially more robust than shortest paths without modification. See Section S8 for proofs.\n6The conditioning T xixj ,n > 1 is natural in link-prediction tasks where only pairs of disconnected vertices are queried. Empirically, we observe it is critical to performance (Figure 3).\nTheorem 4.9. If qi = q = o(g d/2 n ) for all i, for any δ > 0 there are c1, c2 and hn so that for any i, j, with probability at least 1− δ we have • |xi − xj | < min{εn(xi), εn(xj)} if Rijhn < c1; • |xi − xj | > 2 max{εn(xi), εn(xj)} if Rijhn > c2.\nProof. The minimal RA index follows from standard concentration arguments (see S9.2)."
    }, {
      "heading" : "5 Link prediction tasks",
      "text" : "We compare the LTHT against other baseline measures of vertex similarity: shortest path distance, expected hitting time, number of common neighbors, and the RA index. A comprehensive evaluation of these quasi-walk metrics was performed in [8] who showed that a metric equivalent to the LTHT performed best. We consider two separate link prediction tasks on the largest connected component of vertices of degree at least five, fixing β = 0.2.7 The degree constraint is to ensure that local methods using number of common neighbors such as the resource allocation index do not have an excessive number of ties. Code to generate figures in this paper are contained in the supplement.\nCitation network: The KDD 2003 challenge dataset [5] includes a directed, unweighted network of e-print arXiv citations whose dense connected component has 11,042 vertices and 222,027 edges. We use the same benchmark method as [9] where we delete a single edge and compare the similarity of the deleted edge against the set of control pair of vertices i, j which do not share an edge. We count the fraction of pairs on which each method rank the deleted edge higher than all other methods. We find that LTHT is consistently best at this task (Figure 2). 8\nAssociative Thesaurus network: The Edinburgh associative thesaurus [7] is a network with a dense connected component of 7754 vertices and 246,609 edges in which subjects were shown a set of ten words and for each word was asked to respond with the first word to occur to them. Each vertex represents a word and each edge is a weighted, directed edge where the weight from xi to xj is the number of subjects who responded with word xj given word xi.\nWe measure performance by whether strong associations with more than ten responses can be distinguished from weak ones with only one response. We find that the LTHT performs best and that preventing one-step jumps is critical to performance as predicted by Theorem 4.8 (Figure 3)."
    }, {
      "heading" : "6 Conclusion",
      "text" : "Our work has developed an asymptotic equivalence between hitting times for random walks on graphs and those for diffusion processes. Using this, we have provided a short extension of the proof for the divergence of expected hitting times, and derived a new consistent graph metric that is theoretically principled, computationally tractable, and empirically successful at well-established link prediction benchmarks. These results open the way for the development of other principled quasi-walk metrics that can provably recover underlying latent similarities for spatial graphs.\n7Results are qualitatively identical when varying β from 0.1 to 1; see supplement for details. 8The two-step LTHT is not shown since it is equivalent to the LTHT in missing link prediction."
    }, {
      "heading" : "1 Uniform equicontinuity of the marginals 1",
      "text" : ""
    }, {
      "heading" : "2 Hitting times 3",
      "text" : "2.1 Typical hitting times are large . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 2.2 Exponential mixing on spatial graphs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 2.3 Expected hitting times degenerate to the stationary distribution . . . . . . . . . . . . . . . . 6 2.4 The case of one dimension . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10"
    }, {
      "heading" : "3 Computing the LTHT 11",
      "text" : ""
    }, {
      "heading" : "4 Reweighting the random walk 12",
      "text" : "4.1 General construction and application to Brownian motion . . . . . . . . . . . . . . . . . . . . 12 4.2 Technical moment estimates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13"
    }, {
      "heading" : "5 Consistency at β = ω(log(gdnn)) via shortest paths 15",
      "text" : ""
    }, {
      "heading" : "6 Consistency of LTHT 16",
      "text" : "6.1 LTHT of the Brownian motion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 6.2 Proof of Corollary 4.4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 6.3 Proof of Theorem 4.5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19"
    }, {
      "heading" : "7 1-D bias calculation 22",
      "text" : ""
    }, {
      "heading" : "8 Basic noise resistance 24",
      "text" : ""
    }, {
      "heading" : "9 Resource allocation index 26",
      "text" : "9.1 RA index reduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 9.2 RA index robustness . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27"
    }, {
      "heading" : "1 Uniform equicontinuity of the marginals",
      "text" : "We discuss condition (?) stated in the main text. We conjecture and assume that the following technical condition holds on all spatial graphs.\n(?) For t = Θ(g−2n ), the rescaled marginal density nqt(x, xi) is a.s. eventually uniformly equicontinuous.\nTo make the terminology we use in (?) clear, we rephrase it as follows.\nDefinition S1.1 (Condition ?). If t = Θ(g−2n ), with probability 1, for any δ > 0, there exist γ > 0 and n0 so that for n > n0, any xk ∈ Xn, and any xi, xj ∈ Xn with |xi − xj | < γ, we have\n|nqt(xi, xk)− nqt(xj , xk)| < δ.\nThis statement allows us to convert the weak convergence in distribution ensured by Theorem 2.2 and the results of (Stroock & Varadhan, 1971) to the convergence in density required by Corollary S2.6. Such a statement rules out the possibility that the density function qt(x, xi) oscillates at frequencies increasing with n as n→∞. Controlling regularity of qt(x, xi) seems to be a critical ingredient for approaching (?).\nIn the case of an undirected graph, (?) follows from results in the literature. The strong local limit law for simple random walks shown in (Croydon & Hambly, 2008) yields an even stronger result than (?). In addition, in the same setting, the convergence result for spectral clustering of (von Luxburg et al., 2008) yields an equicontinuity result for eigenvectors of the Laplacian which implies (?).\nHowever, for directed graphs no such result exists, and non-reversibility of the Markov chain seems to be an obstacle to proving such a result. Some results on utilizing the directed Laplacian as a smoothing operator (Zhou et al., 2005) exist in this direction. We believe these techniques could lead to an approach to (?) but thus far they have not yielded a sufficiently strong equicontinuity result.\nRemark 1. In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution nπXn(x). We believe “uniform equicontinuity” should be corrected to “eventual uniform equicontinuity” there. In Corollary S2.6, we show that (?) implies the conjecture of Hashimoto et al. (2015).\nOne consequence of equicontinuity is that convergence in distribution implies convergence in density. We prove this for the marginal distribution q̂t̂(xk, xi) of Yt̂ for the purpose of Theorem 3.5, following the original strategy of (Hashimoto et al., 2015).\nLemma S1.2 (Convergence of marginal densities). If tng 2 n = t̂ = Θ(1), then under (?) we have\nlim n→∞\nnqtn(x, xi) = q̂t̂(x, xi)\np(x) ,\nwhere the convergence is uniform in x and xi.\nProof. The a.s. weak convergence of processes of Theorem 2.2 (which is uniform in xi) implies by (Ethier & Kurtz, 1986, Theorem 4.9.12) that the empirical marginal distribution\ndµn = n∑\nj=1\nqtn(xj , xi)δxj\nconverges weakly to the marginal distribution dµ = q̂t̂(x, xi)dx for Yt̂. For any x ∈ X and δ > 0, weak convergence against the test function 1B(x,δ) yields\n∑\ny∈Xn,|y−x|<δ qtn(y, xi)→\n∫\n|y−x|<δ q̂t̂(y, xi)dy.\nBy eventual uniform equicontinuity of nqt(x, xi), for any ε > 0 there is small enough δ > 0 so that for all n we have ∣∣∣∣∣∣ ∑ y∈Xn,|y−x|<δ qtn(y, xi)− |Xn ∩B(x, δ)|qtn(x, xi) ∣∣∣∣∣∣ ≤ n−1|Xn ∩B(x, δ)|ε,\nwhich implies that\nlim n→∞ qtn(x, xi)p(x)n = lim δ→0 lim n→∞\nV −1d δ −dnqtn(x, xi)\n∫\n|y−x|<δ p(y)dy\n= lim δ→0 lim n→∞\nV −1d δ −d|Xn ∩B(x, δ)|qtn(x, xi) = lim δ→0 V −1d δ\n−d ∫\n|y−x|<δ q̂t̂(y, xi)dy = q̂t̂(x, xi).\nWe conclude the desired\nlim n→∞\nnqt(x, xi) = q̂t̂(x, xi)\np(x) ,\nwhere uniformity in x comes from (?) and uniformity in xi comes from uniformity of Theorem 2.2."
    }, {
      "heading" : "2 Hitting times",
      "text" : "In this section, we prove Theorem 3.5 to generalize the result of von Luxburg et al. (2014) on degenerate behavior of hitting times via Lemma 3.1. Our proof consists of two parts. First, we show that by Lemma 3.1 we can make the random walk mix before hitting any point. Next, we use this to show that if the chain is sufficiently mixed, then the expected hitting time is degenerate."
    }, {
      "heading" : "2.1 Typical hitting times are large",
      "text" : "In this subsection, we give a complete proof of Lemma 3.3, reproduced here. Recall that T xiE is the hitting time of Yt from xi to a domain E ⊂ D. We will require a more general version of the Feynman-Kac theorem. Theorem S2.1 ((Øksendal, 2003, Exercise 9.12) Feynman-Kac). Let Zt be an Itô process in Rd defined by\ndZt = µ(Zt)dt+ σ(Zt)dBt.\nFor a function V (x) and T xE the hitting time to a domain E ⊂ D, the function\nu(x) = E [ e− ∫ TxE 0 V (Zs)ds ]\nis the solution to the boundary value problem\n1 2 Tr[σTHuσ] + µ(x) · ∇u− V (x)u = 0\nwith boundary condition u|∂E = 1.\nLemma S2.2. For x, y ∈ D, d ≥ 2, and any δ > 0, there exists s > 0 such that E[e−TxB(y,s) ] < δ.\nProof. We use Feynman-Kac to compare E[e−T x B(y,s) ] for the general process to that of Brownian motion. By Theorem 3.2, us(x) = E[e−T x B(y,s) ] satisfies the boundary value problem\n∆us + 2∇p(x) · ∇us − 2usε(x)−2 = 0\nwith us|B(y,s) ≡ 1. This is equivalent to ∑\ni\n( ∂i[p(x) 2∂ius]− 2\nd us p(x)2 ε(x)2\n) = 0.\nSet vs(x) = p(x)us(x) and change variables to obtain\n∑\ni\n( ∂i[p(x)∂ivs − vs(x)∂ip(x)]− 2\nd vs p(x) ε(x)2\n) = p(x)∆vs −∆p(x)vs − vs 2p(x)\nε(x)2 = 0,\nwhich is equivalent to\n∆vs − (∆p(x) p(x) + 2ε(x)−2 ) vs = 0\nwith boundary condition vs|∂B(y,s) = 1. Theorem S2.1 for V (x) = ∆p(x)p(x) + 2ε(x)−2 implies\nvs(x) = E [ e− ∫ TxB(y,s) 0 ∆p(Br) p(Br) +2ε(Br) −2dr ]\nfor Bt Brownian motion started at x and T x\nB(y,s) the hitting time of Bt to B(y, s). For a constant C depending on p and ε, we have\nus(x) = vs(x) p(x) ≤ E[e−CT x B(y,s) ].\nApplying Lemma S2.3 with this C implies us(x) < δe −c, as needed.\nLemma S2.3. For x, y ∈ D, let Bt be a Brownian motion with reflecting boundary condition in D started at x and T xB(y,s) its hitting time to B(y, s). Then for any sufficiently small C, c, δ > 0, there exists some s > 0 so that\nE[e−CT x B(y,s) ] < δe−c.\nProof. Fix c > 0 and δ > 0 small enough so that e−cδ < 1/10. If |x− y| = p, by Theorem 3 of Byczkowski et al. (2013), the probability density of T xB(y,s) started at x if there were no outer boundary is bounded by\np(t) < C1 s3(p− s)e− (p−s)\n2\n2t\npt3/2\n{ ((t/s2) d−3 2 + (p/s) d−3 2 )−1 d > 2\n(p/s+t/s2)1/2(1+log(p/s)) (1+log(1+t/ps))(1+log(p/s+t/s2)) d = 2\nfor some constant C1. Choosing constants: We claim that we can choose s, p, and r with r > p > s > 0 so that:\n(a) B(y, r) is contained entirely in the domain D;\n(b1) r 2−d−p2−d r2−d−s2−d > max{1/2, 1−e −cδ 1− 12 e−cδ } if d > 2;\n(b2) log r−log plog r−log s > max{1/2, 1−e −cδ\n1− 12 e−cδ } if d = 2;\n(c1) C1s d ( C−1 + ∫∞ 1 ud/2−2e−(p−s) 2udu ) < 14δe −c if d > 2;\n(c2a) C1s 2 ∫∞ 1 e−Ct(ps+ t)1/2dt < 18δe −c if d = 2;\n(c2b) C1s 2(ps+ 1)1/2 ∫ 1 0 t−3/2e−(p−s) 2/2tdt < 18δe −c if d = 2.\nFor d > 2, we have that\nΓ(d/2− 1) (p− s)d−2 = (p− s)\n2−d ∫ ∞\n0\nxd/2−2e−xdx = ∫ ∞\n0\nud/2−2e−(p−s) 2udu >\n∫ ∞\n1\nud/2−2e−(p−s) 2udu.\nThen for p = 2qr and s = qr, we have that\nr2−d − p2−d r2−d − s2−d = 1− 2d−2qd−2 1− qd−2 > 1− 2 d−2qd−2\nand that\nsd Γ(d/2− 1) (p− s)d−2 < q 2r2Γ(d/2− 1)\nTherefore, sending r → 0 and q → 0 gives a choice of r > p > s satisfying (a), (b1), and (c1) as needed. For d = 2, notice that for t = u−1, we have\n∫ 1\n0\nt−3/2e−(p−s) 2/2tdt =\n∫ ∞\n1\nu−1/2e−(p−s) 2u/2du.\nObserve now that\n(p− s)−1Γ(1/2) = (p− s)−1 ∫ ∞\n0\nt−1/2e−tdt = ∫ ∞\n0\nu−1/2e−(p−s) 2udu >\n∫ ∞\n1\nu−1/2e−(p−s) 2udu,\nwhence we conclude that\nC1 s2 √ ps+ 1\np− s Γ(1/2) > C1s 2(ps+ 1)1/2\n∫ 1\n0\nt−3/2e−(p−s) 2/2tdt.\nAgain choose p = 2qr and s = qr, for which we obtain\nC1s 2(ps+ 1)1/2\n∫ 1\n0\nt−3/2e−(p−s) 2/2tdt < C1Γ(1/2)qr √ 4q2r2 + 1.\nSending q and r to 0 then yields r > p > s satisfying (a), (b2) because q → 0, (c2a) because s → 0 and (ps+ t)1/2 < (1 + t)1/2, and (c2b) by the estimate above. Bounding the Laplace transform: Having chosen r > p > s > 0 with the desired properties, we have for any z ∈ D that\nE[e−CT z B(y,s) ] ≤ max |x−y|=p E[e−CT x B(y,s) ].\nOur strategy will be to bound E[e−CT x B(y,s) ] for any x with |x − y| = p. Fix such an x. Let E be the event that the walk hits B(y, s) before B(y, r). By Theorem 3.17 of Mörters & Peres (2010), the probability of E is r 2−d−p2−d r2−d−s2−d if d > 2 and log r−log p log r−log s if d = 2. By our choice of parameters, this probability is at least P(E) > max{1/2, 1−e−cδ 1− 12 e−cδ\n}. Let E′[e−CT x B(y,s) ] denote the case where there is no outside boundary. For d > 2, we have\nE′[e−CT x B(y,s) ] < C1s d\n∫ ∞\n0\ne−Ctt−d/2e−(p−s) 2/2tdt\n< C1s d ( C−1 + ∫ 1\n0\nt−d/2e−(p−s) 2/2tdt\n)\n< C1s d ( C−1 + ∫ ∞\n1\nud/2−2e−(p−s) 2udu\n)\n< 1 4 δe−c\nby the choice of s and p. For d = 2, we have\nE′[e−CT x B(y,s) ] < C1s 2\n∫ ∞\n0\ne−Ctt−3/2e−(p−s) 2/2t(ps+ t)1/2dt <\n1 4 δe−c\nagain by our choice of s and p. Conditioning on E, we find that\nE[e−CT x B(y,s) |E] ≤ P(E)−1E′[e−CTxB(y,s) ] < 1 2 δe−c.\nThis implies the desired\nE[e−CT x B(y,s) ] ≤ P(E)E[e−CTxB(y,s) ] + (1− P(E)) < δe−c."
    }, {
      "heading" : "2.2 Exponential mixing on spatial graphs",
      "text" : "In this subsection, we show that mixing rates are exponential on spatial graphs as assuming (?).\nLemma S2.4 (Uniform Doeblin condition). Assuming (?), there exist α > 0 and K <∞ so that for some n0 > 0 and t̂0 > 0, we have for n > n0 and t̂ > t̂0 that\n1. minx,xi∈Xn q n dt̂g−2n e (x, xi) > α n ;\n2. maxx,xi∈Xn q n dt̂g−2n e (x, xi) < K n .\nProof. By Lemma S1.2, assuming (?) we have nqndt̂g−2n e (x, xi)→ q̂t̂(x, xi)/p(x), where convergence is uniform in x and xi. Therefore, we may choose n0 > 0 and t̂0 > 0 so that for n > n0 and t̂ > t̂0, we have for any x, xi ∈ Xn that\nmin x,xi∈D q̂t̂(x, xi)/p(x) ≤ nqndt̂g−2n e(x, xi) ≤ maxx,xi∈D q̂t̂(x, xi)/p(x),\nwhere the first and last quantities are well-defined by compactness of D. Taking\nα = 1\n2 min x,y∈D q̂t̂(x, y)/p(x) and K = 2 max x,y∈D q̂t̂(x, y)/p(x)\nthus fulfills the desired conditions.\nTheorem S2.5. Then we may choose t̂0, n0 > 0 and C, β > 0 so that for t̂ > t̂0, n > n0 and xi, x ∈ Xn, we have\n|qndt̂g−2n e(x, xi)− πXn(x)| < C exp(−βt̂)πXn(x).\nProof. By Lemma S2.4, the family of processes Xnt satisfies the uniform Doeblin condition of (Eloranta, 1990, Section 2.8). The claim follows by the consequences for exponential mixing given in the analogue of (Eloranta, 1990, Theorem 2.7).\nCorollary S2.6. Assuming (?), the rescaled stationary distribution nπXn(x) is a.s. eventually uniformly equicontinuous.\nProof. Choose α,K, t̂1, n1 by Lemma S2.4 so that for n > n1, t̂ > t̂1, we have\nα n < qndt̂g−2n e(x, xi) < K n .\nChoose C, β, t̂2, n2 by Theorem S2.5 so that for n > n2, t̂ > t̂2, we have\n|qndt̂g−2n e(x, xi)− πXn(x)| < C exp(−βt̂)πXn(x).\nThus, for n > max{n1, n2} and t̂ > max{t̂1, t̂2}, we have\n|qndt̂g−2n e(x, xi)− πXn(x)| < C exp(−βt̂)πXn(x) < CK n exp(−βt̂). (1)\nNow, for any γ > 0, choose n0 > max{n1, n2} and t̂0 > max{t̂1, t̂2} large enough and δ > 0 so that • CKn0 exp(−βt̂0) < γ/3; • by eventual uniform equicontinuity of nqndt̂0g−2n e(x, xi), for n > n0, if |x− y| < δ, then\n|nqndt̂0g−2n e(x, xi)− nq n dt̂0g−2n e(y, xi)| < γ/3.\nNow, for n > n0 and |x− y| < δ, we find that\n|nπXn(x)− nπXn(y)| ≤ |nqndt̂0g−2n e(x, xi)− nq n dt̂0g−2n e(y, xi)|+ |nq n dt̂0g−2n e(x, xi)− nπXn(x)|\n+ |nqndt̂0g−2n e(y, xi)− nπXn(y)|\n< γ/3 + 2CK\nn exp(−βt̂0)\n< γ,\nwhere we apply (1). This implies that nπXn(x) is eventually uniformly equicontinuous, as needed."
    }, {
      "heading" : "2.3 Expected hitting times degenerate to the stationary distribution",
      "text" : "For any xj , let π ′ Xn be the stationary distribution of the simple random walk on the graph G ′ n formed from Gn by removing xj and all edges incident to it.\nLemma S2.7. Assuming (?), the rescaled stationary density nπ′Xn(x) is a.s. eventually uniformly equicontinuous and satisfies\nlim n→∞\nnπ′Xn(x) = π̂(x).\nProof. Let q′t(x, xi) be the marginal distribution of the simple random walk on the modified graph G ′ n. Because G′n is also a spatial graph, by (Hashimoto et al., 2015, Theorem 3.4), the time-rescaled simple random walks on G′n and Gn converge to the same continuous-time Itô process, and we have under (?) that\nlim n→∞\nnπ′Xn(xi) = π̂(xi),\nwhere the convergence is uniform in xi.\nLemma S2.8. There exist t0 > 0, n0 > 0, and C, β > 0 so that for all t̂ > t0 and n > n0 and any integer t > t̂g−2n , we have\n∣∣∣∣∣∣ nP ( T xixj ,n = t | T xixj ,n ≥ t ) − n ∑\nx∈NBinn(xj)\nπ′Xn(x) |NBn(x)| ∣∣∣∣∣∣ < C exp(−βtg2n).\nProof. By Theorem S2.5, we may choose t̂0 > 0, n0 > 0, C1 > 0, and β > 0 so that for t̂ > t̂0 and n > n1, we have\n|q′dt̂g−2n e−1(x, xi)− π ′ Xn(x)| < C1 exp(−βt̂)π′Xn(xj).\nWe claim that the desired result will hold for t̂0 and this n0. By definition, we have\nP ( T xixj ,n = t | T xixj ,n ≥ t ) =\n∑\nx∈NBinn(xj)\nq′t−1(x, xi)\n|NBn(x)|\nfrom which we conclude that for t > t̂0g −2 n we have\n∣∣∣∣P ( T xixj ,n = t | T xixj ,n ≥ t ) − ∑\nx∈NBinn(xj)\nπ′Xn(x) |NBn(x)|\n∣∣∣∣ ≤ ∣∣∣∣ ∑\nx∈NBinn(xj)\nq′t−1(x, xi)− π′Xn(x) |NBn(x)| ∣∣∣∣\n< C1 exp(−βtg2n) ∑\nx∈NBinn(xj)\nπ′Xn(x) |NBn(x)|\n< C1 exp(−βtg2n) |NBinn (xj)|\nminx |NBn(x)| max x\nπ′Xn(x).\nWe now show there exists C2 > 0 such that |NBinn(xj)|\nminx |NBn(x)| < C2 almost surely due to the construction of gn and ε. By the out-degree estimate of an isotropic graph (Hashimoto et al., 2015, Theorem S3.2)1, we have\n|NBn(x)| |Xn ∩B(x, εn(x))| → C(h)p(x)\nfor some constant C(h) independent of x and n. Further, since the number of points in |Xn ∩B(x, εn(x))| ∼ Pois(εn(x)\ndVdp(x)), we obtain for a constant 0 < Cx <∞ dependent on p, Vd and C(h) that |NBn(x)| εn(x)dn → Cx.\nFor the denominator minx |NBn(x)|, the above limit immediately implies that minx |NBn(x)|ε−dn n−1 → minx Cx > 0 by the lower bounds on p(x) and εn(x).\nFor the numerator, note that by construction of ε, for any δ > 0 there exists a n such that εn(x) −d < (1 + δ) maxx ε(x) −dg−dn almost surely. By the expectation in (Hashimoto et al., 2015, Theorem S3.2), the out-neighborhood of a graph constructed with uniform scale maxx ε(x)gn asymptotically dominate the inneighborhood of the original graph. Therefore,\nmax x |NBn(x)in|ε(x)−dg−dn n−1 < max x Cx(1 + δ) <∞.\nCombining the two bounds gives that\n|NBinn (xj)| minx |NBn(x)| < (1 + δ) maxx Cxε(x) d minx Cxε(x)d .\nThe ratio maxx Cxminx Cx is bounded by definition of p(x), and therefore there exists C2 > 0 such that |NBinn(xj)| minx |NBn(x)| < C2 almost surely. Finally, by Lemma S2.7, there exists C3 > 0 such that π ′ Xn(x) ≤ C3/n for large enough n. The original statement follows by setting C = C1C2C3.\n1Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of εn(x)−d.\nLemma S2.9. We have the limit\nlim n→∞\n∑\nx∈NBinn(xj)\n1\n|NBn(x)| = 1.\nProof. We will proceed through three estimates. Estimating ε(x) for x ∈ NBinn (xj): For σ > 0, define γ = σminx ε(x) > 0. We may choose δ > 0 so that if |x − y| < δ, then |ε(x) − ε(y)| < γ. Choose n0 so that if n > n0 then gn maxx ε(x) < δ/2. For n > n0, we find that for x ∈ NBinn (xj), we have\n|x− xj | ≤ εn(x) ≤ gn max x ε(x) < δ\nand therefore that |ε(x)− ε(xj)| < σmin\nx ε(x) ≤ σε(xj).\nThis implies that for n > n0 we have\n(1− σ)ε(xj) < ε(x) < (1 + σ)ε(xj). (2)\nEstimating |NBn(x)| for x ∈ NBinn (xj): By (Hashimoto et al., 2015, Theorem S3.2), we have\n|NBn(x)| |Xn ∩B(x, εn(x))| → C(h)p(x)\nfor some constant C(h) independent of x and n.2 For any τ > 0, we may therefore find some n1 so that for n > n1 we have\n(1− τ)C(h)p(x)|Xn ∩B(x, εn(x))| < |NBn(x)| < (1 + τ)C(h)p(x)|Xn ∩B(x, εn(x))|.\nOn the other hand, by (2), for x ∈ NBinn (xj) and any σ > 0 there is some n0 so that for n > n0 we have\n|Xn ∩B(x, (1− σ)εn(xj))| < |Xn ∩B(x, εn(x))| < |Xn ∩B(x, (1 + σ)εn(xj))|. (3)\nEstimating |NBinn (xj)|: By (2) and an analogue of the proof of (Hashimoto et al., 2015, Theorem S3.2), we have for x ∈ NBinn (xj) that for any ρ > 0, there is n2 > 0 so that if n > n2 then\n(1− ρ)C(h)p(x)|Xn ∩B(x, (1− σ)εn(xj))| < |NBinn (xj)| < (1 + ρ)C(h)p(x)|Xn ∩B(x, (1 + σ)εn(xj))|. (4)\nCompleting the proof: The conclusion follows by taking τ, σ, ρ→ 0, choosing n large, and combining (3) and (4). Lemma S2.10. The quantity θn(xj) = ∑ x∈NBinn(xj) π′Xn (x) |NBn(x)| satisfies\nlim n→∞ nθn(xj) = π̂(xj).\nProof. Fix a sequence of points y1, y2, . . . in X with yk ∈ G′k so that limk→∞ yk = xj . Fix any δ > 0. By Lemma S2.7, we may find some n0 so that for n > n0, for each x ∈ NBinn (xj) we have\n|π′Xn(x)− π′Xn(yn)| < δ/2.\nThis implies that for n > n0 we have\n∣∣∣∣∣∣ nθn(xj)− nπ′Xn(yn) ∑\nx∈NBinn(xj)\n1\n|NBn(x)| ∣∣∣∣∣∣ < δ 2\n∑\nx∈NBinn(xj)\n1\n|NBn(x)| .\nThe result then follows by Lemma S2.9 and Lemma S2.7.\n2Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of εn(x)−d.\nTheorem S2.11. For any xi and xj, we have\nE[T xixj ,n] n → 1 π̂(xj) ,\nwhere the convergence is a.s. in the draw of X . Proof. By definition, we have\nE[T xixj ,n | T xixj ,n > t̂g−2n ] ≥ E[T xixj ,n] ≥ P(T xixj ,n > t̂g−2n )E[T xixj ,n | T xixj ,n > t̂g−2n ]. (5)\nBy Lemma 3.1, for any δ > 0 and t̂0 > 0, there is some n1 so that for n > n1 and t̂ > t̂0 we have P(T xixj ,n > t̂g −2 n ) > (1− δ). Define now pt = P(T xixj ,n = t | T xixj ,n ≥ t); by definition we have\nE[T xixj ,n | T xixj ,n > t̂g−2n ] = ∞∑\nt=dt̂g−2n e\ntpt\nt−1∏\nr=dt̂g−2n e\n(1− pr).\nBy Lemma S2.8, we have for some n2 that for n > n2 and t > t̂0g −2 n that\n|pt − θn(xj)| < C exp(−βtg2n)\nn\nso in particular for δ = 12 minx∈D π̂(x) and τ = 2 maxx∈D π̂(x), we have for some n3 that for n > n3 we have\nδ < npt < τ and δ < nθn(xj) < τ.\nFor n4 large enough that 1− τ/n4 > δ/n4, for n > n4 we have ∣∣∣∣∣∣ pt t−1∏\nr=dt̂g−2n e\n(1− pr)− θn(xj)(1− θn(xj))t−dt̂g −2 n e ∣∣∣∣∣∣ < t−1∑\nr=dt̂g−2n e\nC exp(−βrg2n) n (1− τ/n)t−dt̂g−2n e−1\n< C\nn\ne−βt̂\n1− e−βg2n (1− τ/n) t−dt̂g−2n e−1.\nThis implies that\n1\nn ∣∣∣∣∣∣ E[T xixj ,n | T xixj ,n > t̂g−2n ]− ∞∑\nt=dt̂g−2n e\ntθn(xj)(1− θn(xj))t−dt̂g −2 n e ∣∣∣∣∣∣ < ∞∑\nt=dt̂g−2n e\nC n2 e−βt̂ 1− e−βg2n (1− τ/n) t−dt̂g−2n e−1\n< C τ(n− τ) e−βt̂ 1− e−βg2n ,\nwhere we note that for n > 2τ , we have\nC τ(n− τ) e−βt̂ 1− e−βg2n < 2Ce−βt̂ τ n−1(g−2n + 1 2 + 1 12 g2n).\nBecause limn→∞ n−1(g−2n + 1 2 + 1 12g 2 n) = 0, considering n > max{n1, n2, n3, n4}, we conclude that\nlim n→∞\n1 n E[T xixj ,n | T xixj ,n > t̂g−2n ] = limn→∞ 1 n\n∞∑\nt=dt̂g−2n e\ntθn(xj)(1− θn(xj))t−dt̂g −2 n e\n= lim n→∞\n1\nn 1− θn(xj) + θn(xj)dt̂g−2n e θn(xj)\n= lim n→∞\n1\nnθn(xj) =\n1\nπ̂(xj) ,\nwhere the last equality follows from Lemma S2.10. Now by (5), we conclude that\nlim n→∞\n1 n E[T xixj ,n] = 1 π̂(xj) ."
    }, {
      "heading" : "2.4 The case of one dimension",
      "text" : "The Laplacian-based bounds in (von Luxburg et al., 2014) suggest that the hitting time should diverge even when the dimension of the underlying geometric graph is 1. This is a very surprising result, since the continuous random walk in one dimension converges to a non-trivial limit. We provide another explanation of this result in our framework.\nIntuitively, this happens since we are concerned with the hitting time to a single point, and the discrete random walk may jump over the point, while the continuous walk cannot. To demonstrate this, we show that considering the hitting time to a sufficiently large out-neighborhood of a vertex instead of the vertex itself fixes this problem.\nPick xi, xj ∈ Gn, and let Xnt be the simple random walk on Gn. Suppose without loss of generality that xi < xj and define\nγ = inf n min xi∈Xn xi\nto be the left boundary of D. Pick a sequence of sets of vertices Sn ⊂ Xn so that every element in Sn is reachable from xj in o(g −1 n ) steps and the removal of Sn from Gn disconnects Gn. Let T xi Sn\nbe the hitting time to any point in Sn. We will use the Feynman-Kac theorem for functionals of hitting time.\nTheorem S2.12 ((Øksendal, 2003, Exercise 9.12) Feynman-Kac). Let Zt be an Itô process in Rd defined by\ndZt = µ(Zt)dt+ σ(Zt)dBt.\nFor a function f(x) and T xE the hitting time to a domain E ⊂ D, the function\nu(x) = E [∫ TxE 0 f(Zs)ds ]\nis the solution to the boundary value problem\n1 2 Tr[σTHuσ] + µ(x) · ∇u+ f(x) = 0\nwith boundary condition u|∂E = 1. Theorem S2.13. Such a sequence of vertex sets Sn always exists and the expected hitting time E[T xiSn,n] converges to a non-degenerate continuum limit defined by\nE[T xiSn,ng 2 n]→ ∫ xj xi 1 p(y)2 ∫ y γ 2p(z)2 ε(z)2 dzdy.\nProof. First we prove a sequence Sn exists. Take the set of points Ŝn = {xk : |xk − xj | < cn} for a sequence cn with cn → 0 and cngn →∞. Let s be the maximum shortest path distance to any element in Ŝn. Then we have s = o(g−1n ) since cn → 0 and the length of the shortest path between any two points scales as Θ(g−1n ). Therefore the set Sn defined by all points whose shortest path distance to xj is at most s fulfills the requirements.\nLet T̂ij be the hitting time to xj of Yt̂ started at xi. Note that it is not infinite because we have d = 1. By Corollary 4.4 and the fact that sg−1n → 0, we have\nT xiSn,ng 2 n d→ T̂ij .\nFinally, by Theorem S2.12 with f(x) ≡ 1, the expected hitting time u(x) to xj under the continuous process Yt̂ started at x is the solution to the boundary value problem\n1 2 ε(x)2u′′(x) + p′(x) p(x) ε(x)2u′(x) + 1 = 0\nWe may rewrite this as\np(x)2u′′(x) + 2p(x)p′(x)u′(x) = −2p(x) 2\nε(x)2 ,\nafter which integration of both sides and application of u′(γ) = 0 implies that\np(x)2u′(x) = − ∫ x\nγ\n2p(z)2\nε(z)2 dz.\nAnother integration and application of u(xj) = 0 implies that\nu(x) = − ∫ x\nxj\n1\np(y)2\n∫ y\nγ\n2p(z)2\nε(z)2 dzdy.\nSetting x = xi then implies that\nlim n→∞ E[T xiSn,ng 2 n] = E[T̂ij ] = ∫ xj xi 1 p(y)2 ∫ y γ 2p(z)2 ε(z)2 dzdy.\nFor cases where the kernel function takes values in {0, 1}, such as the k-nearest neighbor graph, the following corollary is useful.\nCorollary S2.14. Suppose that Gn is constructed by the kernel h(x) = 1[0,1]. Then the expected hitting time of Xnt started at xi to the out-neighbors of xj converges to the limit of Theorem S2.13\nProof. From the fact that the out-neighborhood of xj satisfies the conditions for Sn in Theorem S2.13.\nAlthough this metric is nontrivial in the sense that it retains some information about the latent space metric, it is still highly distorted. We examine this phenomenon in the case of ε(x) = 1 and p(x) = 1 in the following Corollary.\nCorollary S2.15. If ε(x) = 1 and p(x) = 1 in Corollary S2.14, for any xi and xj the rescaled expectation of the hitting time T xiNBn(xj),n of X n t started at xi to the out-neighborhood of xj has the limit\nE[T xiNBn(xj),ng 2 n]→ |xj − xi| · |xj + xi − 2γ|.\nProof. This follows by applying Theorem S2.13 with our ε(x) and p(x).\nRemark 2. Note that the boundary condition in Corollary 2.15 induces a large non-uniform multiplicative error. Because of this, the expected hitting time is not consistent even in the ideal situation of a onedimensional latent space with random walk converging to Brownian motion. Compare this result with Theorem 4.5, which shows a much stronger consistency property."
    }, {
      "heading" : "3 Computing the LTHT",
      "text" : "Algorithmically, computing the LTHT can be done in two major ways: matrix inversion, or sampling. For the results in the paper, we use the direct sampling method of drawing a simple random walk and calculating the exponentially discounted hitting time. This same computation can be performed using a truncated power method (Yazdani, 2013, Algorithm 1).\nAlternative approaches for computing the LTHT involve the following matrix inversion method. Let P be the transition matrix for some random walk. Then the LTHT E[exp(−βT xixj ,n)] is given by\nE[exp(−βT xixj ,n)] = (I −W exp(−β))−1ji .\nNote that this expression is a close discrete analog of Feynman-Kac (Theorem 2.1). This relationship was used in prior work (Smith et al., 2014, Eq. 22) to calculate the LTHT in a different setting and formulation. Correctness of this expression can be seen via the series expansion which was computed as a normalizer for randomized shortest paths (Françoisse et al., 2013, Algorithm 2). This method has been used to calculate the LTHT in in prior work (Kivimäki et al., 2014)."
    }, {
      "heading" : "4 Reweighting the random walk",
      "text" : "Recall that Anij was the adjacency matrix of Gn. In Corollary S4.2, we give a complete proof of Theorem 4.1 from the maintext."
    }, {
      "heading" : "4.1 General construction and application to Brownian motion",
      "text" : "Let an(x) and bn(x) be scalar functions on Xn with possibly stochastic dependence on Xn so that\nlim n→∞ an(x) = a(x) and lim n→∞ bn(x) = b(x)\nuniformly in x for some deterministic a(x) and b(x).\nTheorem S4.1. If an(x) is a.s. eventually equicontinuous, a(x) is smooth with bounded gradient, and b(x) is continuous and bounded in (0, 1], the weighted random walk Zt defined by the transition matrix\nP(Zt+1 = xj | Zt = xi) = { Ani,j an(xj)∑ xk∈NBn(xi) an(xk) bn(xi) i 6= j\n1− bn(xi) i = j\nconverges to the Itô process with drift ∇ log(p(x)a(x))/3 and diffusion ε(x)2b(x)/3.\nProof. To show convergence to an Itô process, it suffices to check the Stroock-Varadhan criterion (Stroock & Varadhan, 1971). Since the boundary for both the original and modified walk are the same, we only need check that\nE[Zt+1 − xi | Zt = xi] p−→ 1\n3 ∇[p(xi)a(xi)] p(xi)a(xi) ε(xi) 2b(xi), and\nE[(Zt+1 − xi)2 | Zt = xi] p−→ 1\n3 ε(xi)\n2b(xi).\nFor this, by definition we have that\nE[Zt+1 − xi | Zt = xi] = P(Zt+1 6= xi) 1∑\nxk∈NBn(xi) an(xk)\n∑\nxk∈NBn(xi) (xk − xi)an(xk), and\nE[(Zt+1 − xi)2 | Zt = xi] = P(Zt+1 6= xi) 1∑\nxk∈NBn(xi) an(xk)\n∑\nxk∈NBn(xi) (xk − xi)2an(xk),\nfrom which the desired estimates follow by using P(Zt+1 6= xi) = bn(xi) and the values and concentration of conditional moments E[f(Zt − Zt−1) | Zt−1, Zt 6= Zt−1] given by applying Lemma S4.3 and Lemma S4.4 to f(x) = x and f(x) = x2.\nCorollary S4.2. Let p̂ and ε̂ be consistent estimators of the density and local scale and A be the adjacency matrix. Then the random walk X̂nt defined by the following transition\nP(X̂nt+1 = xj | X̂nt = xi) = { Ai,j p̂(xj) −1 ∑ k Ai,kp̂(xk) −1 ε̂(xi) −2 i 6= j\n1− ε̂(xi)−2 i = j\nconverges to a Brownian motion.\nProof. Set an(x) = p̂(x) −1 and bn(x) = ε̂(x)−2 as estimated by (Hashimoto et al., 2015) so that limn→∞ an(x) = p(x)−1 and limn→∞ bn(x) = ε(x)−2. These satisfy the conditions of Theorem S4.1 and yield limiting drift and diffusion coefficients for Brownian motion."
    }, {
      "heading" : "4.2 Technical moment estimates",
      "text" : "In this subsection, we give the moment estimates necessary in the proof of Theorem S4.1. We first derive the expected values of each moment quantity averaged over draws of Xn. Lemma S4.3 (Expected values of reweighting). Let x = Xnt and y = X n t+1. Then the conditional expectation after weighting by an(x) converges to the weighted draw over p(x)an(x); that is, we have a.s. that\nlim n→∞\n∣∣∣∣ 1\nhn |NBn(x)|E\n[ an(y)∑\nz∈NBn(x) an(z) f(y − x) | y 6= x\n]\n− 1 hn\n∫\ny∈B(x,εn(x)) f(y − x) p(y)a(y)∫ z∈B(x,εn(x)) p(z)a(z)dz dy\n∣∣∣∣ = 0.\nProof. By the continuity of p and a.s. eventual equicontinuity of an(y), we have supy∈B(x,εn(x)) |an(y)p(y)− an(x)p(x)| → 0 and supy∈B(x,εn(x)) |p(y)− p(x)| → 0. These together imply\n∫ y∈B(x,εn(x)) an(y)p(y)dy∫\ny∈B(x,εn(x)) p(y)dy a.s.−−→ a(x). (6)\nBecause an(x) → a(x) uniformly in x, for any δ > 0, we may choose n0 so that for n > n0, we have |an(x) − a(x)| < δ/2 and εn(x) is small enough so that if |y − x| < εn(x), then |a(y) − a(x)| < δ/2. For n > n0, we then have\nsup z∈NBn(x) |an(z)− a(x)| ≤ sup z∈NBn(x) |an(z)− a(z)|+ |a(z)− a(x)| < δ.\nThis shows that supz∈NBn(x) |an(z)− a(x)| → 0 and therefore ∑ z∈NBn(x) an(z)\n|NBn(x)| a.s.−−→ a(x). (7)\nApplying (6) and (7), we find that\nlim n→∞\n∣∣∣∣ 1\nhn |NBn(x)|E\n[ an(y)∑\nz∈NBn(x) an(z) f(y − x) | x 6= y\n]\n− 1 hn\nE [an(y)f(y − x) | x 6= y] ∫ y∈B(x,εn(x)) p(y)dy∫\ny∈B(x,εn(x)) an(y)p(y)dy\n∣∣∣∣→ 0.\nWe apply the argument of (Hashimoto et al., 2015, Lemma 3.2) to this iterated expectation to obtain\nlim n→∞\n∣∣∣∣ 1\nhn E [an(y)f(y − x) | x 6= y]\n∫ y∈B(x,εn(x)) p(y)dy∫\ny∈B(x,εn(x)) an(y)p(y)dy\n− 1 hn\n∫\ny∈B(x,εn(x)) f(y − x) p(y)a(y)∫ z∈B(x,εn(x)) p(z)a(z)dz dy\n∣∣∣∣→ 0.\nEvaluating the integrals for f(x) = x and f(x) = x2 in Lemma S4.3 implies that the expected value of an increment of the reweighted walk across all draws of Xn limits to ∇ log[p(x)a(x)]/3 and the expected variance of the increment limits to ε(x)2b(x)/3. However, in order to apply the Stroock-Varadhan criteria we require that this hold with high probability over all draws of Xn. Lemma S4.4 (Strong LLN for local moments). For a function f(x) such that supx∈B(0,ε) |f(x)| < ε for small ε > 0, we have a.s. that\nlim n→∞\n∣∣∣∣ 1\nhn\n∑\ny∈NBn(x)\nan(y)∑ z∈NBn(x) an(z) f(y − x)− 1 hn\n∫\ny∈B(x,εn(x)) f(y − x) p(y)a(y)∫ z∈B(x,εn(x)) p(z)a(z)dz dy\n∣∣∣∣ = 0.\nProof. Define the quantity\nµ(x) = 1\nhn\n∫\ny∈B(x,εn(x)) f(y − x) p(y)a(y)∫ z∈B(x,εn(x)) p(z)a(z)dz dy.\nWe wish to bound\npn(t) = P   ∣∣∣∣ 1\nhn\n∑\ny∈NBn(x)\nan(y)∑ z∈NBn(x) an(z)\nf(y − x)− µ(x) ∣∣∣∣ ≥ t   . (8)\nBy a.s. eventual equicontinuity of an(y), we have for some c > 0 and large enough n that\nan(y)∑ z∈NBn(x) an(z) ≤ c 1|NBn(x)| .\nBy the construction of εn(x), if |y − x| < εn(x), then |f(y − x)| ≤ εn(x). Combining these two we apply Hoeffding’s inequality to obtain that\npn(t) ≤ 2 exp ( −2h\n2 n|NBn(x)|2c2t2 |NBn(x)|εn(x)2\n) = o(n−2t 2ω(1)), (9)\nwhere we use that |NBn(x)| = ω ( n2/(d+2) log(n)d/(d+2) ) . This completes the proof by Borel-Cantelli."
    }, {
      "heading" : "5 Consistency at β = ω(log(gdnn)) via shortest paths",
      "text" : "Definition S5.1. Define the f -length of any path γ ⊂ D as given in (Alamgir & von Luxburg, 2012) as\nDf,γ =\n∫\nγ\nf(γ(t))|γ′(t)|dt.\nLet the f -distance from x to y be the minimum path length between two points\nDf (x, y) = min γ∈C1,γ(0)=x,γ(1)=y Df,γ .\nTheorem S5.2. Let β = ω(log(gdnn)), then for f(x) = ε(x) −1 we have\n− log(E[exp(−βT xixj ,n)])/βgn → Df (xi, xj).\nProof. Define Hij(t) to be the probability of not hitting xj by step t, and Pij(t) to be the probability of going from xi to xj in exactly t steps. The expected value is the series\n− log(E[exp(−βT xixj ,n)])/βgn = −β−1gn log ( ∞∑\nt=0\nPij(t)Hij(t) exp(−βt) ) .\nNow, let Dij be the length of the shortest path from i to j. By definition Hij(Dij) = 1 and\n− log(E[exp(−βT xixj ,n)])/βgn = Dijgn−log(Pij(Dij)) gn β −log\n 1 + ∞∑\nt=Dij+1\nPij(t)\nPij(Dij) Hij(t) exp(−β(t−Dij))\n  gn\nβ .\nThis forms the upper bound\n− log(E[exp(−βT xixj ,n)])/βgn ≤ Dijgn − log(Pij(Dij)) gn β .\nThe probability Pij(Dij) of hitting xj in exactly Dij steps is lower bounded by (g d nn) −Dij since by definition at least one path exists. This implies that log(Pij(Dij)) = o(g −1 n log(g d nn)) and therefore\nDijgn ≤ − log(E[exp(−βT xixj ,n)])/βgn ≤ Dijgn − o(1),\nwhere the lower bound follows because it is impossible to reach vertex xj in less than Dij steps. By (Alamgir & von Luxburg, 2012) for the k-nearest neighbor case and (Hashimoto et al., 2015) with Lemma S6.3 for the other cases of a spatial graph, Dijgn converges to the f -distance defined by ε(x) −1, completing the proof."
    }, {
      "heading" : "6 Consistency of LTHT",
      "text" : "In this section, we prove some results needed in the proof of Theorem 4.5."
    }, {
      "heading" : "6.1 LTHT of the Brownian motion",
      "text" : "Lemma S6.1. Let Wt be a Brownian motion with W0 = xi. Let T xi B(xj ,s) be the hitting time of Wt to B(xj , s). For any α < 0, if β̂ = s α, as s→ 0 we have\n− log(E[exp(−β̂T xiB(xj ,s))])/ √ 2β̂ → |xi − xj |.\nProof of Lemma 6.1. Let Bt = |Wt| be the order ν = d/2− 1 Bessel process. The LTHT of Bt to hit xj ± s is equivalent to the LTHT of Wt to hit B(xj , s). Defining w = |xi − xj |, by (Borodin & Salminen, 2002, Eq 4.2.0.1), this is:\nE[exp(−β̂T xiB(xj ,s))] = K(ν, w\n√ 2β̂)w−ν\nK(ν, s √ 2β̂)s−ν ,\nwhere K(ν, w) is a modified Bessel function of the second kind. Write − log(E[exp(−β̂T xiB(xj ,s))])/ √\n2β̂ = c1 + c2 for\nc1 = − log(K(ν, w √ 2β̂)w−ν)/ √ 2β̂ c2 = − log(K(ν, s √ 2β̂)s−ν)/ √ 2β̂.\nTaylor expansion of c1 at β̂ −1 = 0 yields\nc1 = w − log(π2/(8β̂)) + 4 log(w−1/2−ν)\n4 √ 2β̂\n+ o\n( ν2\nwβ̂\n) ,\nhence c1 → w. For c2, note that ν log(s)/ √ 2β̂ → 0 and for s small,\nK(ν, s √ 2β̂) ∼    − log(s √ 2β̂) d = 2\n1 2Γ(s √ 2β̂)( 12s √ 2β̂)−ν d > 2 .\nby (Abramowitz & Stegun, 1972, p375). Checking that − log(K(ν, s √ 2β̂))/ √ 2β̂ → 0 and combining estimates gives − log(E[exp(−β̂T xiB(xj ,s))])/ √ 2β̂ = c1 + c2 → w."
    }, {
      "heading" : "6.2 Proof of Corollary 4.4",
      "text" : "We prove here Corollary S6.2. We recall the setup. For points xi, xj ∈ Gn and s > 0, T̂ xiB(xj ,s) is the hitting time of the de-biased walk on Gn from xi to NB s n(xj). In the continuous setting, T xi B(xj ,s) is the hitting time of Brownian motion with reflecting boundary conditions in D from xi to B(xj , s). We would like to show the following.\nCorollary S6.2. For s > 0, we have g2nT̂ xi B(xj ,s) d→ T xiB(xj ,s).\nOur proof consists of two steps. First, we show that hitting NBsn(xj) is equivalent to hitting B(xj , s) with the discrete walk. Second, we use S4.2 to show convergence in distribution of this second hitting time. We require a few lemmas.\nLemma S6.3. For any δ > 0 and s > 0 so that B(xj , s+ δ) ⊂ D, we have with high probability that\nXn ∩B(xj , s− δ) ⊂ NBsn(xj) ⊂ B(xj , s+ δ).\nProof. Recall that NBsn(xj) is defined as\nNBsn(x) := {y | there is a path x→ y of ε̂-weight ≤ s}.\nThe estimator ε̂(x) is appropriately scaled such that ε̂(x) → ε(x) uniformly and almost surely. Thus, we need to show that ε̂-weighted shortest path distance converges to true shortest path distance up to error Θ(gn).\nWe first present the simpler case of a constant kernel h(x) ≡ 1 over [0, 1]; this includes the k-nearest neighbor and ε-ball cases. Let Dij be the minimum ε̂-weight of a path from xi to xj . The proof of (Hashimoto et al., 2015, Theorem S4.5) shows that in this case\n∣∣∣|xi − xj | −Dijgn ∣∣∣ ≤ εn(xj). (10)\nIf xk ∈ Xn ∩ B(xj , s − δ), this implies that Djkgn → |xk − xj | ≤ s − δ. Therefore Djkgn ≤ s with high probability and xk ∈ NBsn(xj). If xk ∈ NBsn(xj), this implies that Dik ≤ s. By Equation (6.2), we have s ≥ Dijgn → |xi − xj |. Therefore xk ∈ B(xj , s+ δ) with high probability.\nThe proof for the case of generic h(x) is closely analogous. The same proof as used for (Hashimoto et al., 2015, Theorem S4.5) shows that there exists some k such that |xk − xj | ≤ εn(xk) such that\n∣∣∣∣|xi − xj | −Dikgn ∣∣∣∣ ≤ εn(x).\nAt this stage, a difference arises. The proof of (Hashimoto et al., 2015, Theorem S4.5) bounds the number of steps necessary to reach distance εn(xj) to the target, but for a general choice of h(x) this does not guarantee that we can reach xj .\nFor general h(x), we instead show that two extra jumps are sufficient. Because h(1) > 0 and h is continuous at 1, there exists some interval (c1, 1) and some c2 > 0 such that\ninf x∈(c1,1) h(x) > c2.\nThis annulus will yield a lower bound on the true connectivity. If |xi − xj | ≤ εn(xi), then the probability that there is some point xk such that the path xi → xk → xj exists in Gn is governed by\nP(Dij > 2) = (1− c2)2|NBn(xi)∩NB in n (xj)|\nwhere |NBn(xi) ∩ NBinn (xj)| ∼ Pois(gdnnτ(xi − xj))\nand τ(z) is the total overlapping density between the connectivity kernel of xi and xj . This is lower bounded by the annulus; for any d > 2 the annuli have nonzero overlap volume and\nτ(z) ≥ c22 ∫\nx∈B(0,1) 11>|x|>c111>|1−x|>c1dx ≥ 0.\nThis implies that |NBn(xi) ∩ NBinn (xj)| = Θ(k) with high probability and therefore\nP(Dij > 2) = (1− c2)2|NBn(xi)∩NB in n (xj)| → 0.\nThus, there exists a two step path from xi to xj whenever |xi − xj | < εn(xi). Combined with the analogue of (Hashimoto et al., 2015, Theorem S4.5), this shows that with high probability there is a walk of ε̂-weight at most |xi − xk|+ 2εn(xk) from xi to xk. We conclude in the same way as in the constant kernel case.\nWe now require a lemma on the continuity of functions on Skorokhod space. For this, we recall the metric which induces the relevant topology on Skorokhod space. Let Λ be the set of strictly increasing continuous bijections [0,∞)→ [0,∞). The Skorokhod metric on D([0,∞), D) and D([0,∞),R≥0) is given by\nσ(f, g) = inf λ∈Λ\nmax{||λ− id||, ||f − g ◦ λ||},\nwhere || · || denotes the sup-norm on the relevant space. Lemma S6.4. Let B ⊂ D be any ball and T xB the hitting time from x to B of Brownian motion with reflecting boundary condition in D. As a map D([0,∞), D) → R≥0, the hitting time T x\nB is continuous on the subset of C([0,∞), D) of paths whose hitting time to B is finite. Proof. Denote by CB the subset of C([0,∞), D) of paths whose hitting time to B is finite. We first claim that the function dB : D([0,∞), D)→ D([0,∞),R≥0) given by composition with the function dB : D → B giving the distance to B is continuous. For any ε > 0, pick δ by uniform continuity of dB so that δ < ε and if |x− y| < δ, then |dB(x)− dB(y)| < ε. If σ(f, g) < δ, we have\nσ(dB(f), dB(g)) = inf λ∈Λ\nmax{||λ− id||, ||dB ◦ f − dB ◦ g ◦ λ||}.\nBecause σ(f, g) < δ, we may find λ ∈ Λ so that ||f − g ◦ λ|| < δ and ||λ− id|| < δ. By our choice of δ, this implies that max{||λ− id||, ||dB ◦ f − dB ◦ g ◦ λ||} < ε and therefore that σ(dB(f), dB(g)) < ε, establishing continuity.\nNow, the image of CB under dB is the subset C0 of C([0,∞),R≥0) of paths whose hitting time to 0 is finite. By (Whitt, 1980, Theorem 7.1), the first passage time to 0 is continuous on C0. The hitting time T x\nB\nis the composition of the first passage time and dB , hence is continuous on CB as claimed.\nLemma S6.5. Let B ⊂ D be any ball containing at least one point of Gn. For xi ∈ Gn, let T xiB,n be the hitting time from xi to B of the de-biased random walk on G. Then g 2 nT̂ xi B,n\nd→ T xB. Proof. First, note that both the de-biased random walk and Brownian motion with reflecting boundary condition started at xi have a.s. finite hitting time to B. By Lemma S6.4, the hitting time to B is a.s. continuous on the subset of D([0,∞), D) containing their trajectories. The desired convergence in distribution then follows from Corollary S4.2, the continuous mapping theorem (see (Whitt, 1980, Section 1)), and noting the time-rescaling used in Corollary S4.2.\nProof of Corollary S6.2. Recall that T xiB(xj ,p),n is the hitting time of the simple random walk on Gn to B(xj , p). By Lemma S6.3, for any δ > 0, we have with high probability that\nT xiB(xj ,s+δ),n ≤ T̂ xi B(xj ,s),n ≤ T xiB(xj ,s−δ),n.\nApplying Lemma S6.5 to B(xj , s± δ), we see that\ng2nT xi B(xj ,s±δ),n d→ T xiB(xj ,s±δ),\nwhich shows that T xi B(xj ,s−δ) ≤ limn→∞ g 2 nT̂ xi B(xj ,s),n\n≤ T xiB(xj ,s+δ) for all δ > 0. Sending δ → 0 yields the result."
    }, {
      "heading" : "6.3 Proof of Theorem 4.5",
      "text" : "We prove here Theorem 6.6. Recall we chose an estimator ε̂(x)→ ε(x). Theorem S6.6. Let xi and xj be points in Gn connected by a geodesic not intersecting ∂D. For any δ > 0, there exists a choice of β̂ and s > 0 so that if β = β̂g2n, we have for large n with high probability that ∣∣∣∣− log(E[exp(−βT̂ xi B(xj ,s),n )])/ √ 2β̂ − |xi − xj | ∣∣∣∣ < δ.\nOur proof will proceed by converting to the continuous setting by Corollary 6.2 and then reducing to the case of Brownian motion without boundary which was analyzed in Lemma 6.1. Because we are in the setting of Brownian motion with reflecting boundary conditions, we must apply the “principle of not feeling the boundary” to show that our results are unaffected by it. For this, we define some events to condition on.\nLet G be the geodesic from xi to xj , and for a distance scale ρ, let G(ρ) be the set of all points of distance less than ρ from G. Choose ρ small enough so that G(ρ) ⊂ D. For a distance s > 0, let Bt be a Brownian motion without boundary started at xi, and let T xi B(xj ,s) be its hitting time to B(xj , s). For a time t\n? > 0, define the following events:\n• let E1 be the event that T xi B(xj ,s) < t ?;\n• let E2 be the event that E1 holds and Bt hits B(xj , s) before G(ρ); • let E3 and E4 denote the analogous events for Brownian motion with boundary.\nNotice that P(E2) = P(E4). In the rest of this section, we will consider the scalings t? = sγ and β̂ = sα for some γ > 0 and α < 0 so that α+ γ > 0, so that β̂t? →∞ as s→ 0.\nLet pRt (x, y), p K t (x, y), p G t (x, y), and p F t (x, y) be the transition density of Brownian motion started at x and run for time t with reflecting boundary condition, killed at ∂D, killed at ∂G(ρ), and no boundary condition, respectively. For ? ∈ {R,K,G, F}, let h?(T ) be the probability that the respective process hits B(xj , s) before time T , and let h\n?(t, x) be the density of hitting at x ∈ B(xj , s) at time t. Note that pKt (x, y) ≤ pRt (x, y), pKt (x, y) ≤ pFt (x, y), and pGt (x, y) ≤ pFt (x, y). We have the following three lemmas, which are instances of “the principle of not feeling the boundary.”\nLemma S6.7. For x, y a distance at least ρ′ > 0 to ∂G(ρ), there are constants t0 > 0 and λ > 0 dependent only on ρ so that for t < t0, we have\npGt (x, y)\npFt (x, y) ≥ 1− e−λt−1 .\nProof. This follows from (Hsu, 1995, Theorem 1.2) and the results of (Varadhan, 1967).\nLemma S6.8. For x, y a distance at least ρ′ > 0 to ∂D, there are constants t0 > 0 and λ > 0 dependent only on ρ so that for t < t0, we have\npKt (x, y)\npFt (x, y) ≥ 1− e−λt−1 .\nProof. This follows from (Hsu, 1995, Theorem 1.2) and the results of (Varadhan, 1967).\nLemma S6.9. For x, y a distance at least ρ′ > 0 to ∂D, there are constants t0 > 0 and λ > 0 dependent only on ρ so that for t < t0, we have\npKt (x, y)\npRt (x, y) ≥ 1− e−λt−1 .\nProof. Note that our domainD is a Lipschitz domain in the sense of (Bass & Hsu, 1991, Section 3). Therefore, by (Bass & Hsu, 1991, Theorem 3.1, Theorem 3.4, and Remark 3.11), the reflecting Brownian motion in D has transition density pRt (x, y) satisfying\nC1t −d/2e−c1 |x−y|2 t ≤ pRt (x, y) ≤ C2t−d/2e−c2 |x−y|2 t (11)\nfor constants c1, c2, C1, C2 and small enough t. This verifies the conditions of (Hsu, 1995, Theorem 1.2), yielding the conclusion.\nWe now prove a general lemma on when the probability of hitting B(xj , s) before a time t ? is asymptot-\nically equal for two processes.\nLemma S6.10. Let Q be a diffusion process with transition densities pQt (x, y), and let p K t (x, y) of Q killed at some boundary. If for some λ > 0 and small enough s, we have for all t < t? and x, y ∈ B that\n1 ≥ p K t (xi, x) pQt (xi, x) ≥ 1− e−λt−1 and 1 ≥ p K t (x, y) pQt (x, y) ≥ 1− e−λt−1 ,\nthen the probabilities hK(t?) and hQ(t?) that K and Q hit B(xj , s) before t ? are asymptotically equal.\nProof. Let B = B(xj , s), and consider s small enough so that B(xj , s) ⊂ D. For x ∈ B and t > 0, let hK(t, x) and hQ(t, x) be the densities of the first passage time to B, and let hK(T ) and hQ(T ) be the probabilities that the respective first passage times are at most T . Note that hK(t, x) ≤ hQ(t, x). For ? ∈ {K,Q}, we have\nh?(t, x) = p?t (xi, x)− ∫ t\n0\n∫\ny∈B p?t−τ (y, x)h ?(τ, y)dydτ\nso we may integrate to obtain\nh?(T ) =\n∫ T\n0\n∫\nx∈B p?t (xi, x)dtdx−\n∫ T\n0\n∫ t\n0\n∫\nx,y∈B p?t−τ (y, x)h ?(τ, y) dydxdτdt. (12)\nDefine the differences d(T ) := hQ(T )−hK(T ), d(t, x) = hQ(t, x)−hK(t, x), and et(x, y) := pQt (x, y)−pKt (x, y). By assumption, if x = xi or x, y ∈ B, we have\net(x, y) ≤ e−λt −1 pQt (x, y).\nSubtracting (12) for ? ∈ {K,Q}, we obtain\nd(T ) =\n∫ T\n0\n∫\nx∈B et(xi, x)dtdx+\n∫ T\n0\n∫ t\n0\n∫\nx,y∈B et−τ (y, x)h\nK(τ, y) dydxdτdt\n+\n∫ T\n0\n∫ t\n0\n∫\nx,y∈B pKt−τ (y, x)d(τ, y) dydxdτdt\n≤ ∫ T\n0\n∫\nx∈B e−λt −1 pQt (xi, x)dtdx+\n∫ T\n0\n∫ t\n0\n∫\nx,y∈B e−λ(t−τ) −1 pQt−τ (y, x)h K(τ, y) dydxdτdt\n+\n∫ T\n0\n∫ t\n0\n∫\ny∈B d(τ, y)dτdtdy\n≤ ∫ T\n0\ne−λt −1 dt+\n∫ T\n0\n∫ t\n0\n∫\ny∈B e−λ(t−τ) −1 hK(τ, y) dydτdt+\n∫ T\n0\nd(τ)dτ\n≤ 2 ∫ T\n0\ne−λt −1 dt+\n∫ T\n0\nd(τ)dτ\n≤ 2Te−λT−1 + ∫ T\n0\nd(τ)dτ.\nBy Gronwall’s inequality, this implies that\nd(T ) ≤ 2Te−λT−1 + 2 ∫ T\n0\nτe−λτ −1 (T − τ)dτ ≤ 2(T + T 3)e−λT−1 .\nWe conclude that lim s→∞ d(t?) = lim s→∞ hQ(t?)− hK(t?) = 0.\nLemma S6.11. As s→ 0, we have P(E2 | E1)→ 1.\nProof. Let B = B(xj , s). By Lemma 6.7 with ρ ′ small enough, we have for some λ > 0 and small enough s that for all t < t? and x, y ∈ B that\npGt (xi, x)\npFt (xi, x) ≥ 1− e−λt−1 and p\nG t (x, y)\npFt (x, y) ≥ 1− e−λt−1 .\nNotice that P(E2) is the probability that the Brownian motion killed at G(ρ) hits B before t? and P(E1) is the probability that the free Brownian motion hits B before t?. Therefore, Lemma 6.10 implies that\nlim s→0 P(E1) = lim s→0 P(E2),\nfrom which we conclude that\nlim s→0 P(E2 | E1) = lim s→0 P(E2) P(E1) = 1.\nLemma S6.12. As s→ 0, we have P(E4 | E3)→ 1.\nProof. Applying Lemma 6.10 twice using Lemmas 6.9 and 6.8 implies that\nlim s→∞ P(E1) = lim s→∞ hF (t?) = lim s→∞ hK(t?) = lim s→∞ hR(t?) = lim s→∞ P(E3).\nWe conclude from Lemma 6.11 that\nlim s→∞ P(E4 | E3) = lim s→∞ P(E4) P(E3) = lim s→∞ P(E2) P(E1) = lim s→∞ P(E2 | E1) = 1.\nProof of Theorem 6.6. Throughout this proof, we will take t? = sγ and β̂ = sα for some fixed α < 0 and γ > 0 so that α+ γ > 0. We will pick a small s > 0 at the end of the proof. Bounding the effect of conditioning on E4 on the process with boundary: By Corollary 6.2, for any β̂ we have that\n− log(E[exp(−β̂g2nT̂ xiB(xj ,s),n)])/ √ 2β̂ d→ − log(E[exp(−β̂T xiB(xj ,s))])/ √ 2β̂.\nConditioning on E3 and E4, we see that\nE[exp(−β̂T xiB(xj ,s))] = E[exp(−β̂T xi B(xj ,s)) | Ec3]P(Ec3)\n+ E[exp(−β̂T xiB(xj ,s)) | E4]P(E4) + E[exp(−β̂T xiB(xj ,s)) | E3 ∩ Ec4]P(Ec4 | E3)P(E3).\nBy definition of E3, we have 0 ≤ E[exp(−β̂T xi B(xj ,s)) | Ec3]P(Ec3) ≤ e−β̂t ? . By the trivial bound exp(−β̂T xiB(xj ,s)) ≤ 1, we find that\n0 ≤ E[exp(−β̂T xiB(xj ,s)) | E3 ∩ Ec4]P(Ec4 | E3)P(E3) ≤ 1− P(E4 | E3).\nBy Lemma 6.12, for any τ > 0, for small enough s > 0 we have e−β̂t ? < τ and 1 − P(E4 | E3) < τ . Noting also that P(E4) = P(E2) and E[exp(−β̂T xi B(xj ,s)) | E4] = E[exp(−β̂T̂ xi B(xj ,s)\n) | E2], we conclude for small enough s that ∣∣∣E[exp(−β̂T xiB(xj ,s))]− E[exp(−β̂T̂ xi B(xj ,s) ) | E2]P(E2) ∣∣∣ < 2τ. (13)\nBounding the effect of conditioning on E2 on the process without boundary: We now compare to the computations for Brownian motion without boundary. By conditioning on E1 and E2, we have that\nE[exp(−β̂T̂ xiB(xj ,s))] = E[exp(−β̂T̂ xi B(xj ,s) ) | Ec1]P(Ec1) + E[exp(−β̂T̂ xiB(xj ,s)) | E2]P(E2) + E[exp(−β̂T̂ xiB(xj ,s)) | E1 ∩ E c 2] (1− P(E2 | E1))P(E1).\nWe again note that\n0 ≤ E[exp(−β̂T̂ xiB(xj ,s)) | E c 1]P(Ec1) ≤ e−β̂t ?\nand 0 ≤ E[exp(−β̂T̂ xiB(xj ,s)) | E1 ∩ E c 2] (1− P(E2 | E1))P(E1) ≤ 1− P(E2 | E1). These together with Lemma 6.11 imply that for any τ > 0, for small enough s > 0 we have that e−β̂t ?\n< τ and 1− P(E2 | E1) < τ . We conclude for small enough s that\n∣∣∣E[exp(−β̂T̂ xiB(xj ,s))]− E[exp(−β̂T̂ xi B(xj ,s) ) | E2]P(E2) ∣∣∣ < 2τ. (14)\nCombining (13) and (14), we conclude for small enough s that ∣∣∣E[exp(−β̂T xiB(xj ,s))]− E[exp(−β̂T̂ xi B(xj ,s) )] ∣∣∣ < 4τ. (15)\nAggregating the estimates: To conclude, for any δ > 0 and β̂0 > 0, choose τ > 0 small enough so that if |x− y| < 4τ , then for all β̂ > β̂0, we have\n∣∣∣∣log(x)/ √ 2β̂ − log(y)/ √ 2β̂ ∣∣∣∣ < δ/3.\nNow, choose s > 0 small enough and n large enough so that β̂ > β̂0, and for this τ , we have:\n• by our previous discussion, (15) holds; • by Lemma S6.1, we have\n∣∣∣∣− log(E[exp(−β̂T̂ xi B(xj ,s) )])/ √ 2β̂ − |xi − xj | ∣∣∣∣ < δ/3;\n• by Corollary S6.2, we have ∣∣∣∣− log(E[exp(−β̂T xi B(xj ,s))])/ √ 2β̂ + log(E[exp(−β̂g2nT̂ xiB(xj ,s),n)])/ √ 2β̂ ∣∣∣∣ < δ/3.\nFor these choices of τ , s, and n, we have by (15) that ∣∣∣∣log(E[exp(−β̂T xi B(xj ,s))])/ √ 2β̂ − log(E[exp(−β̂T̂ xiB(xj ,s))])/ √ 2β̂ ∣∣∣∣ < δ/3.\nCombining the last three inequalities yields the desired ∣∣∣∣log(E[exp(−β̂g2nT xi B(xj ,s),n)])/ √ 2β̂ − |xi − xj | ∣∣∣∣ < δ."
    }, {
      "heading" : "7 1-D bias calculation",
      "text" : "We repeat the full theorem statement and proof for the bias characterization.\nTheorem S7.1. Let T xixj be the hitting time to xj of a 1-dimensional Itô process with drift µ(x) = ∂ log(p(x)) ∂x ε 2(x) and diffusion ε2(x) started at xi with reflecting boundary γ for γ < xi < xj. The Laplace transform of T xi xj admits the asymptotic expansion\nE[− exp(βT xixj )] = c1\nf(xi)1/4p(xi) exp\n( − √ β ∫ xj xi √ f(s)ds ) ( 1 + ( 1 + o\n( 1√ β )) exp ( −2 √ β ∫ xi γ √ f(x)dx ) + o(exp(−β)) ) ,\nwhere f(x) = 2ε(x)2 + 1 β ∂ log(p(x)) ∂x2 + 1 β\n( ∂ log(p(x))\n∂x\n)2 , and c1 is a normalization constant depending on p, ε,and\nj to make E[−βT xixj ] = 1.\nProof. Let E[exp(−βT xixj )] = u(xi), where u(x) is the hitting time to xj from point x. By Feynman-Kac, this is\n∂2u ∂x2 + 2 ∂ log(p(x)) ∂x ∂u ∂x + q(x)u = 0,\nwhere q(x) = −2βε(x)−2. Rewrite this as a perturbation of a second order ODE via the change of variables to obtain\ny(x) = u(x) exp\n(∫ x\nγ\n∂ log(p(y))\n∂y dy\n) = u(x)p(x)p(γ)−1\nf(x) = 2\nε(x)2 +\n1\nβ\n( ∂ log(p(x))\n∂x2 +\n( ∂ log(p(x))\n∂x\n)2)\n1\nβ\n∂2y\n∂x = f(x)y(x).\nSince this is a type of Schrodinger’s equation with f(x) 6= 0 everywhere we can apply the WKBJ asymptotic expansion (Bender & Orszag, 1999, section 10.1) to obtain\ny(x) = c1\nf(x)1/4 exp\n( − √ β ∫ x\nx0\n√ f(s)ds ) +\nc2 f(x)1/4 exp\n(√ β ∫ x\nx0\n√ f(s)ds ) + o(exp(−β)).\nSince we assumed xi < xj and by the boundary condition u(xj) = 1 we have\nu(x) = c2p(γ)\nf(x)1/4p(x) exp\n( − √ β ∫ xj x √ f(s)ds ) +\nc1p(γ)\nf(x)1/4p(x) exp\n(√ β ∫ xj x √ f(s)ds ) + o(exp(−β)).\nTo obtain the boundary conditions, note that u′(γ) = 0. Taking the derivative for y(x)p(x), setting to zero and solving for c2 results in\nc2 = c1 exp(−2√β ∫ xj γ √ f(s)ds)(p(γ)4 √ βf(γ)3/2 + f ′(γ))− f(γ)p′(γ)\n4 √ βf(γ)3/2p(γ)− p(γ)f ′(γ) + 4f(γ)p′(γ) + o(exp(−β)),\nfrom which we obtain\nc2 = c1 exp\n( −2 √ β ∫ xj γ √ f(s)ds ( 1 + o (√ 1 β ))) .\nPulling out the −√β term, we get\nu(xi) = E[exp(−βT xixj )] = c1p(γ)\nf(xi)1/4p(xi) exp\n( − √ β ∫ xj xi √ f(s)ds )\n( 1 + ( 1 + o ( 1√ β )) exp ( −2 √ β ∫ xi γ √ f(x)dx ) + o(exp(−β)) ) .\nWe now connect this statement to the discrete walk.\nCorollary S7.2. Let T xiB(xj ,s),n be the discrete hitting time to a s ball around xj where s is selected as given in Theorem S2.13. Then the simple random walk over a graph constructed on density p(x) and scale ε(x) has the following log-LTHT under the boundary conditions of Theorem S4.6\n− log(E[exp(−βT xiB(xj ,s),ng 2 n)])/\n√ 2β → ∫ xj xi √√√√ 1 ε(x) + 1 β ( ∂ log(p(x)) ∂x2 + ( ∂ log(p(x)) ∂x )2) dx\n+ log(p(xi)/p(xj)) + log(f(xi)/f(xj))/4√ 2β + o(log(1 + e−\n√ 2β)/ √ 2β).\nProof. Taking the logarithm of the result of Theorem 7.1 and noting the initial condition u(xj) = 1 implies that asymptotically we have\nc1 ∝ (\n1\nf(xj)1/4p(xj) (1 + o(e−2\n√ β)) )−1 → f(xj)1/4p(xj),\nwhich completes the continuous statement. The convergence of the hitting time to its discrete counterpart follows from Theorem S2.13."
    }, {
      "heading" : "8 Basic noise resistance",
      "text" : "We give details for the basic noise bound from the main text footnote. Our goal is to prove the following statement about random walks. Theorem S8.1. Let Gn be generated by the noise model of definition 4.7 with ∑ j qj = o(g 2 n). Then the simple random walk over Gn converges to the same limit as the noiseless case in Theorem 2.2.\nProof. Since the boundaries of both noisy and noiseless graphs are identical, we need only verify the moment conditions in the proof of Theorem 2.2. In particular we require that under any noise q, we have\nlim n→∞\ng−2n E[Xnt+1 −Xnt |Xnt ] = ∇ log(p(Xnt ))ε(Xnt )2\nlim n→∞\ng−2n Cov[X n t+1|Xnt ] = ε(Xnt )2 · In\nlim n→∞\ng−2n E[|Xnt+1 −Xnt |2+α | Xnt ] = 0,\nwhich we show in the Lemma S8.2 and S8.3 below. By the Stroock-Varadhan criterion, this implies convergence to Theorem 2.2, as well as any macroscopic quantities such as hitting times, or LTHTs with β = Θ(g2n).\nWe now prove the moment bounds required for convergence of the noisy graph.\nLemma S8.2 (Noisy moments). If the noisy graph Gn is generated by the noise model of Definition 4.7, for any choice of latent noise parameters qj such that ∑ j qj = o(g 2 n) then we have for α > 0 that\nlim n→∞\ng−2n E[Xnt+1 −Xnt |Xnt ] = ∇ log(p(Xnt ))ε(Xnt )2\nlim n→∞\ng−2n Cov[X n t+1|Xnt ] = ε(Xnt )2 · In\nlim n→∞\ng−2n E[|Xnt+1 −Xnt |2+α | Xnt ] = 0.\nProof. Let X denote quantities in the noise-free graph. We recall from (Hashimoto et al., 2015, Theorem 3.3) that\nlim n→∞\ng−2n E[X n t+1 −X n t |X n t = x] = ∇ log(p(x))ε(x)2\nlim n→∞\ng−2n Cov[X n t+1|X n t = x] = ε(x) 2 · In\nlim n→∞\ng−2n E[|X n t+1 −X n t |2+α | X n t = x] = 0.\nLet q̂ = ∑ i qi so that q̂ = o(g 2 n). In the noisy graph, we first check the expectation via\nlim n→∞ g−2n E[Xnt+1 −Xnt | Xnt = x] = lim n→∞ (1− q̂)g−2n E[X n t+1 −X n t | X n t = x] + g −2 n\n∑\ni\nqi(xi − x)\n= lim n→∞\ng−2n E[X n t+1 −X n t |X n t = x]\n= ∇ log(p(x))ε(x)2.\nThe covariance follows because for all indices i and j we have\nlim n→∞\ng−2n E[(Xnt+1 −Xnt )i(Xnt+1 −Xnt )j | Xnt = x]\n= lim n→∞\n(1− q̂)g−2n E[(Xnt+1 −Xnt )i(Xnt+1 −Xnt )j | X n t = x] + g −2 n\n∑\nk\nqk(xk − x)i(xk − x)j\n= lim n→∞\ng−2n E[(X n t+1 −X n t )i(X n t+1 −X n t )j |X n t = x]\n= δijε(x) 2.\nFinally, the higher moments follow because we have\nlim n→∞\ng−2n E[|Xnt+1 −Xnt |2+α | Xnt = x]\n= lim n→∞\ng−2n (1− q̂)g−2n E[|X n t+1 −X n t |2+α | X n t = x] + g −2 n\n∑\ni\nqi|xi − x|2+α\n= lim n→∞\ng−2n (1− q̂)g−2n E[|X n t+1 −X n t |2+α | X n t = x]\n= 0,\nwhere we use that |xi − x|2+α = O(1).\nLemma S8.3 (Strong LLN for noisy moments). For a function f(x) such that supx∈B(0,ε) |f(x)| < ε and supx∈D |f(x)| < C for some constant C, given (?) we have uniformly in x ∈ Xn that\ng−2n ∑\ny∈NBn(x)\n1\n|NBn(x)| f(y − x) a.s.→ g−2n\n∫\ny∈B(x,εn(x)) f(y − x) p(y) pεn(x)(x) dy.\nProof. Denote the claimed value of the limit by µ(x). Let the set of non-noise out-neighbors of x be NBn(x) and the set of noise out-neighbors of x be ÑBn(x), where we consider noise edges to be strictly non-geometric edges. We have uniformly in x ∈ cX that\ng−2n\n∑ y∈NBn(x) f(y − x) + ∑ y∈ÑBn(x) f(y − x)\n|NBn(x)|+ |ÑBn(x)| = g−2n ∑ y∈NBn(x) f(y − x) + o(Cg2n) |NBn(x)|+ o(g2n)\na.s.→ g−2n ∑\ny∈NBn(x)\nf(y − x) |NBn(x)| ,\nso the result follows by the noise-less result in (Hashimoto et al., 2015).\nNow the behavior of noisy hitting times can be recovered by combining Lemma S8.1 with the convergence result of Corollary S6.2. Theorem S8.4. Let Gn be a noisy geometric graph with noise ∑ j qj = o(g 2 n). For any δ, there exists some β = β̂g2n, s, c such that ∣∣∣∣− log(E[exp(−βT xiB(xj ,s),n)])√\n2β gn − c|xi − xj |\n∣∣∣∣ ≤ δ\nwith high probability as n→∞.\nProof. By Lemma S8.1, the noisy and noise-free walks converge to the same continuum limit, and this guarantees that by Corollary S6.2 that their hitting times converge in distribution. Applying Theorem 4.5 gives the desired result.\nThis is a basic, but useful result for robustness of hitting times. Up to o(1) noise edges can be allowed for each vertex without disrupting the global convergence of hitting times.\n(a) Modified LTHT rapidly converges to RA index. (b) Conditioning on t > 1 substantially outperforms naive LTHT."
    }, {
      "heading" : "9 Resource allocation index",
      "text" : "Recall that the directed RA index was defined by\nRij = ∑\nxk∈NBn(xi)∩NBinn(xj)\n1\n|NBn(xk)|\nand the modified log-LTHT was defined by\nMmodij = − log(E[exp(−βT xixj ,n) | T xixj ,n > 1])."
    }, {
      "heading" : "9.1 RA index reduction",
      "text" : "Theorem S9.1. If β = ω(log(gdnn)) and xi and xj have at least one common neighbor, then\nMmodij − 2β → − log(Rij) + log(|NBn(xi)|).\nProof. Let Pij(t) be the probability of going from xi to xj in t steps, and Hij(t) the probability of not hitting before time t. Factoring the two-step hitting time yields\nMmodij = 2β − log(Pij(2))− log ( 1 + ∞∑\nt=3\nPij(t) Pij(2) Hij(t)e\n−β(t−2) ) .\nLet kmax be the maximal out-degree which occurs in Gn. By assumption, at least one of the at most k 2 max two-step paths from xi goes to xj , we have the bound Pij(t) Pij(2)\n≤ k2max. For β = ω(log(gdnn)), we see that β = ω(2 log(kmax)) with high probability. Applying the bounds Hij(t) ≤ 1 and Pij(t)Pij(2) ≤ k 2 max, we obtain\n∞∑\nt=3\nPij(t) Pij(2) Hij(t)e −β(t−2) ≤ k 2 max eβ − 1 = o(k −1 max).\nWe conclude that Mmodij → 2β − log(Pij(2)). It remains to verify that log(Pij(2)) is related to the resource allocation index by\nlog(Pij(2)) = log   1 |NBn(xi)|\n∑\nk∈NBn(xi)∩NBinn (xj)\n1\nNBn(xk)\n  = log(Rij)− log(|NBn(xi)|)."
    }, {
      "heading" : "9.2 RA index robustness",
      "text" : "We verify the robustness of the RA index by directly bounding the statistics involved.\nTheorem S9.2. If qi = q = o(g d/2 n ) for all i, then for any δ > 0 there exist cutoffs c1, c2 and scaling hn so that with probability at least 1− δ, for any i, j we have • |xi − xj | < min{εn(xi), εn(xj)} if Rijhn < c1; • |xi − xj | > 2 max{εn(xi), εn(xj)} if Rijhn > c2.\nProof. Decompose the out-degree of xi into expectation and noise terms by\n|NBn(xi)| = nq + ki + zi, where ki = εn(xi)\ndp(xi)Vdn, Vd is the volume of the d-unit ball, and zi is a random variable giving the remaining error. The number of noise edges has a binomial distribution with n draws and success probability q, and the number of geometric edges has a Poisson distribution with rate ki. Therefore, the Chebyshev inequality implies\nP(|zi| > c) ≤ ki + nq(1− q) c2 < ki + nq c2 . (16)\nLet δ1 = δ/4 and define c by the equality\nδ1 = ki + nq(1− q)\nc2 (17)\nso that c = δ −1/2 1 √ ki + nq. For the rest of the proof, we condition on the event that |zi| < c. By Taylor expanding 1|NBn(xi)| in zi, we have that\n1\n|NBn(xi)| =\n1 nq + ki − zi (nq + ki)2 +O\n( z2i\n(nq + ki)3\n)\n= 1\nnq + ki −O\n( c\n(nq + ki)2\n) . (18)\nBy (17), we see that |zi| < c with probability at least 1− δ1, which implies that c\n(nq + ki)2 < δ −1/2 1 (nq + ki) −3/2.\nBy the definition of the RA index, we obtain\nRij = ∑\nxk∈NBn(xi)∩NBinn(xj)\n( 1\nnq + ki +O(δ\n−1/2 1 (nq + ki) −3/2) ) .\nSince our domain is compact, we may define\nk+n = sup x εn(x) dp(x)Vdn and k − n = inf x εn(x) dp(x)Vdn.\nBy construction, k+n > ki > k − n for all i. Let Cij := |NBn(xi) ∩ NBinn (xj)|. Then we have\nCij\nnq + k+n −O\n( Cij\nδ 1/2 1 (nq + k + n )3/2\n) ≤ Rij ≤ Cij\nnq + k−n +O\n( Cij\nδ 1/2 1 (nq + k − n )3/2\n) . (19)\nChoose the scaling\nhn = nq + k+n k+n .\nWe will now bound Cij to control hnRij . To do this, decompose Cij as\nCij = C g ij + C n1 ij + C n2 ij ,\nwhere Cgij , C n1 ij , and C n2 ij are defined as follows.\n1. Geometric edges (Cgij): If |xi − xj | < min{εn(xi), εn(xj)} then they share common neighbors due to the geometric graph. Specifically their number of common neighbors has Poisson distribution with mean at least τdki(1− q), where τd is a constant independent of n defined as the overlapping density of two kernels at a unit distance.\n2. One noise edge (Cn1ij ): The edge xi → xk occurs by noise but xk → xj is geometric. There are at most k+n such vertices with in-edges to xj and so this is at most a binomial random variable with k + n draws\nand success probability q.\n3. Two noise edges (Cn2ij ): Both xi → xk and xk → xj may occur by noise, this is at most a binomial random variable with n− k−n draws and success probability q2.\nThe case of |xi−xj | < min{εn(xi), εn(xj)}: All types of edges may occur, so we obtain the moment bounds\nE [ Cij\nk+n\n] ≥ τd(1− q)\nk−n k+n\nVar\n[ Cij\nk+n\n] ≤ τd(1− q)k − n\n(k+n )2 + (n− k−n )q2(1− q2) + k+n q(1− q) (k+n )2 < τd(1− q)k−n (k+n )2 + nq2 + k+n q (k+n )2 .\nNotice that k+n k−n is bounded between the minimum and maximum of εn(x)p(x)εn(y)p(y) for x, y ∈ D, so limn→∞ E [ Cij k+n ] ≥\ncij for some cij > 0. Further, we find that Var [ Cij\nk+n\n] → 0. These imply that for large enough n, we have\nCij k+n > cij with probability at least 1− δ1. Therefore, if |xi − xj | < min{εn(xi), εn(xj)}, we have\nlim n→∞ hnRij ≥ lim n→∞\nCij k+n −O\n( Cij\nδ1/2(nq + k+n )1/2k + n\n) ≥ cij . (20)\nThe case of |xi − xj | > 2 max{εn(xi), εn(xj)}: Only noise cases occur, hence we have the moment bounds\nE [ Cij\nk−n\n] ≤ q\n2(n− k−n ) + qk+n k−n < q2n k−n + qk+n k−n\nVar\n[ Cij\nk−n\n] ≤ (n− k − n )q\n2(1− q2) + k+n q(1− q) (k−n )2 < qn (k−n )2 + qk+n (k−n )2 .\nBecause q = o(g d/2 n ), both the expectation and variance converge to zero and for large enough n, we have Cij/k − n → 0 probability at least 1− δ1. Therefore, if |xi − xj | > 2 max{εn(xi), εn(xj)}, for we have\nlim n→∞ hnRij ≤ lim n→∞\nCij(nq + k + n ) k+n (nq + k − n ) +O\n( Cij(nq + k + n )\nδ1/2k+n (nq + k − n )3/2\n) → 0. (21)\nCombining the cases: Taking hn = nq+k+n k+n , we combine (20) and (21) to conclude that the desired holds with probability at least 1− 3δ1 > 1− δ for any c1 ≤ cij and c2 > 0."
    } ],
    "references" : [ {
      "title" : "Some potential theory for reflecting Brownian motion in Hölder and Lipschitz",
      "author" : [ "Bass", "Richard F", "Hsu", "Pei" ],
      "venue" : "Proceedings of the 29th International Conference on Machine Learning",
      "citeRegEx" : "Bass et al\\.,? \\Q2012\\E",
      "shortCiteRegEx" : "Bass et al\\.",
      "year" : 2012
    }, {
      "title" : "Hitting times of Bessel processes",
      "author" : [ "J. lecki", "M. Ryznar" ],
      "venue" : "Potential Anal.,",
      "citeRegEx" : "lecki and Ryznar,? \\Q2013\\E",
      "shortCiteRegEx" : "lecki and Ryznar",
      "year" : 2013
    }, {
      "title" : "Local limit theorems for sequences of simple random walks on graphs",
      "author" : [ "Croydon", "David A", "Hambly", "Ben M" ],
      "venue" : "Potential Analysis,",
      "citeRegEx" : "Croydon et al\\.,? \\Q2008\\E",
      "shortCiteRegEx" : "Croydon et al\\.",
      "year" : 2008
    }, {
      "title" : "α-congruence for markov processes",
      "author" : [ "Eloranta", "Kari" ],
      "venue" : "The Annals of Probability, pp",
      "citeRegEx" : "Eloranta and Kari.,? \\Q1990\\E",
      "shortCiteRegEx" : "Eloranta and Kari.",
      "year" : 1990
    }, {
      "title" : "Markov processes: characterization and convergence",
      "author" : [ "Ethier", "Stewart N", "Kurtz", "Thomas G" ],
      "venue" : null,
      "citeRegEx" : "Ethier et al\\.,? \\Q1986\\E",
      "shortCiteRegEx" : "Ethier et al\\.",
      "year" : 1986
    }, {
      "title" : "A bag-of-paths framework for network data analysis",
      "author" : [ "Françoisse", "Kevin", "Kivimäki", "Ilkka", "Mantrach", "Amin", "Rossi", "Fabrice", "Saerens", "Marco" ],
      "venue" : "arXiv preprint arXiv:1302.6766,",
      "citeRegEx" : "Françoisse et al\\.,? \\Q2013\\E",
      "shortCiteRegEx" : "Françoisse et al\\.",
      "year" : 2013
    }, {
      "title" : "Metric recovery from directed unweighted graphs",
      "author" : [ "Hashimoto", "Tatsunori B", "Sun", "Yi", "Jaakkola", "Tommi S" ],
      "venue" : "In Proceedings of the Eighteenth International Conference on Artificial Intelligence and Statistics,",
      "citeRegEx" : "Hashimoto et al\\.,? \\Q2015\\E",
      "shortCiteRegEx" : "Hashimoto et al\\.",
      "year" : 2015
    }, {
      "title" : "On the principle of not feeling the boundary for diffusion processes",
      "author" : [ "Hsu", "Elton P" ],
      "venue" : "J. London Math. Soc. (2),",
      "citeRegEx" : "Hsu and P.,? \\Q1995\\E",
      "shortCiteRegEx" : "Hsu and P.",
      "year" : 1995
    }, {
      "title" : "Developments in the theory of randomized shortest paths with a comparison of graph node distances",
      "author" : [ "Kivimäki", "Ilkka", "Shimbo", "Masashi", "Saerens", "Marco" ],
      "venue" : "Physica A: Statistical Mechanics and its Applications,",
      "citeRegEx" : "Kivimäki et al\\.,? \\Q2014\\E",
      "shortCiteRegEx" : "Kivimäki et al\\.",
      "year" : 2014
    }, {
      "title" : "Brownian motion. Cambridge Series in Statistical and Probabilistic Mathematics",
      "author" : [ "Mörters", "Peter", "Peres", "Yuval" ],
      "venue" : null,
      "citeRegEx" : "Mörters et al\\.,? \\Q2010\\E",
      "shortCiteRegEx" : "Mörters et al\\.",
      "year" : 2010
    }, {
      "title" : "Stochastic differential equations: An introduction with applications",
      "author" : [ "Øksendal", "Bernt" ],
      "venue" : "Universitext. SpringerVerlag, Berlin, sixth edition,",
      "citeRegEx" : "Øksendal and Bernt.,? \\Q2003\\E",
      "shortCiteRegEx" : "Øksendal and Bernt.",
      "year" : 2003
    }, {
      "title" : "Bayesian discovery of threat networks",
      "author" : [ "Smith", "Steven T", "Kao", "Edward K", "Senne", "Kenneth D", "Bernstein", "Garrett", "Philips", "Scott" ],
      "venue" : "IEEE Transactions on Signal Processing,",
      "citeRegEx" : "Smith et al\\.,? \\Q2014\\E",
      "shortCiteRegEx" : "Smith et al\\.",
      "year" : 2014
    }, {
      "title" : "Diffusion processes with boundary conditions",
      "author" : [ "Stroock", "Daniel W", "Varadhan", "SR Srinivasa" ],
      "venue" : "Communications on Pure and Applied Mathematics,",
      "citeRegEx" : "Stroock et al\\.,? \\Q1971\\E",
      "shortCiteRegEx" : "Stroock et al\\.",
      "year" : 1971
    }, {
      "title" : "Diffusion processes in a small time interval",
      "author" : [ "S.R.S. Varadhan" ],
      "venue" : "Comm. Pure Appl. Math.,",
      "citeRegEx" : "Varadhan,? \\Q1967\\E",
      "shortCiteRegEx" : "Varadhan",
      "year" : 1967
    }, {
      "title" : "Consistency of spectral clustering",
      "author" : [ "von Luxburg", "Ulrike", "Belkin", "Mikhail", "Bousquet", "Olivier" ],
      "venue" : "The Annals of Statistics,",
      "citeRegEx" : "Luxburg et al\\.,? \\Q2008\\E",
      "shortCiteRegEx" : "Luxburg et al\\.",
      "year" : 2008
    }, {
      "title" : "Hitting and commute times in large random neighborhood graphs",
      "author" : [ "von Luxburg", "Ulrike", "Radl", "Agnes", "Hein", "Matthias" ],
      "venue" : "Journal of Machine Learning Research,",
      "citeRegEx" : "Luxburg et al\\.,? \\Q2014\\E",
      "shortCiteRegEx" : "Luxburg et al\\.",
      "year" : 2014
    }, {
      "title" : "Some useful functions for functional limit theorems",
      "author" : [ "Whitt", "Ward" ],
      "venue" : "Math. Oper. Res.,",
      "citeRegEx" : "Whitt and Ward.,? \\Q1980\\E",
      "shortCiteRegEx" : "Whitt and Ward.",
      "year" : 1980
    }, {
      "title" : "Similarity Learning Over Large Collaborative Networks",
      "author" : [ "Yazdani", "Majid" ],
      "venue" : "PhD thesis, École Polytechnique Fédérale de Lausanne,",
      "citeRegEx" : "Yazdani and Majid.,? \\Q2013\\E",
      "shortCiteRegEx" : "Yazdani and Majid.",
      "year" : 2013
    }, {
      "title" : "Learning from labeled and unlabeled data on a directed graph",
      "author" : [ "Zhou", "Dengyong", "Huang", "Jiayuan", "Schölkopf", "Bernhard" ],
      "venue" : "In Proceedings of the 22nd International Conference on Machine Learning,",
      "citeRegEx" : "Zhou et al\\.,? \\Q2005\\E",
      "shortCiteRegEx" : "Zhou et al\\.",
      "year" : 2005
    } ],
    "referenceMentions" : [ {
      "referenceID" : 18,
      "context" : "Some results on utilizing the directed Laplacian as a smoothing operator (Zhou et al., 2005) exist in this direction.",
      "startOffset" : 73,
      "endOffset" : 92
    }, {
      "referenceID" : 6,
      "context" : "5, following the original strategy of (Hashimoto et al., 2015).",
      "startOffset" : 38,
      "endOffset" : 62
    }, {
      "referenceID" : 6,
      "context" : "In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution nπXn(x).",
      "startOffset" : 3,
      "endOffset" : 27
    }, {
      "referenceID" : 6,
      "context" : "In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution nπXn(x). We believe “uniform equicontinuity” should be corrected to “eventual uniform equicontinuity” there. In Corollary S2.6, we show that (?) implies the conjecture of Hashimoto et al. (2015). One consequence of equicontinuity is that convergence in distribution implies convergence in density.",
      "startOffset" : 3,
      "endOffset" : 323
    }, {
      "referenceID" : 14,
      "context" : "5 to generalize the result of von Luxburg et al. (2014) on degenerate behavior of hitting times via Lemma 3.",
      "startOffset" : 34,
      "endOffset" : 56
    }, {
      "referenceID" : 6,
      "context" : "1Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of εn(x)−d.",
      "startOffset" : 45,
      "endOffset" : 69
    }, {
      "referenceID" : 6,
      "context" : "2Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of εn(x)−d.",
      "startOffset" : 45,
      "endOffset" : 69
    }, {
      "referenceID" : 8,
      "context" : "This method has been used to calculate the LTHT in in prior work (Kivimäki et al., 2014).",
      "startOffset" : 65,
      "endOffset" : 88
    }, {
      "referenceID" : 6,
      "context" : "Set an(x) = p̂(x) −1 and bn(x) = ε̂(x)−2 as estimated by (Hashimoto et al., 2015) so that limn→∞ an(x) = p(x)−1 and limn→∞ bn(x) = ε(x)−2.",
      "startOffset" : 57,
      "endOffset" : 81
    }, {
      "referenceID" : 6,
      "context" : "By (Alamgir & von Luxburg, 2012) for the k-nearest neighbor case and (Hashimoto et al., 2015) with Lemma S6.",
      "startOffset" : 69,
      "endOffset" : 93
    }, {
      "referenceID" : 13,
      "context" : "2) and the results of (Varadhan, 1967).",
      "startOffset" : 22,
      "endOffset" : 38
    }, {
      "referenceID" : 13,
      "context" : "2) and the results of (Varadhan, 1967).",
      "startOffset" : 22,
      "endOffset" : 38
    }, {
      "referenceID" : 6,
      "context" : "so the result follows by the noise-less result in (Hashimoto et al., 2015).",
      "startOffset" : 50,
      "endOffset" : 74
    } ],
    "year" : 2015,
    "abstractText" : "Large unweighted directed graphs are commonly used to capture relations between entities. A fundamental problem in the analysis of such networks is to properly define the similarity or dissimilarity between any two vertices. Despite the significance of this problem, statistical characterization of the proposed metrics has been limited. We introduce and develop a class of techniques for analyzing random walks on graphs using stochastic calculus. Using these techniques we generalize results on the degeneracy of hitting times and analyze a metric based on the Laplace transformed hitting time (LTHT). The metric serves as a natural, provably well-behaved alternative to the expected hitting time. We establish a general correspondence between hitting times of the Brownian motion and analogous hitting times on the graph. We show that the LTHT is consistent with respect to the underlying metric of a geometric graph, preserves clustering tendency, and remains robust against random addition of non-geometric edges. Tests on simulated and real-world data show that the LTHT matches theoretical predictions and outperforms alternatives.",
    "creator" : "LaTeX with hyperref package"
  }
}